"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5738],{3554:(A,M,f)=>{f.d(M,{e:()=>d});var t=f(6814),E=f(95),p=f(5548),c=f(6689);let d=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=c.oAB({type:s}),s.\u0275inj=c.cJS({imports:[t.ez,E.u5,p.Pc]}),s})()},8452:(A,M,f)=>{f.d(M,{q:()=>s});var t=f(5861),E=f(4092),p=f(182),c=f(15),d=f(6689);let s=(()=>{class o extends E.q{constructor(){super(p.lN)}get(n,i){var l=()=>super._get,r=this;return(0,t.Z)(function*(){const a=yield l().call(r,o.makeCollectionRef(n),i);return r.convertTimestampToDate(a)})()}getAll(){var n=()=>super._getAll,i=this;return(0,t.Z)(function*(){const l=yield n().call(i);return l.docs&&(l.docs=l.docs.map(r=>i.convertTimestampToDate(r))),l})()}getAllFromParent(n){var i=()=>super._getAllFromParent,l=this;return(0,t.Z)(function*(){const r=yield i().call(l,o.makeCollectionRef(n));return r.docs&&(r.docs=r.docs.map(a=>l.convertTimestampToDate(a))),r})()}getByQuery(n){var i=()=>super._getByQuery,l=this;return(0,t.Z)(function*(){const r=yield i().call(l,n);return r.docs&&(r.docs=r.docs.map(a=>l.convertTimestampToDate(a))),r})()}add(n,i,l){var r=()=>super._add,a=this;return(0,t.Z)(function*(){return r().call(a,o.makeCollectionRef(n),i,l)})()}update(n,i,l){var r=()=>super._update,a=this;return(0,t.Z)(function*(){return r().call(a,o.makeCollectionRef(n),i,l)})()}delete(n,i,l=!1){var r=()=>super._delete,a=this;return(0,t.Z)(function*(){return r().call(a,o.makeCollectionRef(n),i,l)})()}static makeCollectionRef(n){return(0,c.hJ)((0,c.ad)(),p.YP,n,p.lN)}convertTimestampToDate(n){if(!n)return n;const i=n.last_transaction_retrieval;return i&&(n.last_transaction_retrieval=i.toDate()),n}}return o.\u0275fac=function(n){return new(n||o)},o.\u0275prov=d.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()},1269:(A,M,f)=>{f.d(M,{O:()=>p});var t=f(6689),E=f(9862);let p=(()=>{class c{constructor(s){this.http=s}post(s,o){return this.http.post(s,o,{headers:this.getHeaders()})}getHeaders(){return{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}}return c.\u0275fac=function(s){return new(s||c)(t.LFG(E.eN))},c.\u0275prov=t.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()},7087:(A,M,f)=>{f.d(M,{O:()=>R});var t=f(5861),E=f(6306),p=f(6973);function c(T,y){const I="object"==typeof y;return new Promise((O,b)=>{let v,D=!1;T.subscribe({next:L=>{v=L,D=!0},error:b,complete:()=>{D?O(v):I?O(y.defaultValue):b(new p.K)}})})}var d=f(553);const s=d.N.useFunctionsEmulator&&!d.N.production?"http://localhost:5001/balanced-budget-90f1f/us-central1/":"https://us-central1-balanced-budget-90f1f.cloudfunctions.net/",o=s+"getTransactionData",e=s+"createPlaidLinkToken",n=s+"exchangePublicToken",l=s+"removeLinkedAccount";function r(T){const y=T.datetime?new Date(T.datetime):new Date(T.date);return{id:T.transaction_id,amount:T.amount,subcategoryId:"",date:y,merchant_name:T.merchant_name,name:T.name,pending:T.pending}}var a=f(6689),u=f(1269),h=f(8452),_=f(7195),m=f(6635),g=f(5548),P=f(3076);let R=(()=>{class T{get plaidAvailable(){return this.userService.isPremium}constructor(I,O,b,D,v,L){this.http=I,this.linkedAccountsRepository=O,this.userRepository=b,this.transactionPublisher=D,this.loadingController=v,this.userService=L}linkPlaidToUser(){var I=this;return(0,t.Z)(function*(){if(!I.plaidAvailable)return;const O=yield I.loadingController.create();yield O.present(),I.http.post(e,{user_id:I.userRepository.getCurrentUserId()}).pipe((0,E.K)(b=>(console.log(b),O.dismiss(),b))).subscribe(b=>{console.log(b);const D=I.createPlaidHandler(b.link_token);O.dismiss(),D.open()})})()}syncPlaidTransactions(){var I=this;return(0,t.Z)(function*(){if(!I.plaidAvailable)return;const O=I.userRepository.getCurrentUserId();if(!O)throw new Error("User is not logged in");const b=(yield I.linkedAccountsRepository.getAllFromParent(O)).docs;if(0===b.length)return;const D=[];for(let B of b)(yield I.shouldSyncTransactions(B))&&D.push(c(I.http.post(o,{userId:O,linkedAccount:B,linkedAccountId:B.id})));const v=yield Promise.all(D);let L=[],x=[],F=[];for(let B=0;B<v.length;B++){const V=v[B];L=L.concat(V.added),x=x.concat(V.removed),F=F.concat(V.modified)}I.plaidTransactionSyncHandler(L,x,F,!0)})()}removePlaidLinkedAccount(I){var O=this;return(0,t.Z)(function*(){const b=O.userRepository.getCurrentUserId();if(!b)throw new Error("User is not logged in");O.http.post(l,{user_id:b,linked_account_id:I.id}).subscribe(D=>{console.log(D)})})()}createPlaidHandler(I){return Plaid.create({token:I,onSuccess:this.plaidHandlerOnSuccessCallback.bind(this),onExit:this.plaidHandlerOnExitCallback.bind(this),onLoad:this.plaidHandlerOnLoadCallback.bind(this),onEvent:this.plaidHandlerOnEventCallback.bind(this),receivedRedirectUri:null})}plaidHandlerOnSuccessCallback(I,O){this.http.post(n,{publicToken:I,institutionName:O.institution.name,userId:this.userRepository.getCurrentUserId()}).subscribe(b=>{console.log(b);const{added:D,removed:v,modified:L}=b;this.plaidTransactionSyncHandler(D,v,L,!0)})}plaidHandlerOnExitCallback(I,O){return(0,t.Z)(function*(){console.log(I)})()}plaidHandlerOnLoadCallback(){return(0,t.Z)(function*(){})()}plaidHandlerOnEventCallback(I,O){return(0,t.Z)(function*(){})()}plaidTransactionSyncHandler(I,O,b,D=!0){var v=this;return(0,t.Z)(function*(){const B={from:"plaid",addedTransactions:I.map(r),removedTransactions:O.map(r),modifiedTransactions:b.map(r)};return D&&v.transactionPublisher.publishEvent(B),B})()}shouldSyncTransactions(I){return(0,t.Z)(function*(){if(!I.last_transaction_retrieval)return!0;const b=I.last_transaction_retrieval;return(new Date).getTime()-b.getTime()>3e5})()}}return T.\u0275fac=function(I){return new(I||T)(a.LFG(u.O),a.LFG(h.q),a.LFG(_.E),a.LFG(m.u),a.LFG(g.HT),a.LFG(P.K))},T.\u0275prov=a.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},6635:(A,M,f)=>{f.d(M,{u:()=>E});var t=f(6689);let E=(()=>{class p{constructor(){this.subscribers=new Set}publishEvent(d){console.log("Publishing event",d),this.subscribers.forEach(s=>{s.onTransactionEvent(d)})}subscribe(d){this.subscribers.add(d)}unsubscribe(d){this.subscribers.delete(d)}}return p.\u0275fac=function(d){return new(d||p)},p.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},3076:(A,M,f)=>{f.d(M,{K:()=>d});var t=f(5861),E=f(6689),p=f(1776),c=f(7195);let d=(()=>{class s{constructor(e,n){this.authService=e,this.userRepository=n,this.userRepository.currentFirestoreUser.subscribe(i=>{i&&(this.isPremium=i.subscribed)})}updatePremiumStatus(e){var n=this;return(0,t.Z)(function*(){const i=yield n.authService.getCurrentAuthUser();!i||!i.uid||(n.isPremium=e,n.userRepository.update(i.uid,{subscribed:e,token:n.authService.userToken}))})()}}return s.\u0275fac=function(e){return new(e||s)(E.LFG(p.e),E.LFG(c.E))},s.\u0275prov=E.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},5738:(A,M,f)=>{f.r(M),f.d(M,{Tab3PageModule:()=>W});var t=f(5548),E=f(6814),p=f(95),c=f(3554),d=f(2607),s=f(5861),o=f(7826),e=f(6689),n=f(8452),i=f(7087);function l(N,C){1&N&&e._UZ(0,"ion-icon",12)}function r(N,C){1&N&&e._UZ(0,"ion-icon",13)}function a(N,C){1&N&&e._UZ(0,"ion-icon",14)}function u(N,C){1&N&&(e.TgZ(0,"p"),e._uU(1," Linked "),e.qZA())}function h(N,C){1&N&&(e.TgZ(0,"p"),e._uU(1," Almost Expired "),e.qZA())}function _(N,C){1&N&&(e.TgZ(0,"p"),e._uU(1," Needs Relink "),e.qZA())}function m(N,C){if(1&N){const S=e.EpF();e.TgZ(0,"ion-item-option",15),e.NdJ("click",function(){e.CHM(S);const w=e.oxw().$implicit,k=e.oxw(2);return e.KtG(k.handleLinkedAccountAction(w))}),e._uU(1," Relink "),e.qZA()}}function g(N,C){if(1&N){const S=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",5),e.NdJ("click",function(){const k=e.CHM(S).$implicit,G=e.oxw(2);return e.KtG(G.handleLinkedAccountAction(k))}),e.YNc(2,l,1,0,"ion-icon",6),e.YNc(3,r,1,0,"ion-icon",7),e.YNc(4,a,1,0,"ion-icon",8),e.TgZ(5,"ion-label")(6,"h2"),e._uU(7),e.qZA(),e.YNc(8,u,2,0,"p",3),e.YNc(9,h,2,0,"p",3),e.YNc(10,_,2,0,"p",3),e.qZA()(),e.TgZ(11,"ion-item-options",9),e.YNc(12,m,2,0,"ion-item-option",10),e.TgZ(13,"ion-item-option",11),e.NdJ("click",function(){const k=e.CHM(S).$implicit,G=e.oxw(2);return e.KtG(G.removeLinkedAccount(k))}),e._uU(14," Delete "),e.qZA()()()}if(2&N){const S=C.$implicit;e.xp6(1),e.Q6J("button","NONE"!=S.link_status.required_action),e.xp6(1),e.Q6J("ngIf","NONE"==S.link_status.required_action),e.xp6(1),e.Q6J("ngIf","NOTIFY_PENDING_EXPIRATION"==S.link_status.required_action),e.xp6(1),e.Q6J("ngIf","RELINK"==S.link_status.required_action),e.xp6(3),e.Oqu(S.institution_name),e.xp6(1),e.Q6J("ngIf","NONE"==S.link_status.required_action),e.xp6(1),e.Q6J("ngIf","NOTIFY_PENDING_EXPIRATION"==S.link_status.required_action),e.xp6(1),e.Q6J("ngIf","RELINK"==S.link_status.required_action),e.xp6(2),e.Q6J("ngIf","NONE"!=S.link_status.required_action)}}function P(N,C){if(1&N&&(e.TgZ(0,"ion-list"),e.YNc(1,g,15,9,"ion-item-sliding",4),e.qZA()),2&N){const S=e.oxw();e.xp6(1),e.Q6J("ngForOf",S.linkedAccounts)}}function R(N,C){1&N&&e._UZ(0,"div")}let T=(()=>{class N{constructor(S,U,w){this.modalController=S,this.linkedAccountsRepository=U,this.plaidService=w,this.linkedAccounts=[],this.loading=!0}ngOnInit(){if(!this.user)throw new Error("ViewLinkedAccountsComponent: user is undefined");this.linkedAccountsRepository.getAllFromParent(this.user.id).then(S=>{this.loading=!1,this.linkedAccounts=S.docs,this.linkedAccounts.push({id:"test",institution:"test",institution_name:"test ok",last_transaction_retrieval:new Date,transaction_sync_cursor:"test",link_status:{required_action:"NONE",last_webhook:"ERROR"}}),this.linkedAccounts.push({id:"test",institution:"test",institution_name:"test relink",last_transaction_retrieval:new Date,transaction_sync_cursor:"test",link_status:{required_action:"RELINK",last_webhook:"ERROR"}}),this.linkedAccounts.push({id:"test",institution:"test",institution_name:"test pending exp",last_transaction_retrieval:new Date,transaction_sync_cursor:"test",link_status:{required_action:"NOTIFY_PENDING_EXPIRATION",last_webhook:"ERROR"}})})}removeLinkedAccount(S){var U=this;return(0,s.Z)(function*(){U.plaidService.removePlaidLinkedAccount(S),U.linkedAccounts=U.linkedAccounts.filter(w=>w.id!==S.id)})()}handleLinkedAccountAction(S){var U=this;return(0,s.Z)(function*(){switch(S.link_status.required_action){case"RELINK":case"NOTIFY_PENDING_EXPIRATION":U.relinkLinkedAccount(S);break;case"NONE":break;default:throw new Error("ViewLinkedAccountsComponent: unknown required_action")}})()}relinkLinkedAccount(S){return(0,s.Z)(function*(){console.log("relinking linked account")})()}}return N.\u0275fac=function(S){return new(S||N)(e.Y36(t.IN),e.Y36(n.q),e.Y36(i.O))},N.\u0275cmp=e.Xpm({type:N,selectors:[["app-view-linked-accounts"]],decls:12,vars:2,consts:[["color","primary"],["slot","start"],[3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"],["lines","full",3,"button","click"],["name","checkmark-circle-outline","style","color: var(--ion-color-success)","slot","start",4,"ngIf"],["name","alert-circle-outline","style","color: var(--ion-color-warning)","slot","start",4,"ngIf"],["name","alert-circle-outline","style","color: var(--ion-color-danger)","slot","start",4,"ngIf"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","checkmark-circle-outline","slot","start",2,"color","var(--ion-color-success)"],["name","alert-circle-outline","slot","start",2,"color","var(--ion-color-warning)"],["name","alert-circle-outline","slot","start",2,"color","var(--ion-color-danger)"],["color","primary",3,"click"]],template:function(S,U){1&S&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return U.modalController.dismiss()}),e._uU(4,"Close"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Linked Accounts"),e.qZA()()(),e.TgZ(7,"ion-content")(8,"ion-card")(9,"ion-card-content"),e.YNc(10,P,2,1,"ion-list",3),e.YNc(11,R,1,0,"div",3),e.qZA()()()),2&S&&(e.xp6(10),e.Q6J("ngIf",!U.loading),e.xp6(1),e.Q6J("ngIf",!U.loading))},dependencies:[E.sg,E.O5,t.YG,t.Sm,t.PM,t.FN,t.W2,t.Gu,t.gu,t.Ie,t.u8,t.IK,t.td,t.Q$,t.q_,t.wd,t.sr]}),N})();var y=f(3076);f(3382);let O=(()=>{class N{constructor(S,U,w,k){this.platform=S,this.loadingCtrl=U,this.userService=w,this.alertCtrl=k,this.products=[],this.premium_yearly_id=(this.platform.is("ios"),"premium_yearly"),this.premium_id=(this.platform.is("ios"),"premium_sub"),this.platform.ready().then(()=>{this.platform.is("mobile")?(this.store=CdvPurchase.store,this.registerProducts(),this.setupListeners(),this.store.initialize([this.platform.is("ios")?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY]),this.store.ready(()=>{this.products=this.store.products})):this.platform.is("desktop")})}registerProducts(){this.store.register([{type:CdvPurchase.ProductType.PAID_SUBSCRIPTION,id:this.premium_id,platform:this.platform.is("ios")?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY},{type:CdvPurchase.ProductType.PAID_SUBSCRIPTION,id:this.premium_yearly_id,platform:this.platform.is("ios")?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY}])}setupListeners(){this.store.when().approved(S=>((S.products[0].id===this.premium_id||S.products[0].id===this.premium_yearly_id)&&this.userService.updatePremiumStatus(!0),S.verify())).verified(S=>S.finish()).unverified(S=>S.finish()).finished(()=>{this.loader&&this.loader.dismiss()})}startPurchase(S){var U=this;return(0,s.Z)(function*(){let w;for(let k=0;k<U.products.length;k++)if(U.products[k].id==S){w=U.products[k];break}U.purchase(w)})()}purchase(S){var U=this;return(0,s.Z)(function*(){U.loader=yield U.loadingCtrl.create({message:"Loading..."}),yield U.loader.present();let w=S.getOffer();w&&U.store.order(w).then(k=>{},k=>{U.loader.dismiss(),U.presentAlert("Failed",`Failed to purchase: ${k}`)}).finally(()=>{U.loader.dismiss()})})()}restore(){this.store.restorePurchases()}presentAlert(S,U){var w=this;return(0,s.Z)(function*(){yield(yield w.alertCtrl.create({header:S,message:U,buttons:["OK"]})).present()})()}}return N.\u0275fac=function(S){return new(S||N)(e.LFG(t.t4),e.LFG(t.HT),e.LFG(y.K),e.LFG(t.Br))},N.\u0275prov=e.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),N})();var b=f(1776),D=f(3251),v=f(7195);function L(N,C){if(1&N&&(e.TgZ(0,"p",18),e._uU(1),e.qZA()),2&N){const S=e.oxw(2);e.xp6(1),e.hij(" ",S.inapp.products[0].raw.price,"/month ")}}function x(N,C){if(1&N&&(e.TgZ(0,"p",18),e._uU(1),e.qZA()),2&N){const S=e.oxw(2);e.xp6(1),e.hij(" ",S.inapp.products[1].raw.price,"/year ")}}function F(N,C){if(1&N){const S=e.EpF();e.TgZ(0,"ion-card")(1,"ion-card-content")(2,"div",7)(3,"header"),e._UZ(4,"lottie-player",8),e.qZA(),e.TgZ(5,"section",9)(6,"h2"),e._uU(7,"Why Go Pro?"),e.qZA(),e.TgZ(8,"ul")(9,"li"),e._uU(10,"\u{1f680} Automatic Transaction Imports"),e.qZA(),e.TgZ(11,"li"),e._uU(12,"\u{1f552} Save Time with No More Manual Entries"),e.qZA(),e.TgZ(13,"li"),e._uU(14,"\u{1f3a8} Change the app's overall theme"),e.qZA()()(),e.TgZ(15,"section",10)(16,"h2"),e._uU(17,"Choose Your Plan"),e.qZA(),e.TgZ(18,"span",11)(19,"div",12)(20,"h3"),e._uU(21,"Monthly Plan"),e.qZA(),e.YNc(22,L,2,1,"p",13),e.TgZ(23,"p"),e._uU(24,"After 7-day Free Trial"),e.qZA(),e.TgZ(25,"button",14),e.NdJ("click",function(){e.CHM(S);const w=e.oxw();return e.KtG(w.purchase("premium_sub"))}),e._uU(26,"Go Monthly"),e.qZA()(),e.TgZ(27,"div",15)(28,"h3"),e._uU(29,"Yearly Plan"),e.qZA(),e.YNc(30,x,2,1,"p",13),e.TgZ(31,"p"),e._uU(32,"After 7-day Free Trial"),e.qZA(),e.TgZ(33,"button",14),e.NdJ("click",function(){e.CHM(S);const w=e.oxw();return e.KtG(w.purchase("premium_yearly"))}),e._uU(34,"Go Yearly"),e.qZA()()(),e.TgZ(35,"div")(36,"p")(37,"a",16),e._uU(38,"Privacy Policy"),e.qZA()(),e.TgZ(39,"p")(40,"a",17),e._uU(41,"Terms & Conditions"),e.qZA()()()()()()()}if(2&N){const S=e.oxw();e.xp6(22),e.Q6J("ngIf",S.inapp.products.length>0),e.xp6(8),e.Q6J("ngIf",S.inapp.products.length>0)}}const V=[{path:"",component:(()=>{class N{constructor(S,U,w,k,G,H,Z,K,j){this.modalController=S,this.userService=U,this.inapp=w,this.authService=k,this.router=G,this.alertService=H,this.plaidService=Z,this.alertCtrl=K,this.userRepository=j}ngOnInit(){}link(){var S=this;return(0,s.Z)(function*(){S.plaidService.linkPlaidToUser()})()}signOut(){var S=this;return(0,s.Z)(function*(){(yield S.authService.logout())?S.router.navigateByUrl("login"):S.alertService.createAndShowToast("There was an error logging out")})()}purchase(S){this.inapp.startPurchase(S)}goToThemes(){this.router.navigateByUrl("tabs/tab3/themes")}deleteAccount(){var S=this;return(0,s.Z)(function*(){var w;(yield S.alertCtrl.create({header:"Are you sure you want to delete your account?",buttons:[{text:"Yes",role:"destructive",handler:(w=(0,s.Z)(function*(){const k=yield S.authService.getCurrentAuthUser();(0,o.h8)(k).then(()=>window.location.reload())}),function(){return w.apply(this,arguments)})},{text:"No",handler:function(){var w=(0,s.Z)(function*(){});return function(){return w.apply(this,arguments)}}()}]})).present()})()}viewLinkedAccounts(){var S=this;return(0,s.Z)(function*(){const U=yield S.userRepository.getCurrentFirestoreUser();if(!U)throw new Error("Tab3: user is undefined");(yield S.modalController.create({component:T,componentProps:{user:U}})).present()})()}}return N.\u0275fac=function(S){return new(S||N)(e.Y36(t.IN),e.Y36(y.K),e.Y36(O),e.Y36(b.e),e.Y36(d.F0),e.Y36(D.c),e.Y36(i.O),e.Y36(t.Br),e.Y36(v.E))},N.\u0275cmp=e.Xpm({type:N,selectors:[["app-tab3"]],decls:25,vars:5,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],["button","",3,"disabled","click"],["button","",3,"click"],[1,"container"],["slot","end","autoplay","","loop","","src","https://lottie.host/1a9b80ea-1cb9-4b02-929a-0a9d8e7fcee2/bdrGIZRYXV.json"],[1,"benefits"],[1,"pricing"],[1,"row"],["id","monthly",1,"plan"],["class","price",4,"ngIf"],[3,"click"],["id","yearly",1,"plan"],["href","https://elcodev.com/privacy-policy"],["href","https://elcodev.com/terms-conditions"],[1,"price"]],template:function(S,U){1&S&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e._uU(3," Accounts "),e.qZA()()(),e.TgZ(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),e._uU(8,"Accounts"),e.qZA()()(),e.YNc(9,F,42,2,"ion-card",4),e.TgZ(10,"ion-card")(11,"ion-card-content")(12,"ion-list")(13,"ion-item",5),e.NdJ("click",function(){return U.link()}),e.TgZ(14,"ion-label"),e._uU(15,"Link Account"),e.qZA()(),e.TgZ(16,"ion-item",5),e.NdJ("click",function(){return U.goToThemes()}),e.TgZ(17,"ion-label"),e._uU(18,"Change App Theme"),e.qZA()(),e.TgZ(19,"ion-item",6),e.NdJ("click",function(){return U.deleteAccount()}),e.TgZ(20,"ion-label"),e._uU(21,"Delete Account"),e.qZA()(),e.TgZ(22,"ion-item",6),e.NdJ("click",function(){return U.signOut()}),e.TgZ(23,"ion-label"),e._uU(24,"Sign Out"),e.qZA()()()()()()),2&S&&(e.Q6J("translucent",!0),e.xp6(4),e.Q6J("fullscreen",!0),e.xp6(5),e.Q6J("ngIf",!U.userService.isPremium),e.xp6(4),e.Q6J("disabled",!U.userService.isPremium),e.xp6(3),e.Q6J("disabled",!U.userService.isPremium))},dependencies:[t.PM,t.FN,t.W2,t.Gu,t.Ie,t.Q$,t.q_,t.wd,t.sr,E.O5],styles:["ion-title[_ngcontent-%COMP%]{background:#f3f3f3}ion-toolbar[_ngcontent-%COMP%]{padding:0!important}.container[_ngcontent-%COMP%]{max-width:800px;margin:20px auto;padding:20px;border-radius:8px}header[_ngcontent-%COMP%]{text-align:center;display:flex;flex-direction:row;justify-content:center}header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#00eabb}.benefits[_ngcontent-%COMP%]{margin:20px 0}.benefits[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .pricing[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;color:#2980b9}.benefits[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.benefits[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:10px 0;font-size:18px}.pricing[_ngcontent-%COMP%]{text-align:center}.pricing[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;flex-wrap:nowrap}.plan[_ngcontent-%COMP%]{display:flex;min-width:50%;max-width:50%;margin:10px;padding:20px;background:#f9f9f9;border:1px solid #ddd;border-radius:8px;flex-direction:column;flex-wrap:nowrap;align-items:center;justify-content:center}.plan[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2980b9}.price[_ngcontent-%COMP%]{font-size:20px;color:#000}button[_ngcontent-%COMP%]{width:100%;padding:10px;border:none;border-radius:5px;background-color:#00eabb;color:#fff;font-size:18px;cursor:pointer;margin-top:10px}button[_ngcontent-%COMP%]:hover{background-color:#00cea5}lottie-player[_ngcontent-%COMP%]{width:225px;margin-top:-90px;text-align:center}"]}),N})()},{path:"themes",loadChildren:()=>f.e(6344).then(f.bind(f,6344)).then(N=>N.ThemesPageModule)}];let Y=(()=>{class N{}return N.\u0275fac=function(S){return new(S||N)},N.\u0275mod=e.oAB({type:N}),N.\u0275inj=e.cJS({imports:[d.Bz.forChild(V),d.Bz]}),N})(),W=(()=>{class N{}return N.\u0275fac=function(S){return new(S||N)},N.\u0275mod=e.oAB({type:N}),N.\u0275inj=e.cJS({imports:[t.Pc,E.ez,p.u5,c.e,Y]}),N})()},3382:function(){var t,f,A=this&&this.__awaiter||function(t,E,p,c){return new(p||(p=Promise))(function(s,o){function e(l){try{i(c.next(l))}catch(r){o(r)}}function n(l){try{i(c.throw(l))}catch(r){o(r)}}function i(l){l.done?s(l.value):function d(s){return s instanceof p?s:new p(function(o){o(s)})}(l.value).then(e,n)}i((c=c.apply(t,E||[])).next())})};function M(){var t;console.log("Create CdvPurchase...");const E=null===(t=window.CdvPurchase)||void 0===t?void 0:t.store;window.CdvPurchase=f,window.CdvPurchase.store=E||new f.Store,Object.assign(window.CdvPurchase.store,f.LogLevel,f.ProductType,f.ErrorCode,f.Platform)}!function(t){let p;var d;(d=p=t.ErrorCode||(t.ErrorCode={}))[d.SETUP=6777001]="SETUP",d[d.LOAD=6777002]="LOAD",d[d.PURCHASE=6777003]="PURCHASE",d[d.LOAD_RECEIPTS=6777004]="LOAD_RECEIPTS",d[d.CLIENT_INVALID=6777005]="CLIENT_INVALID",d[d.PAYMENT_CANCELLED=6777006]="PAYMENT_CANCELLED",d[d.PAYMENT_INVALID=6777007]="PAYMENT_INVALID",d[d.PAYMENT_NOT_ALLOWED=6777008]="PAYMENT_NOT_ALLOWED",d[d.UNKNOWN=6777010]="UNKNOWN",d[d.REFRESH_RECEIPTS=6777011]="REFRESH_RECEIPTS",d[d.INVALID_PRODUCT_ID=6777012]="INVALID_PRODUCT_ID",d[d.FINISH=6777013]="FINISH",d[d.COMMUNICATION=6777014]="COMMUNICATION",d[d.SUBSCRIPTIONS_NOT_AVAILABLE=6777015]="SUBSCRIPTIONS_NOT_AVAILABLE",d[d.MISSING_TOKEN=6777016]="MISSING_TOKEN",d[d.VERIFICATION_FAILED=6777017]="VERIFICATION_FAILED",d[d.BAD_RESPONSE=6777018]="BAD_RESPONSE",d[d.REFRESH=6777019]="REFRESH",d[d.PAYMENT_EXPIRED=6777020]="PAYMENT_EXPIRED",d[d.DOWNLOAD=6777021]="DOWNLOAD",d[d.SUBSCRIPTION_UPDATE_NOT_AVAILABLE=6777022]="SUBSCRIPTION_UPDATE_NOT_AVAILABLE",d[d.PRODUCT_NOT_AVAILABLE=6777023]="PRODUCT_NOT_AVAILABLE",d[d.CLOUD_SERVICE_PERMISSION_DENIED=6777024]="CLOUD_SERVICE_PERMISSION_DENIED",d[d.CLOUD_SERVICE_NETWORK_CONNECTION_FAILED=6777025]="CLOUD_SERVICE_NETWORK_CONNECTION_FAILED",d[d.CLOUD_SERVICE_REVOKED=6777026]="CLOUD_SERVICE_REVOKED",d[d.PRIVACY_ACKNOWLEDGEMENT_REQUIRED=6777027]="PRIVACY_ACKNOWLEDGEMENT_REQUIRED",d[d.UNAUTHORIZED_REQUEST_DATA=6777028]="UNAUTHORIZED_REQUEST_DATA",d[d.INVALID_OFFER_IDENTIFIER=6777029]="INVALID_OFFER_IDENTIFIER",d[d.INVALID_OFFER_PRICE=6777030]="INVALID_OFFER_PRICE",d[d.INVALID_SIGNATURE=6777031]="INVALID_SIGNATURE",d[d.MISSING_OFFER_PARAMS=6777032]="MISSING_OFFER_PARAMS",d[d.VALIDATOR_SUBSCRIPTION_EXPIRED=6778003]="VALIDATOR_SUBSCRIPTION_EXPIRED",t.storeError=function c(d,s,o,e){return{isError:!0,code:d,message:s,platform:o,productId:e}}}(f||(f={})),(t=f||(f={})).Iaptic=class E{constructor(c,d){this.config=c,c.url||(c.url="https://validator.iaptic.com"),this.store=null!=d?d:t.store,this.log=this.store.log.child("Iaptic")}get braintreeClientTokenProvider(){return c=>{this.log.info("Calling Braintree clientTokenProvider"),t.Utils.ajax(this.log,{url:`${this.config.url}/v3/braintree/client-token?appName=${this.config.appName}&apiKey=${this.config.apiKey}`,method:"POST",data:{applicationUsername:t.store.getApplicationUsername(),customerId:t.Braintree.customerId},success:d=>{this.log.info("clientTokenProvider success: "+JSON.stringify(d)),c(d.clientToken)},error:d=>{this.log.info("clientTokenProvider error: "+JSON.stringify(d)),c(t.storeError(d,"ERROR "+d,t.Platform.BRAINTREE,null))}})}}get appStoreDiscountEligibilityDeterminer(){let c;this.log.debug("AppStore eligibility determiner is listening..."),this.store.when().verified(o=>{o.platform===t.Platform.APPLE_APPSTORE&&(this.log.debug("Got a verified AppStore receipt."),c=o)},"appStoreDiscountEligibilityDeterminer_listening");const d=(o,e,n)=>{if(this.log.debug("AppStore eligibility determiner"),c)return this.log.debug("Using cached receipt"),n(s(c,e));const i=l=>{l.platform===t.Platform.APPLE_APPSTORE&&(this.log.debug("Receipt is verified, let's analyze the content and respond."),this.store.off(i),n(s(l,e)))};this.log.debug("Waiting for receipt"),this.store.when().verified(i,"appStoreDiscountEligibilityDeterminer_waiting")};return d.cacheReceipt=function(o){c=o},d;function s(o,e){const n=o.raw.ineligible_for_intro_price;return e.map(i=>{var l;return!("Introductory"===i.discountType&&n&&n.find(r=>i.productId===r)||"Subscription"===i.discountType&&!(null===(l=o.raw.collection)||void 0===l?void 0:l.find(a=>a.id===i.productId)))})}}get validator(){return`${this.config.url}/v1/validate?appName=${this.config.appName}&apiKey=${this.config.apiKey}`}},function(t){let E;var o;(o=E=t.LogLevel||(t.LogLevel={}))[o.QUIET=0]="QUIET",o[o.ERROR=1]="ERROR",o[o.WARNING=2]="WARNING",o[o.INFO=3]="INFO",o[o.DEBUG=4]="DEBUG";class p{constructor(e,n=""){this.prefix="",this.store=e,this.prefix=n||"CdvPurchase"}child(e){return new p(this.store,this.prefix+"."+e)}error(e){s(this.store.verbosity,E.ERROR,this.prefix,e);try{throw new Error(function d(o){return"string"!=typeof o&&(o=JSON.stringify(o)),o}(e))}catch(n){s(this.store.verbosity,E.ERROR,this.prefix,n.stack)}}warn(e){s(this.store.verbosity,E.WARNING,this.prefix,e)}info(e){s(this.store.verbosity,E.INFO,this.prefix,e)}debug(e){s(this.store.verbosity,E.DEBUG,this.prefix,e)}logCallbackException(e,n){this.warn("A callback in '"+e+"' failed with an exception."),"string"==typeof n?this.warn("           "+n):n&&(n.fileName&&this.warn("           "+n.fileName+":"+n.lineNumber),n.message&&this.warn("           "+n.message),n.stack&&this.warn("           "+n.stack))}}p.console=window.console,t.Logger=p;const c=["QUIET","ERROR","WARNING","INFO","DEBUG"];function s(o,e,n,i){if(e>(!0===o?1:o))return;"string"!=typeof i&&(i=JSON.stringify(i));const r=n?`[${n}] `:"";(e===E.ERROR?u=>p.console.error(u):e===E.WARNING?u=>p.console.warn(u):u=>p.console.log(u))(c[e]?`${r}${c[e]}: ${i}`:`${r}${i}`)}}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).nonEnumerable=(c,d,s)=>{if(s)return s.enumerable=!1,s;Object.defineProperty(c,d,{set(o){Object.defineProperty(this,d,{value:o,writable:!0,configurable:!0})},configurable:!0})}}(f||(f={})),function(t){t.Product=class E{constructor(c,d){this.className="Product",this.title="",this.description="",this.platform=c.platform,this.type=c.type,this.id=c.id,this.group=c.group,this.offers=[],Object.defineProperty(this,"pricing",{enumerable:!1,get:()=>{var s;return null===(s=this.offers[0])||void 0===s?void 0:s.pricingPhases[0]}}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>d.canPurchase(this)}),Object.defineProperty(this,"owned",{enumerable:!1,get:()=>d.owned(this)})}get pricing(){var c;return null===(c=this.offers[0])||void 0===c?void 0:c.pricingPhases[0]}get canPurchase(){return!1}get owned(){return!1}getOffer(c=""){return c?this.offers.find(d=>d.id===c):this.offers[0]}addOffer(c){return this.getOffer(c.id)||this.offers.push(c),this}}}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).objectValues=function c(d){const s=[];for(let o in d)d.hasOwnProperty(o)&&s.push(d[o]);return s}}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).platformName=function c(d){switch(d){case t.Platform.APPLE_APPSTORE:return"App Store";case t.Platform.GOOGLE_PLAY:return"Google Play";case t.Platform.WINDOWS_STORE:return"Windows Store";case t.Platform.BRAINTREE:return"Braintree";case t.Platform.TEST:return"Test";default:return d}}}(f||(f={})),function(t){let E;!function(p){class c{constructor(){this.array=[]}get length(){return this.array.length}get(){return this.array.concat()}add(e){this.has(e)||this.array.push(e)}clear(){for(;0!==this.array.length;)this.array.pop()}has(e){return!!this.array.find(n=>n===e)}}p.ReceiptsToValidate=c,p.Validator=class d{constructor(e,n){this.receiptsToValidate=new c,this.verifiedReceipts=[],this.numRequests=0,this.numResponses=0,this.cache={},this.controller=e,this.log=n.child("Validator")}incrRequestsCounter(){this.numRequests=this.numRequests+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}incrResponsesCounter(){this.numResponses=this.numResponses+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}addVerifiedReceipt(e,n){for(const l of this.verifiedReceipts)if(l.platform===e.platform&&l.id===n.id)return this.log.debug("Updating existing receipt."),l.set(e,n),l;this.log.debug("Register a new verified receipt.");const i=new t.VerifiedReceipt(e,n,this.controller);return this.verifiedReceipts.push(i),i}add(e){this.log.debug("Schedule validation: "+JSON.stringify(e));const n=e instanceof t.Transaction?e.parentReceipt:e;this.receiptsToValidate.has(n)||(this.incrRequestsCounter(),this.receiptsToValidate.add(n))}run(){const e=this.receiptsToValidate.get();this.receiptsToValidate.clear();const n=i=>A(this,void 0,void 0,function*(){var l;const{receipt:r,payload:a}=i;this.incrResponsesCounter();try{const u=this.controller.adapters.find(r.platform);if(yield null==u?void 0:u.handleReceiptValidationResponse(r,a),a.ok){const h=this.addVerifiedReceipt(r,a.data);this.controller.verifiedCallbacks.trigger(h,"payload_ok")}else if(a.code===t.ErrorCode.VALIDATOR_SUBSCRIPTION_EXPIRED){const h=null===(l=r.lastTransaction())||void 0===l?void 0:l.transactionId,_=h?this.verifiedReceipts.find(m=>{var g;return(null===(g=m.collection[0])||void 0===g?void 0:g.transactionId)===h}):void 0;_?(null==_||_.collection.forEach(m=>{m.transactionId===h&&(m.isExpired=!0)}),this.controller.verifiedCallbacks.trigger(_,"payload_expired")):this.controller.unverifiedCallbacks.trigger({receipt:r,payload:a},"no_verified_receipt")}else this.controller.unverifiedCallbacks.trigger({receipt:r,payload:a},"validator_error")}catch(u){this.log.error("Exception probably caused by an invalid response from the validator."+u.message),this.controller.unverifiedCallbacks.trigger({receipt:r,payload:{ok:!1,code:t.ErrorCode.VERIFICATION_FAILED,message:u.message}},"validator_exception")}});e.forEach(i=>this.runOnReceipt(i,n))}runOnReceipt(e,n){return A(this,void 0,void 0,function*(){if(e.platform===t.Platform.TEST)return this.log.debug("Using Test Adapter mock verify function."),t.Test.Adapter.verify(e,n);if(!this.controller.validator)return this.incrResponsesCounter(),void n({receipt:e,payload:{ok:!0,data:{id:e.transactions[0].transactionId,latest_receipt:!0,transaction:{type:"test"}}}});const i=yield this.buildRequestBody(e);if(i)return"function"==typeof this.controller.validator?this.runValidatorFunction(this.controller.validator,e,i,n):this.runValidatorRequest("string"==typeof this.controller.validator?{url:this.controller.validator,timeout:2e4}:this.controller.validator,e,i,n);this.incrResponsesCounter()})}runValidatorFunction(e,n,i,l){try{e(i,r=>l({receipt:n,payload:r}))}catch(r){this.log.warn("user provided validator function failed with error: "+(null==r?void 0:r.stack))}}buildRequestBody(e){var n,i,l;return A(this,void 0,void 0,function*(){const r=this.controller.adapters.find(e.platform),a=yield null==r?void 0:r.receiptValidationBody(e);if(a){if(a.additionalData=Object.assign(Object.assign({},null!==(n=a.additionalData)&&void 0!==n?n:{}),{applicationUsername:this.controller.getApplicationUsername()}),a.additionalData.applicationUsername||delete a.additionalData.applicationUsername,a.device=Object.assign(Object.assign({},null!==(i=a.device)&&void 0!==i?i:{}),t.Validator.Internal.getDeviceInfo(this.controller)),1===(null===(l=a.offers)||void 0===l?void 0:l.length)){const u=a.offers[0];if(1===u.pricingPhases.length){const h=u.pricingPhases[0];a.currency=h.currency,a.priceMicros=h.priceMicros}else if(2===u.pricingPhases.length){const h=u.pricingPhases[1];a.currency=h.currency,a.priceMicros=h.priceMicros,a.introPriceMicros=u.pricingPhases[0].priceMicros}}return a}})}removeExpiredCache(){const e=+new Date,n=[];for(const i in this.cache)this.cache[i].expires<e&&n.push(i);for(const i of n)delete this.cache[i]}runValidatorRequest(e,n,i,l){this.removeExpiredCache();const r=t.Utils.md5(JSON.stringify(i.transaction)),a=this.cache[r];if(a)return l({receipt:n,payload:a.payload});t.Utils.ajax(this.log.child("Ajax"),{url:e.url,method:"POST",customHeaders:e.headers,timeout:e.timeout,data:i,success:u=>{var h;if(this.log.debug("validator success, response: "+JSON.stringify(u)),!function s(o){return!!o&&"object"==typeof o&&"ok"in o&&"boolean"==typeof o.ok}(u))return l({receipt:n,payload:{ok:!1,code:t.ErrorCode.BAD_RESPONSE,message:"Validator responded with invalid data",data:{latest_receipt:null===(h=null==u?void 0:u.data)||void 0===h?void 0:h.latest_receipt}}});this.cache[r]={payload:u,expires:+new Date+12e4},l({receipt:n,payload:u})},error:(u,h,_)=>{var m="Error "+u+": "+h;this.log.debug("validator failed, response: "+JSON.stringify(m)),this.log.debug("body => "+JSON.stringify(_)),l({receipt:n,payload:{ok:!1,message:m,code:t.ErrorCode.COMMUNICATION,status:u,data:{}}})}})}}}(E=t.Internal||(t.Internal={}))}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).Adapters=class c{constructor(){this.list=[]}add(s,o,e){o.forEach(n=>{if(s.info(""),!this.find(n.platform))switch(n.platform){case t.Platform.APPLE_APPSTORE:return this.list.push(new t.AppleAppStore.Adapter(e,n.options||{}));case t.Platform.GOOGLE_PLAY:return this.list.push(new t.GooglePlay.Adapter(e));case t.Platform.BRAINTREE:return n.options||s.error("Options missing for Braintree initialization. Use {platform: Platform.BRAINTREE, options: {...}} in your call to store.initialize"),this.list.push(new t.Braintree.Adapter(e,n.options));case t.Platform.TEST:return this.list.push(new t.Test.Adapter(e));default:return}})}initialize(s,o){return A(this,void 0,void 0,function*(){const e=s.map(r=>"string"==typeof r?{platform:r}:r).filter(r=>!this.find(r.platform)),n=o.log.child("Adapters");n.info("Adding platforms: "+JSON.stringify(e)),this.add(n,e,o);const i=o.registeredProducts.byPlatform();return(yield Promise.all(e.map(r=>A(this,void 0,void 0,function*(){var a,u,h;const _=null!==(h=null===(u=null===(a=i.filter(y=>y.platform===r.platform))||void 0===a?void 0:a[0])||void 0===u?void 0:u.products)&&void 0!==h?h:[],m=this.find(r.platform);if(!m)return;if(n.info(`${m.name} initializing...`),!m.isSupported)return void n.info(`${m.name} is not supported.`);const g=yield m.initialize();if(m.ready=!0,n.info(`${m.name} initialized. ${g?JSON.stringify(g):""}`),null!=g&&g.code)return g;if(n.info(`${m.name} products: ${JSON.stringify(_)}`),0===_.length)return;let P=[],R=[];m.supportsParallelLoading?[P,R]=yield Promise.all([m.loadProducts(_),m.loadReceipts()]):(P=yield m.loadProducts(_),R=yield m.loadReceipts()),n.info(`${m.name} products loaded: ${JSON.stringify(P)}`);const T=P.filter(y=>y instanceof t.Product);return o.listener.productsUpdated(r.platform,T),n.info(`${m.name} receipts loaded: ${JSON.stringify(R)}`),P.filter(y=>"code"in y&&"message"in y)[0]})))).filter(r=>r)})}find(s){return this.list.filter(o=>o.id===s)[0]}findReady(s){return this.list.filter(o=>(!s||o.id===s)&&o.ready)[0]}}}(f||(f={})),function(t){let E;!function(p){class c{constructor(s,o){this.supportedPlatforms=[],this.platformWithReceiptsReady=[],this.lastTransactionState={},this.lastCallTimeForState={},this.delegate=s,this.log=o.child("AdapterListener")}static makeTransactionToken(s){return s.platform+"|"+s.transactionId}setSupportedPlatforms(s){this.log.debug(`setSupportedPlatforms: ${s.join(",")} (${this.platformWithReceiptsReady.length} have their receipts ready)`),this.supportedPlatforms=s,this.supportedPlatforms.length===this.platformWithReceiptsReady.length&&(this.log.debug("triggering receiptsReady()"),this.delegate.receiptsReadyCallbacks.trigger(void 0,"adapterListener_setSupportedPlatforms"))}receiptsReady(s){this.supportedPlatforms.length>0&&this.platformWithReceiptsReady.length===this.supportedPlatforms.length?this.log.debug("receiptsReady: "+s+"(skipping)"):this.platformWithReceiptsReady.indexOf(s)<0&&(this.platformWithReceiptsReady.push(s),this.log.debug(`receiptsReady: ${s} (${this.platformWithReceiptsReady.length}/${this.supportedPlatforms.length})`),this.platformWithReceiptsReady.length===this.supportedPlatforms.length&&(this.log.debug("triggering receiptsReady()"),this.delegate.receiptsReadyCallbacks.trigger(void 0,"adapterListener_receiptsReady")))}productsUpdated(s,o){o.forEach(e=>this.delegate.updatedCallbacks.trigger(e,"adapterListener_productsUpdated"))}receiptsUpdated(s,o){const e=+new Date;this.log.debug("receiptsUpdated: "+JSON.stringify(o)),o.forEach(n=>{this.delegate.updatedReceiptCallbacks.trigger(n,"adapterListener_receiptsUpdated"),n.transactions.forEach(i=>{const l=c.makeTransactionToken(i),r=l+"@"+i.state,a=this.lastTransactionState[l];i.state===t.TransactionState.APPROVED?(0|this.lastCallTimeForState[r])<e-6e4&&(this.delegate.approvedCallbacks.trigger(i,"adapterListener_receiptsUpdated_approved"),this.lastCallTimeForState[r]=e):a!==i.state&&(i.state===t.TransactionState.FINISHED?(this.delegate.finishedCallbacks.trigger(i,"adapterListener_receiptsUpdated_finished"),this.lastCallTimeForState[r]=e):i.state===t.TransactionState.PENDING&&(this.delegate.pendingCallbacks.trigger(i,"adapterListener_receiptsUpdated_pending"),this.lastCallTimeForState[r]=e)),this.lastTransactionState[l]=i.state})})}}p.StoreAdapterListener=c}(E=t.Internal||(t.Internal={}))}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).Callbacks=class c{constructor(s,o,e=!1){this.callbacks=[],this.numTriggers=0,this.logger=s,this.className=o,this.finalStateMode=e}push(s,o){if(this.finalStateMode&&this.numTriggers>0)s(this.lastTriggerArgument);else{for(const e of this.callbacks)if(e.callback===s)throw new Error("REGISTERING THE SAME CALLBACK TWICE? This is indicative of a bug in your integration.");this.callbacks.push({callback:s,callbackName:o})}}trigger(s,o){this.lastTriggerArgument=s,this.numTriggers++;const e=this.callbacks;this.finalStateMode&&(this.callbacks=[]),e.forEach(n=>{t.Utils.safeCall(this.logger,this.className,n.callback,s,n.callbackName,o)})}remove(s){this.callbacks=this.callbacks.filter(o=>o.callback!==s)}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).ReadyCallbacks=class c{constructor(s){this.isReady=!1,this.readyCallbacks=[],this.logger=s}add(s){if(this.isReady)return setTimeout(s,0);this.readyCallbacks.push(s)}trigger(s){this.isReady=!0,this.readyCallbacks.forEach(o=>t.Utils.safeCall(this.logger,"ready()",o,void 0,void 0,s)),this.readyCallbacks=[]}remove(s){this.readyCallbacks=this.readyCallbacks.filter(o=>o!==s)}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).RegisteredProducts=class d{constructor(){this.list=[]}find(o,e){return this.list.find(n=>n.platform===o&&n.id===e)}add(o){const e=[],i=(Array.isArray(o)?o:[o]).filter(l=>!this.find(l.platform,l.id));for(const l of i)"object"==typeof(s=l)&&s.hasOwnProperty("platform")&&s.hasOwnProperty("id")&&s.hasOwnProperty("type")?this.list.push(l):e.push(t.storeError(t.ErrorCode.LOAD,'Invalid parameter to "register", expected "id", "type" and "platform". Got: '+JSON.stringify(l),null,null));var s;return e}byPlatform(){const o={};return this.list.forEach(e=>{o[e.platform]=(o[e.platform]||[]).concat(e)}),Object.keys(o).map(e=>({platform:e,products:o[e]}))}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).TransactionStateMonitors=class c{constructor(s){this.monitors=[],s.approved(o=>this.callOnChange(o),"transactionStateMonitors_callOnChange").finished(o=>this.callOnChange(o),"transactionStateMonitors_callOnChange")}findMonitors(s){return this.monitors.filter(o=>o.transaction.platform===s.platform&&o.transaction.transactionId===s.transactionId)}callOnChange(s){this.findMonitors(s).forEach(o=>{o.lastChange!==s.state&&(o.lastChange=s.state,o.onChange(s.state))})}start(s,o){const e=t.Utils.uuidv4();return this.monitors.push({monitorId:e,transaction:s,onChange:o,lastChange:s.state}),setTimeout(o,0,s.state),{transaction:s,stop:()=>this.stop(e)}}stop(s){this.monitors=this.monitors.filter(o=>o.monitorId!==s)}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).ReceiptsMonitor=class c{constructor(s){this.hasCalledReceiptsVerified=!1,this.controller=s,this.log=s.log.child("ReceiptsMonitor")}callReceiptsVerified(){this.hasCalledReceiptsVerified||(this.hasCalledReceiptsVerified=!0,this.log.info("receiptsVerified()"),this.controller.when().receiptsReady(()=>{setTimeout(()=>{this.controller.receiptsVerified()},0)},"receiptsMonitor_callReceiptsVerified"))}launch(){const s=()=>{this.log.debug(`check(${this.controller.numValidationResponses()}/${this.controller.numValidationRequests()})`),this.controller.numValidationRequests()===this.controller.numValidationResponses()&&(void 0!==this.intervalChecker&&(clearInterval(this.intervalChecker),this.intervalChecker=void 0),this.controller.off(s),this.callReceiptsVerified())};this.controller.when().verified(s,"receiptsMonitor_check").unverified(s,"receiptsMonitor_check").receiptsReady(()=>{this.log.debug("receiptsReady..."),(!this.controller.hasLocalReceipts()||!this.controller.hasValidator())&&setTimeout(()=>{s()},0),this.intervalChecker=setInterval(()=>{this.log.debug("keep checking every 10s..."),s()},1e4)},"receiptsMonitor_setup")}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).ExpiryMonitor=(()=>{class d{constructor(o){this.activePurchases={},this.notifiedPurchases={},this.controller=o}launch(){this.interval=setInterval(()=>{var o,e;const n=+new Date;for(const i of this.controller.verifiedReceipts){const l=null!==(o=d.GRACE_PERIOD_MS[i.platform])&&void 0!==o?o:d.GRACE_PERIOD_MS.DEFAULT;for(const r of i.collection)if(r.expiryDate){const a=r.expiryDate+l,u=null!==(e=r.transactionId)&&void 0!==e?e:`${a}`;a>n&&(this.activePurchases[u]=!0),a<n&&this.activePurchases[u]&&!this.notifiedPurchases[u]&&(this.notifiedPurchases[u]=!0,this.controller.onVerifiedPurchaseExpired(r,i))}}},d.INTERVAL_MS)}}return d.INTERVAL_MS=1e4,d.GRACE_PERIOD_MS={DEFAULT:6e4,"ios-appstore":6e4,"android-playstore":3e4},d})()}(f||(f={})),function(t){t.PLUGIN_VERSION="13.10.0",t.Store=class E{constructor(){this.adapters=new t.Internal.Adapters,this.registeredProducts=new t.Internal.RegisteredProducts,this.log=new t.Logger(this),this.verbosity=t.LogLevel.ERROR,this._readyCallbacks=new t.Internal.ReadyCallbacks(this.log),this.updatedCallbacks=new t.Internal.Callbacks(this.log,"productUpdated()"),this.updatedReceiptsCallbacks=new t.Internal.Callbacks(this.log,"receiptUpdated()"),this.approvedCallbacks=new t.Internal.Callbacks(this.log,"approved()"),this.finishedCallbacks=new t.Internal.Callbacks(this.log,"finished()"),this.pendingCallbacks=new t.Internal.Callbacks(this.log,"pending()"),this.verifiedCallbacks=new t.Internal.Callbacks(this.log,"verified()"),this.unverifiedCallbacks=new t.Internal.Callbacks(this.log,"unverified()"),this.receiptsReadyCallbacks=new t.Internal.Callbacks(this.log,"receiptsReady()",!0),this.receiptsVerifiedCallbacks=new t.Internal.Callbacks(this.log,"receiptsVerified()",!0),this.errorCallbacks=new t.Internal.Callbacks(this.log,"error()"),this.initializedHasBeenCalled=!1,this.lastUpdate=0,this.minTimeBetweenUpdates=6e5,this.version=t.PLUGIN_VERSION;const c=this;this.listener=new t.Internal.StoreAdapterListener({updatedCallbacks:this.updatedCallbacks,updatedReceiptCallbacks:this.updatedReceiptsCallbacks,approvedCallbacks:this.approvedCallbacks,finishedCallbacks:this.finishedCallbacks,pendingCallbacks:this.pendingCallbacks,receiptsReadyCallbacks:this.receiptsReadyCallbacks},this.log),this.transactionStateMonitors=new t.Internal.TransactionStateMonitors(this.when()),this._validator=new t.Internal.Validator({adapters:this.adapters,getApplicationUsername:this.getApplicationUsername.bind(this),get localReceipts(){return c.localReceipts},get validator(){return c.validator},get validator_privacy_policy(){return c.validator_privacy_policy},verifiedCallbacks:this.verifiedCallbacks,unverifiedCallbacks:this.unverifiedCallbacks,finish:d=>this.finish(d)},this.log),new t.Internal.ReceiptsMonitor({hasLocalReceipts:()=>this.localReceipts.length>0,hasValidator:()=>!!this.validator,numValidationRequests:()=>this._validator.numRequests,numValidationResponses:()=>this._validator.numResponses,off:this.off.bind(this),when:this.when.bind(this),receiptsVerified:()=>{c.receiptsVerifiedCallbacks.trigger(void 0,"receipts_monitor_controller")},log:this.log}).launch(),this.expiryMonitor=new t.Internal.ExpiryMonitor({get verifiedReceipts(){return c.verifiedReceipts},onVerifiedPurchaseExpired(d,s){c.verify(s.sourceReceipt)}}),this.expiryMonitor.launch()}getAdapter(c){return this.adapters.find(c)}getApplicationUsername(){return this.applicationUsername instanceof Function?this.applicationUsername():this.applicationUsername}register(c){this.registeredProducts.add(c).forEach(s=>{t.store.errorCallbacks.trigger(s,"register_error"),this.log.error(s)})}initialize(c=[this.defaultPlatform()]){return A(this,void 0,void 0,function*(){if(this.initializedHasBeenCalled)return this.log.warn("store.initialized() has been called already."),[];this.log.info("initialize()"),this.initializedHasBeenCalled=!0,this.lastUpdate=+new Date;const d=this,s=this.adapters.initialize(c,{error:this.triggerError.bind(this),get verbosity(){return d.verbosity},getApplicationUsername:()=>d.getApplicationUsername(),get listener(){return d.listener},get log(){return d.log},get registeredProducts(){return d.registeredProducts},apiDecorators:{canPurchase:this.canPurchase.bind(this),owned:this.owned.bind(this),finish:this.finish.bind(this),order:this.order.bind(this),verify:this.verify.bind(this)}});return s.then(()=>{this._readyCallbacks.trigger("initialize_promise_resolved"),this.listener.setSupportedPlatforms(this.adapters.list.filter(o=>o.isSupported).map(o=>o.id))}),s})}refresh(){throw new Error("use store.initialize() or store.update()")}update(){var c;return A(this,void 0,void 0,function*(){if(this.log.info("update()"),!this._readyCallbacks.isReady)return void this.log.warn("Do not call store.update() at startup! It is meant to reload the price of products (if needed) long after initialization.");const d=+new Date;if(this.lastUpdate>d-this.minTimeBetweenUpdates)this.log.info("Skipping store.update() as the last call occurred less than store.minTimeBetweenUpdates millis ago.");else{this.lastUpdate=d;for(const s of this.registeredProducts.byPlatform()){const o=yield null===(c=this.adapters.findReady(s.platform))||void 0===c?void 0:c.loadProducts(s.products);null==o||o.forEach(e=>{e instanceof t.Product&&this.updatedCallbacks.trigger(e,"update_has_loaded_products")})}}})}ready(c){this._readyCallbacks.add(c)}get isReady(){return this._readyCallbacks.isReady}when(){const c={productUpdated:(d,s)=>(this.updatedCallbacks.push(d,s),c),receiptUpdated:(d,s)=>(this.updatedReceiptsCallbacks.push(d,s),c),updated:(d,s)=>(this.updatedCallbacks.push(d,s),this.updatedReceiptsCallbacks.push(d,s),c),approved:(d,s)=>(this.approvedCallbacks.push(d,s),c),pending:(d,s)=>(this.pendingCallbacks.push(d,s),c),finished:(d,s)=>(this.finishedCallbacks.push(d,s),c),verified:(d,s)=>(this.verifiedCallbacks.push(d,s),c),unverified:(d,s)=>(this.unverifiedCallbacks.push(d,s),c),receiptsReady:(d,s)=>(this.receiptsReadyCallbacks.push(d,s),c),receiptsVerified:(d,s)=>(this.receiptsVerifiedCallbacks.push(d,s),c)};return c}off(c){this.updatedCallbacks.remove(c),this.updatedReceiptsCallbacks.remove(c),this.approvedCallbacks.remove(c),this.finishedCallbacks.remove(c),this.pendingCallbacks.remove(c),this.verifiedCallbacks.remove(c),this.unverifiedCallbacks.remove(c),this.receiptsReadyCallbacks.remove(c),this.receiptsVerifiedCallbacks.remove(c),this.errorCallbacks.remove(c),this._readyCallbacks.remove(c)}monitor(c,d,s){return this.transactionStateMonitors.start(c,t.Utils.safeCallback(this.log,"monitor()",d,s,"transactionStateMonitors_stateChanged"))}get products(){return[].concat(...this.adapters.list.map(c=>c.products))}get(c,d){var s;return null===(s=this.adapters.findReady(d))||void 0===s?void 0:s.products.find(o=>o.id===c)}get localReceipts(){return[].concat(...this.adapters.list.map(c=>c.receipts))}get localTransactions(){const c=[];for(const d of this.localReceipts)c.push(...d.transactions);return c}get verifiedReceipts(){return this._validator.verifiedReceipts}get verifiedPurchases(){return t.Internal.VerifiedReceipts.getVerifiedPurchases(this.verifiedReceipts)}findInVerifiedReceipts(c){return t.Internal.VerifiedReceipts.find(this.verifiedReceipts,c)}findInLocalReceipts(c){return t.Internal.LocalReceipts.find(this.localReceipts,c)}canPurchase(c){const d=c instanceof t.Offer?this.get(c.productId,c.platform):c,s=this.adapters.findReady(c.platform);return!(null==s||!s.checkSupport("order"))&&t.Internal.LocalReceipts.canPurchase(this.localReceipts,d)}owned(c){return t.Internal.owned({product:"string"==typeof c?{id:c}:c,verifiedReceipts:this.validator?this.verifiedReceipts:void 0,localReceipts:this.localReceipts})}order(c,d){return A(this,void 0,void 0,function*(){this.log.info(`order(${c.productId})`);const s=this.adapters.findReady(c.platform);if(!s)return t.storeError(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+c.platform+")",c.platform,null);const o=yield s.order(c,d||{});return o&&"isError"in o&&t.store.triggerError(o),o})}requestPayment(c,d){var s,o,e,n,i;const l=this.adapters.findReady(c.platform);if(!l)return t.PaymentRequestPromise.failed(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+c.platform+")",c.platform,null);if(!c.amountMicros){c.amountMicros=0;for(const a of c.items)c.amountMicros+=null!==(o=null===(s=null==a?void 0:a.pricing)||void 0===s?void 0:s.priceMicros)&&void 0!==o?o:0}if(c.currency)for(const a of c.items)if(null!==(n=null==a?void 0:a.pricing)&&void 0!==n&&n.currency){if(c.currency!==a.pricing.currency)return t.PaymentRequestPromise.failed(t.ErrorCode.PAYMENT_INVALID,"Currencies do not match",c.platform,a.id)}else null!=a&&a.pricing&&(a.pricing.currency=c.currency);else for(const a of c.items)null!==(e=null==a?void 0:a.pricing)&&void 0!==e&&e.currency&&(c.currency=a.pricing.currency);if(1===c.items.length){const a=c.items[0];a&&!a.pricing&&(a.pricing={priceMicros:null!==(i=c.amountMicros)&&void 0!==i?i:0,currency:c.currency})}const r=new t.PaymentRequestPromise;return l.requestPayment(c,d).then(a=>{if(r.trigger(a),a instanceof t.Transaction){const h=this.monitor(a,_=>{r.trigger(a),a.state===t.TransactionState.FINISHED&&h.stop()},"requestPayment_onStateChange")}}),r}checkSupport(c,d){const s=this.adapters.find(c);return!!s&&s.checkSupport(d)}verify(c){return A(this,void 0,void 0,function*(){this.log.info(`verify(${c.className})`),this._validator.add(c),setTimeout(()=>this._validator.run(),200)})}finish(c){return A(this,void 0,void 0,function*(){this.log.info(`finish(${c.className})`),(c instanceof t.VerifiedReceipt?c.sourceReceipt.transactions:c instanceof t.Receipt?c.transactions:[c]).forEach(s=>{var o;null===(o=this.adapters.findReady(s.platform))||void 0===o||o.finish(s)})})}restorePurchases(){return A(this,void 0,void 0,function*(){let c;for(const d of this.adapters.list)d.ready&&(c=null!=c?c:yield d.restorePurchases());return c})}manageSubscriptions(c){return A(this,void 0,void 0,function*(){this.log.info("manageSubscriptions()");const d=this.adapters.findReady(c);return d?d.manageSubscriptions():t.storeError(t.ErrorCode.SETUP,"Found no adapter ready to handle 'manageSubscription'",null!=c?c:null,null)})}manageBilling(c){return A(this,void 0,void 0,function*(){this.log.info("manageBilling()");const d=this.adapters.findReady(c);return d?d.manageBilling():t.storeError(t.ErrorCode.SETUP,"Found no adapter ready to handle 'manageBilling'",null!=c?c:null,null)})}defaultPlatform(){switch(window.cordova.platformId){case"android":return t.Platform.GOOGLE_PLAY;case"ios":return t.Platform.APPLE_APPSTORE;default:return t.Platform.TEST}}error(c){this.errorCallbacks.push(c)}triggerError(c){this.errorCallbacks.trigger(c,"triggerError")}}}(f||(f={})),window.cordova?setTimeout(M,0):M(),function(t){let E;var i;let p,c,d,s,o,e,n;(i=E=t.ProductType||(t.ProductType={})).CONSUMABLE="consumable",i.NON_CONSUMABLE="non consumable",i.FREE_SUBSCRIPTION="free subscription",i.PAID_SUBSCRIPTION="paid subscription",i.NON_RENEWING_SUBSCRIPTION="non renewing subscription",i.APPLICATION="application",function(i){i.NON_RECURRING="NON_RECURRING",i.FINITE_RECURRING="FINITE_RECURRING",i.INFINITE_RECURRING="INFINITE_RECURRING"}(p=t.RecurrenceMode||(t.RecurrenceMode={})),function(i){i.PAY_AS_YOU_GO="PayAsYouGo",i.UP_FRONT="UpFront",i.FREE_TRIAL="FreeTrial"}(c=t.PaymentMode||(t.PaymentMode={})),function(i){i.APPLE_APPSTORE="ios-appstore",i.GOOGLE_PLAY="android-playstore",i.WINDOWS_STORE="windows-store-transaction",i.BRAINTREE="braintree",i.TEST="test"}(d=t.Platform||(t.Platform={})),function(i){i.INITIATED="initiated",i.PENDING="pending",i.APPROVED="approved",i.CANCELLED="cancelled",i.FINISHED="finished",i.UNKNOWN_STATE=""}(s=t.TransactionState||(t.TransactionState={})),function(i){i.LAPSE="Lapse",i.RENEW="Renew"}(o=t.RenewalIntent||(t.RenewalIntent={})),function(i){i.NOTIFIED="Notified",i.AGREED="Agreed"}(e=t.PriceConsentStatus||(t.PriceConsentStatus={})),function(i){i.NOT_CANCELED="",i.DEVELOPER="Developer",i.SYSTEM="System",i.SYSTEM_REPLACED="System.Replaced",i.SYSTEM_PRODUCT_UNAVAILABLE="System.ProductUnavailable",i.SYSTEM_BILLING_ERROR="System.BillingError",i.SYSTEM_DELETED="System.Deleted",i.CUSTOMER="Customer",i.CUSTOMER_TECHNICAL_ISSUES="Customer.TechnicalIssues",i.CUSTOMER_PRICE_INCREASE="Customer.PriceIncrease",i.CUSTOMER_COST="Customer.Cost",i.CUSTOMER_FOUND_BETTER_APP="Customer.FoundBetterApp",i.CUSTOMER_NOT_USEFUL_ENOUGH="Customer.NotUsefulEnough",i.CUSTOMER_OTHER_REASON="Customer.OtherReason",i.UNKNOWN="Unknown"}(n=t.CancelationReason||(t.CancelationReason={}))}(f||(f={})),function(t){t.Offer=class E{constructor(c,d){this.className="Offer",this.id=c.id,this.pricingPhases=c.pricingPhases,Object.defineProperty(this,"productId",{enumerable:!0,get:()=>c.product.id}),Object.defineProperty(this,"productType",{enumerable:!0,get:()=>c.product.type}),Object.defineProperty(this,"productGroup",{enumerable:!0,get:()=>c.product.group}),Object.defineProperty(this,"platform",{enumerable:!0,get:()=>c.product.platform}),Object.defineProperty(this,"order",{enumerable:!1,get:()=>s=>d.order(this,s)}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>d.canPurchase(this)})}get productId(){return""}get productType(){return t.ProductType.APPLICATION}get productGroup(){}get platform(){return t.Platform.TEST}order(c){return A(this,void 0,void 0,function*(){})}get canPurchase(){return!1}}}(f||(f={})),function(t){class E{constructor(){this.failedCallbacks=new t.Internal.PromiseLike,this.initiatedCallbacks=new t.Internal.PromiseLike,this.approvedCallbacks=new t.Internal.PromiseLike,this.finishedCallbacks=new t.Internal.PromiseLike,this.cancelledCallback=new t.Internal.PromiseLike}failed(c){return this.failedCallbacks.push(c),this}initiated(c){return this.initiatedCallbacks.push(c),this}approved(c){return this.approvedCallbacks.push(c),this}finished(c){return this.finishedCallbacks.push(c),this}cancelled(c){return this.cancelledCallback.push(c),this}trigger(c){if(c)if("isError"in c)this.failedCallbacks.resolve(c);else switch(c.state){case t.TransactionState.INITIATED:this.initiatedCallbacks.resolve(c);break;case t.TransactionState.APPROVED:this.approvedCallbacks.resolve(c);break;case t.TransactionState.FINISHED:this.finishedCallbacks.resolve(c)}else this.cancelledCallback.resolve();return this}static failed(c,d,s,o){return(new E).trigger(t.storeError(c,d,s,o))}static cancelled(){return(new E).trigger()}static initiated(c){return(new E).trigger(c)}}t.PaymentRequestPromise=E}(f||(f={})),function(t){t.Receipt=class E{constructor(c,d){this.className="Receipt",this.transactions=[],this.platform=c,Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>d.verify(this)}}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>d.finish(this)}})}verify(){return A(this,void 0,void 0,function*(){})}finish(){return A(this,void 0,void 0,function*(){})}hasTransaction(c){return!!this.transactions.find(d=>d===c)}lastTransaction(){return this.transactions[this.transactions.length-1]}}}(f||(f={})),function(t){t.Transaction=class E{constructor(c,d,s){this.className="Transaction",this.transactionId="",this.state=t.TransactionState.UNKNOWN_STATE,this.products=[],this.platform=c,Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>s.finish(this)}}),Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>s.verify(this)}}),Object.defineProperty(this,"parentReceipt",{enumerable:!1,get:()=>d})}finish(){return A(this,void 0,void 0,function*(){})}verify(){return A(this,void 0,void 0,function*(){})}get parentReceipt(){return{}}}}(f||(f={})),function(t){let E;!function(p){class c{static find(s,o){var e,n;if(!o)return;let i;for(const l of s)if(!o.platform||l.platform===o.platform)for(const r of l.transactions)for(const a of r.products)a.id===o.id&&(!i||(null!==(e=r.purchaseDate)&&void 0!==e?e:0)<(null!==(n=i.purchaseDate)&&void 0!==n?n:1))&&(i=r);return i}static isOwned(s,o){if(!o)return!1;const e=c.find(s,o);return!(!e||e.isConsumed||e.isPending)&&(!e.expirationDate||e.expirationDate.getTime()>+new Date)}static canPurchase(s,o){if(!o)return!1;const e=c.find(s,o);return!(e&&!e.isConsumed)||!e.expirationDate||e.expirationDate.getTime()<=+new Date}}p.LocalReceipts=c}(E=t.Internal||(t.Internal={}))}(f||(f={})),function(t){let E;var p;(p=E=t.Internal||(t.Internal={})).owned=function c(d){return void 0!==d.verifiedReceipts?p.VerifiedReceipts.isOwned(d.verifiedReceipts,d.product):void 0!==d.localReceipts&&p.LocalReceipts.isOwned(d.localReceipts,d.product)}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).PromiseLike=class c{constructor(){this.resolved=!1,this.callbacks=[]}push(s){this.resolved?setTimeout(s,0,this.resolvedArgument):this.callbacks.push(s)}resolve(s){this.resolved||(this.resolved=!0,this.resolvedArgument=s,this.callbacks.forEach(o=>setTimeout(o,0,s)),this.callbacks=[])}}}(f||(f={})),function(t){let E;(E=t.Internal||(t.Internal={})).Retry=class c{constructor(s=5e3,o=12e4){this.maxTimeout=12e4,this.minTimeout=5e3,this.retryTimeout=5e3,this.retries=[],this.minTimeout=s,this.maxTimeout=o,this.retryTimeout=s,document.addEventListener("online",()=>{const e=this.retries;this.retries=[],this.retryTimeout=this.minTimeout;for(var n=0;n<e.length;++n)clearTimeout(e[n].tid),e[n].fn.call(this)},!1)}retry(s){var o=setTimeout(()=>{this.retries=this.retries.filter(function(e){return o!==e.tid}),s()},this.retryTimeout);this.retries.push({tid:o,fn:s}),this.retryTimeout*=2,this.retryTimeout>this.maxTimeout&&(this.retryTimeout=this.maxTimeout)}}}(f||(f={})),function(t){let E;!function(p){class c{static find(s,o){var e,n;if(!o)return;let i;for(const l of s)if(!o.platform||l.platform===o.platform)for(const r of l.collection)r.id===o.id&&(null!==(e=null==i?void 0:i.purchaseDate)&&void 0!==e?e:0)<(null!==(n=r.purchaseDate)&&void 0!==n?n:1)&&(i=r);return i}static isOwned(s,o){if(!o)return!1;const e=c.find(s,o);return!(!e||null!=e&&e.isExpired)&&(null==e||!e.expiryDate||e.expiryDate>+new Date)}static getVerifiedPurchases(s){var o,e,n,i;const l={};for(const r of s)for(const a of r.collection){const u=r.platform+":"+a.id,h=l[u];(!h||h&&(null!==(e=null!==(o=h.lastRenewalDate)&&void 0!==o?o:h.purchaseDate)&&void 0!==e?e:0)<(null!==(i=null!==(n=a.lastRenewalDate)&&void 0!==n?n:a.purchaseDate)&&void 0!==i?i:0))&&(l[u]=Object.assign(Object.assign({},a),{platform:r.platform}))}return Object.keys(l).map(r=>l[r])}}p.VerifiedReceipts=c}(E=t.Internal||(t.Internal={}))}(f||(f={})),function(t){let E;!function(p){let c;var o;let d,s;(o=c=p.ContactField||(p.ContactField={})).Name="name",o.EmailAddress="emailAddress",o.PhoneNumber="phoneNumber",o.PostalAddress="postalAddress",o.PhoneticName="phoneticName",function(o){o.Amex="Amex",o.Barcode="Barcode",o.CartesBancaires="CartesBancaires",o.ChinaUnionPay="ChinaUnionPay",o.Dankort="Dankort",o.Discover="Discover",o.Eftpos="Eftpos",o.Electron="Electron",o.Elo="Elo",o.Girocard="Girocard",o.IDCredit="IDCredit",o.Interac="Interac",o.JCB="JCB",o.Mada="Mada",o.Maestro="Maestro",o.MasterCard="MasterCard",o.Mir="Mir",o.Nanaco="Nanaco",o.PrivateLabel="PrivateLabel",o.QuicPay="QuicPay",o.Suica="Suica",o.Visa="Visa",o.VPay="VPay",o.Waon="Waon"}(d=p.PaymentNetwork||(p.PaymentNetwork={})),function(o){o.ThreeDS="3DS",o.EMV="EMV",o.Credit="Credit",o.Debit="Debit"}(s=p.MerchantCapability||(p.MerchantCapability={}))}(E=t.ApplePay||(t.ApplePay={}))}(f||(f={})),function(t){let E;!function(p){function c(o){return`virtual.${o}`}function s(o,e,n){return t.storeError(o,e,t.Platform.APPLE_APPSTORE,n)}p.Adapter=class d{constructor(e,n){var i,l;this.id=t.Platform.APPLE_APPSTORE,this.name="AppStore",this.ready=!1,this._canMakePayments=!1,this.forceReceiptReload=!1,this._products=[],this.validProducts={},this._paymentMonitor=()=>{},this.supportsParallelLoading=!0,this._appStoreReceiptLoading=!1,this._appStoreReceiptCallbacks=[],this.context=e,this.bridge=new p.Bridge.Bridge,this.log=e.log.child("AppleAppStore"),this.discountEligibilityDeterminer=n.discountEligibilityDeterminer,this.needAppReceipt=null===(i=n.needAppReceipt)||void 0===i||i,this.autoFinish=null!==(l=n.autoFinish)&&void 0!==l&&l,this.pseudoReceipt=new t.Receipt(t.Platform.APPLE_APPSTORE,this.context.apiDecorators),this.receiptsUpdated=t.Utils.debounce(()=>{this._receiptsUpdated()},300)}get products(){return this._products}getProduct(e){return this._products.find(n=>n.id===e)}get receipts(){return this.isSupported?(this._receipt?[this._receipt]:[]).concat(this.pseudoReceipt?this.pseudoReceipt:[]):[]}addValidProducts(e,n){n.forEach(i=>{const l=e.find(r=>r.id===i.id);l&&(this.validProducts[i.id]=Object.assign(Object.assign({},i),l))})}get isSupported(){return"ios"===window.cordova.platformId}upsertTransactionInProgress(e,n){const i=c(e);return new Promise(l=>{const r=this.pseudoReceipt.transactions.find(a=>a.transactionId===i);if(r)r.state=n,r.refresh(e),l(r);else{const a=new p.SKTransaction(t.Platform.APPLE_APPSTORE,this.pseudoReceipt,this.context.apiDecorators);a.state=n,a.transactionId=i,a.refresh(e),this.pseudoReceipt.transactions.push(a),l(a)}})}removeTransactionInProgress(e){const n=c(e);this.pseudoReceipt.transactions=this.pseudoReceipt.transactions.filter(i=>i.transactionId!==n)}upsertTransaction(e,n,i){return A(this,void 0,void 0,function*(){return new Promise(l=>{this.initializeAppReceipt(()=>{var r;if(!this._receipt)return void this.log.warn("Failed to load the application receipt, cannot proceed with handling the purchase");const a=null===(r=this._receipt)||void 0===r?void 0:r.transactions.find(u=>u.transactionId===n);if(a)a.state=i,a.refresh(e),l(a);else{const u=new p.SKTransaction(t.Platform.APPLE_APPSTORE,this._receipt,this.context.apiDecorators);u.state=i,u.transactionId=n,u.refresh(e),this._receipt.transactions.push(u),l(u)}})})})}removeTransaction(e){this._receipt&&(this._receipt.transactions=this._receipt.transactions.filter(n=>n.transactionId!==e))}_receiptsUpdated(){this._receipt?(this.log.debug("receipt updated and ready."),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this._receipt,this.pseudoReceipt]),this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE)):(this.log.debug("receipt updated."),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]))}setPaymentMonitor(e){this._paymentMonitor=e}callPaymentMonitor(e,n,i){this._paymentMonitor(e)}initialize(){return new Promise(e=>{this.log.info("bridge.init");const n=this.log.child("Bridge");this.bridge.init({autoFinish:this.autoFinish,debug:this.context.verbosity===t.LogLevel.DEBUG,log:i=>n.debug(i),error:(i,l,r)=>{this.log.error("ERROR: "+i+" - "+l),i!==t.ErrorCode.PAYMENT_CANCELLED?this.context.error(s(i,l,(null==r?void 0:r.productId)||null)):this.callPaymentMonitor("cancelled",t.ErrorCode.PAYMENT_CANCELLED,l)},ready:()=>{this.log.info("ready")},purchased:(i,l,r,a,u)=>A(this,void 0,void 0,function*(){this.log.info("purchase: id:"+i+" product:"+l+" originalTransaction:"+r+" - date:"+a+" - discount:"+u),(yield this.upsertTransaction(l,i,t.TransactionState.APPROVED)).refresh(l,r,a,u),this.removeTransactionInProgress(l),this.receiptsUpdated(),this.callPaymentMonitor("purchased")}),purchaseEnqueued:(i,l)=>A(this,void 0,void 0,function*(){this.log.info("purchaseEnqueued: "+i+" - "+l),yield this.upsertTransactionInProgress(i,t.TransactionState.INITIATED),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt])}),purchaseFailed:(i,l,r)=>{this.log.info("purchaseFailed: "+i+" - "+l+" - "+r),this.removeTransactionInProgress(i),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("failed",l,r)},purchasing:i=>A(this,void 0,void 0,function*(){this.log.info("purchasing: "+i),yield this.upsertTransactionInProgress(i,t.TransactionState.INITIATED),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt])}),deferred:i=>A(this,void 0,void 0,function*(){this.log.info("deferred: "+i),yield this.upsertTransactionInProgress(i,t.TransactionState.PENDING),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("deferred")}),finished:(i,l)=>A(this,void 0,void 0,function*(){this.log.info("finish: "+i+" - "+l),this.removeTransactionInProgress(l),yield this.upsertTransaction(l,i,t.TransactionState.FINISHED),this.receiptsUpdated()}),restored:(i,l)=>A(this,void 0,void 0,function*(){this.log.info("restore: "+i+" - "+l),yield this.upsertTransaction(l,i,t.TransactionState.APPROVED),this.receiptsUpdated()}),receiptsRefreshed:i=>{this.log.info("receiptsRefreshed"),this._receipt&&this._receipt.refresh(i,this.needAppReceipt,this.context.apiDecorators)},restoreFailed:i=>{this.log.info("restoreFailed: "+i),this.onRestoreCompleted&&(this.onRestoreCompleted(s(i,"Restore purchases failed",null)),this.onRestoreCompleted=void 0)},restoreCompleted:()=>{this.log.info("restoreCompleted"),this.onRestoreCompleted&&(this.onRestoreCompleted(void 0),this.onRestoreCompleted=void 0)}},()=>A(this,void 0,void 0,function*(){this.log.info("bridge.init done"),yield this.canMakePayments(),e(void 0)}),(i,l)=>{this.log.info("bridge.init failed: "+i+" - "+l),e(s(i,l,null))})})}loadReceipts(){return new Promise(e=>{setTimeout(()=>{this.initializeAppReceipt(()=>{this.receiptsUpdated(),e(this._receipt?[this._receipt,this.pseudoReceipt]:[this.pseudoReceipt])})},300)})}canMakePayments(){return A(this,void 0,void 0,function*(){return new Promise(e=>{this.bridge.canMakePayments(()=>{this._canMakePayments=!0,e(!0)},n=>{this.log.warn(`canMakePayments: ${n}`),this._canMakePayments=!1,e(!1)})})})}initializeAppReceipt(e){return A(this,void 0,void 0,function*(){if(this._receipt)return this.log.debug("initializeAppReceipt() => already initialized."),e(void 0);if(this._appStoreReceiptCallbacks.push(e),this._appStoreReceiptLoading)return void this.log.debug("initializeAppReceipt() => already loading.");this._appStoreReceiptLoading=!0;const n=yield this.loadAppStoreReceipt(),i=l=>{const r=this._appStoreReceiptCallbacks;this._appStoreReceiptCallbacks=[],r.forEach(a=>{a(l)})};if(null==n||!n.appStoreReceipt)return this.log.warn("no appStoreReceipt"),this._appStoreReceiptLoading=!1,void i(s(t.ErrorCode.REFRESH,"No appStoreReceipt",null));this._receipt=new p.SKApplicationReceipt(n,this.needAppReceipt,this.context.apiDecorators),i(void 0)})}prepareReceipt(e){null!=e&&e.appStoreReceipt&&(this._receipt?this._receipt.refresh(e,this.needAppReceipt,this.context.apiDecorators):this._receipt=new p.SKApplicationReceipt(e,this.needAppReceipt,this.context.apiDecorators))}loadAppStoreReceipt(){return A(this,void 0,void 0,function*(){let e=!1;return new Promise(n=>{var i;if(null!==(i=this.bridge.appStoreReceipt)&&void 0!==i&&i.appStoreReceipt&&!this.forceReceiptReload)return this.log.debug("using cached appstore receipt"),n(this.bridge.appStoreReceipt);this.log.debug("loading appstore receipt..."),this.forceReceiptReload=!1,this.bridge.loadReceipts(l=>{this.log.debug("appstore receipt loaded"),e||n(l),e=!0},(l,r)=>{this.log.warn("Failed to load appStoreReceipt: "+l+" - "+r),e||n(void 0),e=!0}),setTimeout(function(){e||n(void 0),e=!0},5e3)}).then(n=>(this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE),n)).catch(n=>(this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE),n))})}loadEligibility(e){return A(this,void 0,void 0,function*(){if(this.log.debug("load eligibility: "+JSON.stringify(e)),!this.discountEligibilityDeterminer)return this.log.debug("No discount eligibility determiner, skipping..."),new p.Internal.DiscountEligibilities([],[]);const n=[];if(e.forEach(i=>{var l,r,a;null===(l=i.discounts)||void 0===l||l.forEach(u=>{n.push({productId:i.id,discountId:u.id,discountType:u.type})}),0===(null!==(a=null===(r=i.discounts)||void 0===r?void 0:r.length)&&void 0!==a?a:0)&&i.introPrice&&n.push({productId:i.id,discountId:"intro",discountType:"Introductory"})}),n.length>0){const i=yield this.loadAppStoreReceipt();if(!i||!i.appStoreReceipt)return this.log.debug("no receipt, assuming introductory price are available."),new p.Internal.DiscountEligibilities(n,n.map(l=>"Introductory"===l.discountType));{this.log.debug("calling discount eligibility determiner.");const l=yield this.callDiscountEligibilityDeterminer(i,n);return this.log.debug("response: "+JSON.stringify(l)),new p.Internal.DiscountEligibilities(n,l)}}return new p.Internal.DiscountEligibilities([],[])})}callDiscountEligibilityDeterminer(e,n){return new Promise(i=>{if(!this.discountEligibilityDeterminer)return i([]);this.discountEligibilityDeterminer(e,n,i)})}loadProducts(e){return new Promise(n=>{this.log.info("bridge.load"),this.bridge.load(e.map(i=>i.id),(i,l)=>A(this,void 0,void 0,function*(){this.log.info("bridge.loaded: "+JSON.stringify({validProducts:i,invalidProducts:l})),this.addValidProducts(e,i);const r=yield this.loadEligibility(i);this.log.info("eligibilities ready: "+JSON.stringify(r));const a=e.map(u=>{if(l.indexOf(u.id)>=0)return this.log.debug(`${u.id} is invalid`),s(t.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #400",u.id);{const h=i.find(m=>m.id===u.id);if(this.log.debug(`${u.id} is valid: ${JSON.stringify(h)}`),!h)return s(t.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #404",u.id);let _=this.getProduct(u.id);return _?(this.log.debug("refreshing existing product"),null==_||_.refresh(h,this.context.apiDecorators,r)):(this.log.debug("registering new product"),_=new p.SKProduct(h,u,this.context.apiDecorators,r),this._products.push(_)),_}});this.log.debug(`Products loaded: ${JSON.stringify(a)}`),n(a)}),(i,l)=>e.map(r=>s(i,l,null)))})}order(e,n){return A(this,void 0,void 0,function*(){let i=!1;return new Promise(l=>{var r;const a=g=>{i||(this.setPaymentMonitor(()=>{}),i=!0,l(g))};this.log.info("order");const u=e.id!==p.DEFAULT_OFFER_ID?e.id:void 0,h=null===(r=null==n?void 0:n.appStore)||void 0===r?void 0:r.discount;return u&&!h?a(s(t.ErrorCode.MISSING_OFFER_PARAMS,"Missing additionalData.appStore.discount when ordering a discount offer",e.productId)):u&&(null==h?void 0:h.id)!==u?a(s(t.ErrorCode.INVALID_OFFER_IDENTIFIER,"Offer identifier does not match additionalData.appStore.discount.id",e.productId)):(this.setPaymentMonitor((g,P,R)=>{if(this.log.info("order.paymentMonitor => "+g+" "+(null!=P?P:"")+" "+(null!=R?R:"")),!i)switch(g){case"cancelled":a(s(null!=P?P:t.ErrorCode.PAYMENT_CANCELLED,null!=R?R:"The user cancelled the order.",e.productId));break;case"failed":setTimeout(()=>{a(s(null!=P?P:t.ErrorCode.PURCHASE,null!=R?R:"Purchase failed",e.productId))},500);break;case"purchased":case"deferred":a(void 0)}}),this.forceReceiptReload=!0,void this.bridge.purchase(e.productId,1,this.context.getApplicationUsername(),h,()=>{this.log.info("order.success")},()=>{this.log.info("order.error"),a(s(t.ErrorCode.PURCHASE,"Failed to place order",e.productId))}))})})}finish(e){return new Promise(n=>{if(this.log.info("finish("+e.transactionId+")"),e.transactionId===p.APPLICATION_VIRTUAL_TRANSACTION_ID||e.transactionId===c(e.products[0].id))return e.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[e.parentReceipt]),n(void 0);const i=()=>{e.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[e.parentReceipt]),n(void 0)};this.bridge.finish(e.transactionId,i,r=>{var a,u;null!=r&&r.includes("[#CdvPurchase:100]")?i():n(s(t.ErrorCode.FINISH,"Failed to finish transaction",null!==(u=null===(a=e.products[0])||void 0===a?void 0:a.id)&&void 0!==u?u:null))})})}refreshReceipt(){return new Promise(e=>{this.bridge.refreshReceipts(l=>{e(l)},(l,r)=>{e(s(l,r,null))})})}receiptValidationBody(e){return A(this,void 0,void 0,function*(){if(e.platform!==t.Platform.APPLE_APPSTORE||e!==this._receipt)return;const n=e;let i=n.nativeData;if(this.forceReceiptReload){const r=yield this.loadAppStoreReceipt();this.forceReceiptReload=!1,r&&(i=r,this.prepareReceipt(r))}if(!n.nativeData.appStoreReceipt){this.log.info("Cannot prepare the receipt validation body, because appStoreReceipt is missing. Refreshing...");const r=yield this.refreshReceipt();if(!r||"isError"in r)return this.log.warn("Failed to refresh receipt, cannot run receipt validation."),void(r&&this.log.error(r));this.log.info("Receipt refreshed."),i=r}const l=n.transactions.slice(-1)[0];return{id:i.bundleIdentifier,type:t.ProductType.APPLICATION,products:t.Utils.objectValues(this.validProducts).map(r=>new p.SKProduct(r,r,this.context.apiDecorators,{isEligible:()=>!0})),transaction:{type:"ios-appstore",id:null==l?void 0:l.transactionId,appStoreReceipt:i.appStoreReceipt}}})}handleReceiptValidationResponse(e,n){var i,l;return A(this,void 0,void 0,function*(){let r=!1;if(n.ok){const a=null===(i=n.data)||void 0===i?void 0:i.transaction;"ios-appstore"===(null==a?void 0:a.type)&&"original_application_version"in a&&(null===(l=this._receipt)||void 0===l||l.transactions.forEach(u=>{u.transactionId===p.APPLICATION_VIRTUAL_TRANSACTION_ID&&a.original_purchase_date_ms&&(u.purchaseDate=new Date(parseInt(a.original_purchase_date_ms)),r=!0)}))}r&&this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[e])})}requestPayment(e,n){return A(this,void 0,void 0,function*(){return s(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.bridge.manageSubscriptions()})}manageBilling(){return A(this,void 0,void 0,function*(){this.bridge.manageBilling()})}checkSupport(e){return"order"===e?this._canMakePayments:["order","manageBilling","manageSubscriptions"].indexOf(e)>=0}restorePurchases(){return new Promise(e=>{this.onRestoreCompleted=n=>{this.onRestoreCompleted=void 0,this.bridge.refreshReceipts(i=>{e(n)},(i,l)=>{e(n||s(i,l,null))})},this.forceReceiptReload=!0,this.bridge.restore()})}presentCodeRedemptionSheet(){return new Promise(e=>{this.bridge.presentCodeRedemptionSheet(e)})}}}(E=t.AppleAppStore||(t.AppleAppStore={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){const s=l=>{};let o=s;function e(l,r,a,u){window.cordova.exec(a,u,"InAppPurchase",l,r)}function n(l,r,...a){if(l)try{l.apply(this,a)}catch(u){o("exception in "+r+': "'+u+'"')}}d.Bridge=class i{constructor(){this.transactionsForProduct={},this.initialized=!1,this.registeredProducts=[],this.needRestoreNotification=!1,this.pendingUpdates=[],this.onPurchased=!1,this.onFailed=!1,this.onRestored=!1,window.storekit=this,this.options={error:s,ready:s,purchased:s,purchaseEnqueued:s,purchasing:s,purchaseFailed:s,deferred:s,finished:s,restored:s,receiptsRefreshed:s,restoreFailed:s,restoreCompleted:s}}init(r,a,u){this.options={error:r.error||s,ready:r.ready||s,purchased:r.purchased||s,purchaseEnqueued:r.purchaseEnqueued||s,purchasing:r.purchasing||s,purchaseFailed:r.purchaseFailed||s,deferred:r.deferred||s,finished:r.finished||s,restored:r.restored||s,receiptsRefreshed:r.receiptsRefreshed||s,restoreFailed:r.restoreFailed||s,restoreCompleted:r.restoreCompleted||s},r.debug&&(e("debug",[],s,s),o=r.log||function(m){console.log("[CdvPurchase.AppAppStore.Bridge] "+m)}),r.autoFinish&&e("autoFinish",[],s,s),e("setup",[],()=>{o("setup ok"),n(this.options.ready,"options.ready"),n(a,"init.success"),this.initialized=!0,setTimeout(()=>this.processPendingTransactions(),50)},m=>{o("setup failed"),n(u,"init.error",t.ErrorCode.SETUP,"Setup failed: "+m)})}processPendingTransactions(){o("processing pending transactions"),e("processPendingTransactions",[],()=>{this.finalizeTransactionUpdates()},void 0)}purchase(r,a,u,h,_,m){a=0|a||1;const g=this.options;if(this.registeredProducts.indexOf(r)<0)return o("Purchasing "+r+" failed.  Ensure the product was loaded first with Bridge.load(...)!"),void("function"==typeof g.error&&n(g.error,"options.error",t.ErrorCode.PURCHASE,"Trying to purchase a unknown product.",{productId:r,quantity:a}));e("purchase",[r,a,u,h||{}],()=>{o("Purchase enqueued "+r),"function"==typeof g.purchaseEnqueued&&n(g.purchaseEnqueued,"options.purchaseEnqueued",r,a),n(_,"purchase.success")},()=>{const T="Purchase failed: "+r;o(T),"function"==typeof g.error&&n(g.error,"options.error",t.ErrorCode.PURCHASE,T,{productId:r,quantity:a}),n(m,"purchase.error")})}canMakePayments(r,a){return e("canMakePayments",[],r,a)}restore(r){this.needRestoreNotification=!0,e("restoreCompletedTransactions",[],r,r)}manageSubscriptions(r){e("manageSubscriptions",[],r,r)}manageBilling(r){e("manageBilling",[],r,r)}presentCodeRedemptionSheet(r){e("presentCodeRedemptionSheet",[],r,r)}load(r,a,u){const h=this.options;if("string"==typeof r&&(r=[r]),r)if(r.length){if("string"!=typeof r[0]){const g="invalid productIds given to store.load: "+JSON.stringify(r);return o(g),n(h.error,"options.error",t.ErrorCode.LOAD,g),void n(u,"load.error",t.ErrorCode.LOAD,g)}o("load "+JSON.stringify(r));const _=g=>{const P=g[0],R=g[1];o("load ok: { valid:"+JSON.stringify(P)+" invalid:"+JSON.stringify(R)+" }"),n(a,"load.success",P,R)},m=g=>{o("load failed"),o(g);const P="Load failed: "+g;n(h.error,"options.error",t.ErrorCode.LOAD,P),n(u,"load.error",t.ErrorCode.LOAD,P)};this.registeredProducts=this.registeredProducts.concat(r),e("load",[r],_,m)}else n(a,"load.success",[],[]);else n(a,"load.success",[],[])}finish(r,a,u){e("finishTransaction",[r],a,u)}finalizeTransactionUpdates(){for(let r=0;r<this.pendingUpdates.length;++r){const a=this.pendingUpdates[r];this.transactionUpdated(a.state,a.errorCode,a.errorText,a.transactionIdentifier,a.productId,a.transactionReceipt,a.originalTransactionIdentifier,a.transactionDate,a.discountId)}this.pendingUpdates=[]}lastTransactionUpdated(){}transactionUpdated(r,a,u,h,_,m,g,P,R){if(this.initialized)switch(o("transaction updated:"+h+" state:"+r+" product:"+_),_&&h&&(this.transactionsForProduct[_]?this.transactionsForProduct[_].push(h):this.transactionsForProduct[_]=[h]),r){case"PaymentTransactionStatePurchasing":return void n(this.options.purchasing,"options.purchasing",_);case"PaymentTransactionStatePurchased":return void n(this.options.purchased,"options.purchase",h,_,g,P,R);case"PaymentTransactionStateDeferred":return void n(this.options.deferred,"options.deferred",_);case"PaymentTransactionStateFailed":return n(this.options.purchaseFailed,"options.purchaseFailed",_,a||t.ErrorCode.UNKNOWN,u||"ERROR"),void n(this.options.error,"options.error",a||t.ErrorCode.UNKNOWN,u||"ERROR",{productId:_});case"PaymentTransactionStateRestored":return void n(this.options.restored,"options.restore",h,_);case"PaymentTransactionStateFinished":return void n(this.options.finished,"options.finish",h,_)}else this.pendingUpdates.push({state:r,errorCode:a,errorText:u,transactionIdentifier:h,productId:_,transactionReceipt:m,originalTransactionIdentifier:g,transactionDate:P,discountId:R})}restoreCompletedTransactionsFinished(){this.needRestoreNotification&&(this.needRestoreNotification=!1,n(this.options.restoreCompleted,"options.restoreCompleted"))}restoreCompletedTransactionsFailed(r){this.needRestoreNotification&&(this.needRestoreNotification=!1,n(this.options.restoreFailed,"options.restoreFailed",r))}parseReceiptArgs(r){const a=r[0],u=r[1],h=r[2],_=r[3],m=r[4];return o("infoPlist: "+u+","+h+","+_+","+m),{appStoreReceipt:a,bundleIdentifier:u,bundleShortVersion:h,bundleNumericVersion:_,bundleSignature:m}}refreshReceipts(r,a){this.appStoreReceipt=null,o("refreshing appStoreReceipt"),e("appStoreRefreshReceipt",[],_=>{const m=this.parseReceiptArgs(_);this.appStoreReceipt=m,n(this.options.receiptsRefreshed,"options.receiptsRefreshed",m),n(r,"refreshReceipts.success",m)},_=>{o("refresh receipt failed: "+_),_.includes("(@AMSErrorDomain:100)")&&o('authentication failed, indicated by the string "(@AMSErrorDomain:100)"'),n(this.options.error,"options.error",t.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+_),n(a,"refreshReceipts.error",t.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+_)})}loadReceipts(r,a){o("loading appStoreReceipt"),e("appStoreReceipt",[],_=>{const m=this.parseReceiptArgs(_);this.appStoreReceipt=m,n(r,"loadReceipts.callback",m)},_=>{})}}}(c=p.Bridge||(p.Bridge={}))}(E=t.AppleAppStore||(t.AppleAppStore={}))}(f||(f={})),function(t){let E;!function(p){let c;(c=p.Internal||(p.Internal={})).DiscountEligibilities=class s{constructor(e,n){this.request=e,this.response=n}isEligible(e,n,i){var l;for(let r=0;r<this.request.length;++r){const a=this.request[r];if(a.productId===e&&a.discountId===i&&a.discountType===n)return null!==(l=this.response[r])&&void 0!==l&&l}return!0}}}(E=t.AppleAppStore||(t.AppleAppStore={}))}(f||(f={})),function(t){let E;!function(p){p.DEFAULT_OFFER_ID="$";class c extends t.Offer{constructor(o,e){super(o,e),this.offerType=o.offerType}}p.SKOffer=c,p.SKProduct=class d extends t.Product{constructor(o,e,n,i){super(e,n),this.raw=o,this.refresh(o,n,i)}removeIneligibleDiscounts(o){this.offers=this.offers.filter(e=>"Default"===e.offerType||o.isEligible(this.id,e.offerType,e.id))}refresh(o,e,n){var i;this.raw=o,this.title=o.title,this.description=o.description,this.countryCode=o.countryCode,o.group&&(this.group=o.group),this.removeIneligibleDiscounts(n);const l={price:o.price,priceMicros:o.priceMicros,currency:o.currency,billingPeriod:a(o.billingPeriod,o.billingPeriodUnit),paymentMode:this.type===t.ProductType.PAID_SUBSCRIPTION?t.PaymentMode.PAY_AS_YOU_GO:t.PaymentMode.UP_FRONT,recurrenceMode:this.type===t.ProductType.PAID_SUBSCRIPTION?t.RecurrenceMode.INFINITE_RECURRING:t.RecurrenceMode.NON_RECURRING};if(null===(i=o.discounts)||void 0===i||i.forEach(u=>{if(n.isEligible(o.id,u.type,u.id)){const h=[],_=u.paymentMode===t.PaymentMode.PAY_AS_YOU_GO?u.period:1,g={price:u.price,priceMicros:u.priceMicros,currency:o.currency,billingPeriod:a(u.paymentMode===t.PaymentMode.PAY_AS_YOU_GO?1:u.period,u.periodUnit),billingCycles:_,paymentMode:u.paymentMode,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING};h.push(g),h.push(l),this.addOffer(new c({id:u.id,product:this,pricingPhases:h,offerType:u.type},e))}}),!function r(u){return u.offers.filter(h=>"Introductory"===h.offerType||"Default"===h.offerType&&h.pricingPhases.length>1).length>0}(this)){const u=[];if(o.introPrice&&void 0!==o.introPriceMicros&&n.isEligible(o.id,"Introductory","intro")){const h={price:o.introPrice,priceMicros:o.introPriceMicros,currency:o.currency,billingPeriod:a(o.introPricePeriod,o.introPricePeriodUnit),paymentMode:o.introPricePaymentMode,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING,billingCycles:1};u.push(h)}u.push(l),this.addOffer(new c({id:p.DEFAULT_OFFER_ID,product:this,pricingPhases:u,offerType:"Default"},e))}function a(u,h){if(u&&h)return`P${u}${h[0]}`}}}}(E=t.AppleAppStore||(t.AppleAppStore={}))}(f||(f={})),function(t){let E;var p;(p=E=t.AppleAppStore||(t.AppleAppStore={})).APPLICATION_VIRTUAL_TRANSACTION_ID="appstore.application",p.SKApplicationReceipt=class c extends t.Receipt{constructor(o,e,n){super(t.Platform.APPLE_APPSTORE,n),this.nativeData=o,this.refresh(this.nativeData,e,n)}refresh(o,e,n){if(this.nativeData=o,e){if(this.transactions.find(r=>r.transactionId===p.APPLICATION_VIRTUAL_TRANSACTION_ID))return;const l=new t.Transaction(t.Platform.APPLE_APPSTORE,this,n);l.transactionId=p.APPLICATION_VIRTUAL_TRANSACTION_ID,l.state=t.TransactionState.APPROVED,l.products.push({id:o.bundleIdentifier}),this.transactions.push(l)}}},p.SKTransaction=class d extends t.Transaction{refresh(o,e,n,i){o&&(this.products=[{id:o,offerId:i}]),e&&(this.originalTransactionId=e),n&&(this.purchaseDate=new Date(+n))}}}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var o;(o=s=d.AppleExpirationIntent||(d.AppleExpirationIntent={})).CANCELED="1",o.BILLING_ERROR="2",o.PRICE_INCREASE="3",o.PRODUCT_NOT_AVAILABLE="4",o.UNKNOWN="5"}(c=p.VerifyReceipt||(p.VerifyReceipt={}))}(E=t.AppleAppStore||(t.AppleAppStore={}))}(f||(f={})),function(t){let E;!function(p){class c extends t.Receipt{constructor(r,a,u){var h,_,m;super(t.Platform.BRAINTREE,u);const g=new t.Transaction(t.Platform.BRAINTREE,this,u);g.purchaseDate=new Date,g.products=(null===(h=r.items)||void 0===h?void 0:h.filter(P=>P).map(P=>({id:(null==P?void 0:P.id)||""})))||[],g.state=t.TransactionState.APPROVED,g.transactionId=null!==(m=null===(_=a.paymentMethodNonce)||void 0===_?void 0:_.nonce)&&void 0!==m?m:`UNKNOWN_${a.paymentMethodType}_${a.paymentDescription}`,this.transactions=[g],this.dropInResult=a,this.paymentRequest=r,this.refresh(r,a,u)}refresh(r,a,u){var h,_;this.dropInResult=a,this.paymentRequest=r;const m=new t.Transaction(t.Platform.BRAINTREE,this,u);m.products=r.items.filter(g=>g).map(g=>({id:(null==g?void 0:g.id)||""})),m.state=t.TransactionState.APPROVED,m.transactionId=null!==(_=null===(h=a.paymentMethodNonce)||void 0===h?void 0:h.nonce)&&void 0!==_?_:`UNKNOWN_${a.paymentMethodType}_${a.paymentDescription}`,m.amountMicros=r.amountMicros,m.currency=r.currency,this.transactions=[m]}}p.BraintreeReceipt=c,p.Adapter=class d{constructor(r,a){this.id=t.Platform.BRAINTREE,this.name="BrainTree",this.ready=!1,this.products=[],this._receipts=[],this.supportsParallelLoading=!1,this.context=r,this.log=r.log.child("Braintree"),this.options=a}get receipts(){return this._receipts}get isSupported(){return p.IosBridge.Bridge.isSupported()||p.AndroidBridge.Bridge.isSupported()}initialize(){return new Promise(r=>{this.log.info("initialize()"),p.IosBridge.Bridge.isSupported()?(this.log.info("instantiating ios bridge..."),this.iosBridge=new p.IosBridge.Bridge(this.log,a=>{this.options.tokenizationKey?a(this.options.tokenizationKey):this.options.clientTokenProvider?this.options.clientTokenProvider(a):a(i(t.ErrorCode.CLIENT_INVALID,"Braintree iOS Bridge requires a clientTokenProvider or tokenizationKey"))},this.options.applePay),this.iosBridge.initialize(this.context,r)):p.AndroidBridge.Bridge.isSupported()&&!this.androidBridge?(this.log.info("instantiating android bridge..."),this.androidBridge=new p.AndroidBridge.Bridge(this.log),this.log.info("calling android bridge -> initialize..."),this.androidBridge.initialize(this.options.tokenizationKey?this.options.tokenizationKey:this.options.clientTokenProvider?this.options.clientTokenProvider:"",r)):(this.log.info("platform not supported..."),r(void 0)),this.context.listener.receiptsReady(t.Platform.BRAINTREE)})}loadProducts(r){return A(this,void 0,void 0,function*(){return r.map(a=>i(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"N/A"))})}loadReceipts(){return A(this,void 0,void 0,function*(){return this.context.listener.receiptsReady(t.Platform.BRAINTREE),[]})}order(r){return A(this,void 0,void 0,function*(){return i(t.ErrorCode.UNKNOWN,"N/A: Not implemented with Braintree")})}finish(r){return A(this,void 0,void 0,function*(){r.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.TEST,[r.parentReceipt])})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.log.info("N/A: manageSubscriptions() is not available with Braintree")})}manageBilling(){return A(this,void 0,void 0,function*(){this.log.info("N/A: manageBilling() is not available with Braintree")})}launchDropIn(r,a){return A(this,void 0,void 0,function*(){return this.androidBridge?this.androidBridge.launchDropIn(a):this.iosBridge?this.iosBridge.launchDropIn(r,a):i(t.ErrorCode.PURCHASE,"Braintree is not available")})}requestPayment(r,a){var u,h,_,m,g,P,R,T,y;return A(this,void 0,void 0,function*(){this.log.info("requestPayment()"+JSON.stringify(r));const I=(null===(u=null==a?void 0:a.braintree)||void 0===u?void 0:u.dropInRequest)||{};if((yield p.IosBridge.ApplePayPlugin.isSupported(this.log))||(this.log.info("Apple Pay is not supported."),I.applePayDisabled=!0),this.options.googlePay||I.googlePayRequest){const v=Object.assign(Object.assign({},null!==(h=this.options.googlePay)&&void 0!==h?h:{}),null!==(_=I.googlePayRequest)&&void 0!==_?_:{});v.transactionInfo||(v.transactionInfo={currencyCode:null!==(m=r.currency)&&void 0!==m?m:"",totalPrice:(null!==(g=r.amountMicros)&&void 0!==g?g:0)/1e6,totalPriceStatus:p.GooglePay.TotalPriceStatus.FINAL}),I.googlePayRequest=v}if(this.options.threeDSecure||I.threeDSecureRequest){const v=Object.assign(Object.assign({},null!==(P=this.options.threeDSecure)&&void 0!==P?P:{}),null!==(R=I.threeDSecureRequest)&&void 0!==R?R:{});v.amount||(v.amount=function s(l){const r=""+l/1e4;return(r.slice(0,-2)||"0")+"."+(r.slice(-2,-1)||"0")+(r.slice(-1)||"0")}(null!==(T=r.amountMicros)&&void 0!==T?T:0)),!v.billingAddress&&r.billingAddress&&(v.billingAddress={givenName:r.billingAddress.givenName,surname:r.billingAddress.surname,countryCodeAlpha2:r.billingAddress.countryCode,postalCode:r.billingAddress.postalCode,locality:r.billingAddress.locality,streetAddress:r.billingAddress.streetAddress1,extendedAddress:r.billingAddress.streetAddress2,line3:r.billingAddress.streetAddress3,phoneNumber:r.billingAddress.phoneNumber,region:r.billingAddress.region}),v.email||(v.email=r.email),I.threeDSecureRequest=v}const O=yield this.launchDropIn(r,I);if(!e(O))return n(this.log,O);const b=O;if(this.log.info("launchDropIn success: "+JSON.stringify({paymentRequest:r,dropInResult:b})),null===(y=b.paymentMethodNonce)||void 0===y||!y.nonce)return i(t.ErrorCode.BAD_RESPONSE,"launchDropIn returned no paymentMethodNonce");let D=this._receipts.find(v=>{var L,x;return(null===(L=v.dropInResult.paymentMethodNonce)||void 0===L?void 0:L.nonce)===(null===(x=b.paymentMethodNonce)||void 0===x?void 0:x.nonce)});return D?D.refresh(r,b,this.context.apiDecorators):(D=new c(r,b,this.context.apiDecorators),this.receipts.push(D)),this.context.listener.receiptsUpdated(t.Platform.BRAINTREE,[D]),D.transactions[0]})}receiptValidationBody(r){var a,u,h,_,m;return A(this,void 0,void 0,function*(){if(function o(l){return l.platform===t.Platform.BRAINTREE}(r))return this.log.info("create receiptValidationBody for: "+JSON.stringify(r)),{id:null!==(h=null===(u=null===(a=r.paymentRequest.items)||void 0===a?void 0:a[0])||void 0===u?void 0:u.id)&&void 0!==h?h:"unknown",type:t.ProductType.CONSUMABLE,priceMicros:r.paymentRequest.amountMicros,currency:r.paymentRequest.currency,products:[],transaction:{type:t.Platform.BRAINTREE,deviceData:r.dropInResult.deviceData,id:"nonce",paymentMethodNonce:null!==(m=null===(_=r.dropInResult.paymentMethodNonce)||void 0===_?void 0:_.nonce)&&void 0!==m?m:"",paymentDescription:r.dropInResult.paymentDescription,paymentMethodType:r.dropInResult.paymentMethodType}};this.log.error("Unexpected error, expecting a BraintreeReceipt: "+JSON.stringify(r))})}handleReceiptValidationResponse(r,a){var u;return A(this,void 0,void 0,function*(){if(this.log.info("receipt validation response: "+JSON.stringify(a)),null!=a&&a.data&&"transaction"in a.data&&"braintree"===a.data.transaction.type){const h=null===(u=a.data.transaction.data.transaction)||void 0===u?void 0:u.customer.id;h&&!p.customerId&&(this.log.info("customerId updated: "+h),p.customerId=h)}})}checkSupport(r){return"requestPayment"===r}restorePurchases(){return A(this,void 0,void 0,function*(){})}};const e=l=>!(!l||"code"in l&&"message"in l),n=(l,r)=>r?r.code===t.ErrorCode.PAYMENT_CANCELLED?void l.info("User cancelled the payment request"):(l.warn("launchDropIn failed: "+JSON.stringify(r)),r):(l.warn("launchDropIn failed: no response"),i(t.ErrorCode.BAD_RESPONSE,"Braintree failed to launch drop in"));function i(l,r){return t.storeError(l,r,t.Platform.BRAINTREE,null)}p.braintreeError=i}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){const c="BraintreePlugin";let d;(d=p.AndroidBridge||(p.AndroidBridge={})).Bridge=class o{constructor(n){this.log=n.child("AndroidBridge")}listener(n){this.log.debug("listener: "+JSON.stringify(n)),n&&n.type&&"getClientToken"===n.type&&this.getClientToken()}initialize(n,i){try{if("string"==typeof n){const r=n;this.clientTokenProvider=a=>{a(r)}}else this.clientTokenProvider=n;this.log.info("exec.setListener()");const l=this.listener.bind(this);window.cordova.exec(l,null,c,"setListener",[]),i(void 0)}catch(l){this.log.warn("initialization failed: "+(null==l?void 0:l.message)),i(p.braintreeError(t.ErrorCode.SETUP,"Failed to initialize Braintree Android Bridge: "+(null==l?void 0:l.message)))}}getClientToken(){this.log.info("getClientToken()"),this.clientTokenProvider?(this.log.debug("clientTokenProvider set, calling."),this.clientTokenProvider(n=>{"string"==typeof n?window.cordova.exec(null,null,c,"onClientTokenSuccess",[n]):window.cordova.exec(null,null,c,"onClientTokenFailure",[n.code,n.message])})):(this.log.debug("clientTokenProvider not set, retrying later..."),setTimeout(()=>this.getClientToken(),1e3))}static isSupported(){return"android"===window.cordova.platformId}isApplePaySupported(){return A(this,void 0,void 0,function*(){return!1})}launchDropIn(n){return new Promise(i=>{window.cordova.exec(l=>{this.log.info("dropInSuccess: "+JSON.stringify(l)),i(l)},l=>{this.log.info("dropInFailure: "+l);const r=l.split("|")[0],a=l.split("|").slice(1).join("");i("UserCanceledException"===r?p.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,a):"AuthorizationException"===r?p.braintreeError(t.ErrorCode.UNAUTHORIZED_REQUEST_DATA,a):p.braintreeError(t.ErrorCode.UNKNOWN,l))},c,"launchDropIn",[n])})}}}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){const s="BraintreeApplePayPlugin";class o{static get(){return window.CdvPurchaseBraintreeApplePay}static requestPayment(n){return new Promise(i=>{var l;if(null===(l=o.get())||void 0===l||!l.installed)return i(p.braintreeError(t.ErrorCode.SETUP,"cordova-plugin-purchase-braintree-applepay does not appear to be installed."));window.cordova.exec(u=>{i(u)},u=>{i(p.braintreeError(t.ErrorCode.PURCHASE,"Braintree+ApplePay ERROR: "+(null!=u?u:"payment request failed")))},s,"presentDropInPaymentUI",[n])})}static isSupported(n){return new Promise(i=>{var l;if("ios"!==window.cordova.platformId)return n.info("BraintreeApplePayPlugin is only available for ios."),i(!1);if(null===(l=o.get())||void 0===l||!l.installed)return n.info("BraintreeApplePayPlugin does not appear to be installed."),i(!1);try{window.cordova.exec(r=>{i(r)},()=>{n.info("BraintreeApplePayPlugin is not available."),i(!1)},s,"isApplePaySupported",[])}catch{n.info("BraintreeApplePayPlugin is not installed."),i(!1)}})}}d.ApplePayPlugin=o}(c=p.IosBridge||(p.IosBridge={}))}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let d;var s;(s=d=p.IosBridge||(p.IosBridge={})).Bridge=class o{constructor(n,i,l){this.log=n.child("IosBridge"),this.clientTokenProvider=i,this.applePayOptions=l}initialize(n,i){window.cordova.exec(null,null,"BraintreePlugin","setVerbosity",[n.verbosity]),window.cordova.exec(l=>this.log.debug("(Native) "+l),null,"BraintreePlugin","setLogger",[]),setTimeout(()=>i(void 0),0)}continueDropInForApplePay(n,i,l){var r,a,u,h,_,m,g,P,R;return A(this,void 0,void 0,function*(){const T=(null===(a=null===(r=this.applePayOptions)||void 0===r?void 0:r.preparePaymentRequest)||void 0===a?void 0:a.call(r,n))||{merchantCapabilities:[t.ApplePay.MerchantCapability.ThreeDS]};if(!T.paymentSummaryItems){const I=n.items.filter(b=>b).map((b,D)=>{var v,L,x;return{type:"final",label:(null==b?void 0:b.title)||(null==b?void 0:b.id)||`Item #${D+1}`,amount:""+Math.round((null!==(x=null!==(L=null===(v=null==b?void 0:b.pricing)||void 0===v?void 0:v.priceMicros)&&void 0!==L?L:n.amountMicros)&&void 0!==x?x:0)/1e4)/100}}),O={type:"final",label:null!==(h=null===(u=this.applePayOptions)||void 0===u?void 0:u.companyName)&&void 0!==h?h:"Total",amount:""+Math.round((null!==(_=n.amountMicros)&&void 0!==_?_:0)/1e4)/100};T.paymentSummaryItems=[...I,O]}const y=yield s.ApplePayPlugin.requestPayment(T);return this.log.info("Result from Apple Pay: "+JSON.stringify(y)),"isError"in y?y:y.userCancelled?p.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,"User cancelled the payment request"):{paymentMethodNonce:{isDefault:!1,nonce:null!==(g=null===(m=y.applePayCardNonce)||void 0===m?void 0:m.nonce)&&void 0!==g?g:"",type:null!==(R=null===(P=y.applePayCardNonce)||void 0===P?void 0:P.type)&&void 0!==R?R:""},paymentMethodType:l.paymentMethodType,deviceData:l.deviceData,paymentDescription:l.paymentDescription}})}launchDropIn(n,i){return new Promise(l=>A(this,void 0,void 0,function*(){const r=u=>{this.log.info("dropInSuccess: "+JSON.stringify(u)),u.paymentMethodType===p.DropIn.PaymentMethod.APPLE_PAY?(this.log.info("it's an ApplePay request, we have to process it."),this.continueDropInForApplePay(n,i,u).then(l)):l(u)},a=u=>{this.log.info("dropInFailure: "+u);const[h,_]=u.split("|");l("UserCanceledException"===h?p.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,_):p.braintreeError(t.ErrorCode.UNKNOWN,"ERROR "+h+": "+_))};this.clientTokenProvider(u=>{"string"==typeof u?window.cordova.exec(r,a,"BraintreePlugin","launchDropIn",[u,i]):l(u)})}))}braintreePlugin(){return window.CdvPurchaseBraintree}static isSupported(){return"ios"===window.cordova.platformId}}}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var o;(o=s=d.CardFormFieldStatus||(d.CardFormFieldStatus={}))[o.DISABLED=0]="DISABLED",o[o.OPTIONAL=1]="OPTIONAL",o[o.REQUIRED=2]="REQUIRED"}(c=p.DropIn||(p.DropIn={}))}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var o;(o=s=d.PaymentMethod||(d.PaymentMethod={})).GOOGLE_PAY="GOOGLE_PAY",o.LASER="LASER",o.UK_MAESTRO="UK_MAESTRO",o.SWITCH="SWITCH",o.SOLOR="SOLO",o.APPLE_PAY="APPLE_PAY",o.AMEX="AMEX",o.DINERS_CLUB="DINERS_CLUB",o.DISCOVER="DISCOVER",o.JCB="JCB",o.MAESTRO="MAESTRO",o.MASTERCARD="MASTERCARD",o.PAYPAL="PAYPAL",o.VISA="VISA",o.VENMO="VENMO",o.UNIONPAY="UNIONPAY",o.HIPER="HIPER",o.HIPERCARD="HIPERCARD",o.UNKNOWN="UNKNOWN"}(c=p.DropIn||(p.DropIn={}))}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var e;let o;(e=s=d.BillingAddressFormat||(d.BillingAddressFormat={}))[e.MIN=0]="MIN",e[e.FULL=1]="FULL",function(e){e[e.NOT_CURRENTLY_KNOWN=1]="NOT_CURRENTLY_KNOWN",e[e.ESTIMATED=2]="ESTIMATED",e[e.FINAL=3]="FINAL"}(o=d.TotalPriceStatus||(d.TotalPriceStatus={}))}(c=p.GooglePay||(p.GooglePay={}))}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var n;let o,e;(n=s=d.AccountType||(d.AccountType={})).UNSPECIFIED="00",n.CREDIT="01",n.DEBIT="02",function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SAME_DAY=1]="SAME_DAY",n[n.EXPEDITED=2]="EXPEDITED",n[n.PRIORITY=3]="PRIORITY",n[n.GROUND=4]="GROUND",n[n.ELECTRONIC_DELIVERY=5]="ELECTRONIC_DELIVERY",n[n.SHIP_TO_STORE=6]="SHIP_TO_STORE"}(o=d.ShippingMethod||(d.ShippingMethod={})),function(n){n[n.V1=0]="V1",n[n.V2=1]="V2"}(e=d.Version||(d.Version={}))}(c=p.ThreeDSecure||(p.ThreeDSecure={}))}(E=t.Braintree||(t.Braintree={}))}(f||(f={})),function(t){let E;!function(p){class c extends t.Transaction{constructor(n,i,l){super(t.Platform.GOOGLE_PLAY,i,l),this.nativePurchase=n,this.refresh(n)}static toState(n,i,l){switch(n){case p.Bridge.PurchaseState.PENDING:return t.TransactionState.INITIATED;case p.Bridge.PurchaseState.PURCHASED:return l?t.TransactionState.FINISHED:t.TransactionState.APPROVED;case p.Bridge.PurchaseState.UNSPECIFIED_STATE:return t.TransactionState.UNKNOWN_STATE}}refresh(n){var i,l;this.nativePurchase=n,this.transactionId=`${n.orderId||n.purchaseToken}`,this.purchaseId=`${n.purchaseToken}`,this.products=n.productIds.map(r=>({id:r})),n.purchaseTime&&(this.purchaseDate=new Date(n.purchaseTime)),this.isPending=n.getPurchaseState===p.Bridge.PurchaseState.PENDING,typeof n.acknowledged<"u"&&(this.isAcknowledged=n.acknowledged),typeof n.consumed<"u"&&(this.isConsumed=n.consumed),typeof n.autoRenewing<"u"&&(this.renewalIntent=n.autoRenewing?t.RenewalIntent.RENEW:t.RenewalIntent.LAPSE),this.state=c.toState(n.getPurchaseState,null!==(i=this.isAcknowledged)&&void 0!==i&&i,null!==(l=this.isConsumed)&&void 0!==l&&l)}}p.Transaction=c;class d extends t.Receipt{constructor(n,i){super(t.Platform.GOOGLE_PLAY,i),this.transactions=[new c(n,this,i)],this.purchaseToken=n.purchaseToken,this.orderId=n.orderId}refreshPurchase(n){var i;null===(i=this.transactions[0])||void 0===i||i.refresh(n),this.orderId=n.orderId}}p.Receipt=d;let s=(()=>{class e{constructor(i,l=864e5){if(this.id=t.Platform.GOOGLE_PLAY,this.name="GooglePlay",this.ready=!1,this.supportsParallelLoading=!1,this._receipts=[],this.bridge=new p.Bridge.Bridge,this.initialized=!1,this.retry=new t.Internal.Retry,this.autoRefreshIntervalMillis=0,e._instance)throw new Error("GooglePlay adapter already initialized");this._products=new p.Products(i.apiDecorators),this.autoRefreshIntervalMillis=l,this.context=i,this.log=i.log.child("GooglePlay"),e._instance=this}get products(){return this._products.products}get receipts(){return this._receipts}get isSupported(){return"android"===window.cordova.platformId}initialize(){return A(this,void 0,void 0,function*(){return this.log.info("Initialize"),this.initializationPromise?this.initializationPromise:this.initializationPromise=new Promise(i=>{const l=this.log.child("Bridge"),r={onSetPurchases:this.onSetPurchases.bind(this),onPurchasesUpdated:this.onPurchasesUpdated.bind(this),onPurchaseConsumed:this.onPurchaseConsumed.bind(this),showLog:this.context.verbosity>=t.LogLevel.DEBUG,log:h=>l.info(h)};this.bridge.init(()=>{this.log.debug("Ready"),this.autoRefreshIntervalMillis>0&&window.setInterval(()=>this.getPurchases(),this.autoRefreshIntervalMillis),i(void 0)},h=>{this.initialized=!1,this.context.error(o(t.ErrorCode.SETUP,"Init failed - "+h,null)),this.retry.retry(()=>this.initialize())},r)})})}getSkusOf(i){const l=[],r=[];for(const a of i)a.type===t.ProductType.PAID_SUBSCRIPTION?r.push(a.id):l.push(a.id);return{inAppSkus:l,subsSkus:r}}loadReceipts(){return new Promise(i=>{this.getPurchases().then(l=>{i(this._receipts)})})}loadProducts(i){return new Promise(l=>{this.log.debug("Load: "+JSON.stringify(i));const r=u=>{this.log.debug("Loaded: "+JSON.stringify(u));const h=i.map(_=>{const m=u.find(g=>g.productId===_.id);return m&&m.productId?this._products.addProduct(_,m):o(t.ErrorCode.INVALID_PRODUCT_ID,`Product with id ${_.id} not found.`,_.id)});l(h)},a=()=>{const{inAppSkus:u,subsSkus:h}=this.getSkusOf(i);this.log.debug("getAvailableProducts: "+JSON.stringify(u)+" | "+JSON.stringify(h)),this.bridge.getAvailableProducts(u,h,r,_=>{this.retry.retry(a),this.context.error(o(t.ErrorCode.LOAD,"Loading product info failed - "+_+" - retrying later...",null))})};a()})}finish(i){return new Promise(l=>{const r=()=>{i.state!==t.TransactionState.FINISHED&&(i.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[i.parentReceipt])),l(void 0)},a=i.products[0];if(!a)return l(o(t.ErrorCode.FINISH,"Cannot finish a transaction with no product",null));const u=this._products.getProduct(a.id);if(!u)return l(o(t.ErrorCode.FINISH,"Cannot finish transaction, unknown product "+a.id,a.id));const h=this._receipts.find(m=>m.hasTransaction(i));if(!h)return l(o(t.ErrorCode.FINISH,"Cannot finish transaction, linked receipt not found.",u.id));if(!h.purchaseToken)return l(o(t.ErrorCode.FINISH,"Cannot finish transaction, linked receipt contains no purchaseToken.",u.id));const _=(m,g)=>l(o(g||t.ErrorCode.UNKNOWN,m,u.id));if(u.type===t.ProductType.NON_RENEWING_SUBSCRIPTION||u.type===t.ProductType.CONSUMABLE){if(!i.isConsumed)return this.bridge.consumePurchase(r,_,h.purchaseToken)}else if(!i.isAcknowledged)return this.bridge.acknowledgePurchase(r,_,h.purchaseToken);l(void 0)})}onPurchaseConsumed(i){this.log.debug("onPurchaseConsumed: "+i.orderId),i.acknowledged=!0,i.consumed=!0,this.onPurchasesUpdated([i])}onPurchasesUpdated(i){this.log.debug("onPurchaseUpdated: "+i.map(l=>l.orderId).join(", ")),i.forEach(l=>{const r=this.receipts.find(a=>a.purchaseToken===l.purchaseToken);if(r)r.refreshPurchase(l),this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[r]);else{const a=new d(l,this.context.apiDecorators);this.receipts.push(a),this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[a])}})}onSetPurchases(i){this.log.debug("onSetPurchases: "+JSON.stringify(i)),this.onPurchasesUpdated(i),this.context.listener.receiptsReady(t.Platform.GOOGLE_PLAY)}onPriceChangeConfirmationResult(i){}getPurchases(){return new Promise(i=>{this.log.debug("getPurchases"),this.bridge.getPurchases(()=>{this.log.debug("getPurchases success"),setTimeout(()=>i(void 0),0)},(a,u)=>{this.log.warn("getPurchases failed: "+a+" ("+u+")"),setTimeout(()=>i(o(u||t.ErrorCode.UNKNOWN,a,null)),0)})})}order(i,l){return A(this,void 0,void 0,function*(){return new Promise(r=>{this.log.info("Order - "+JSON.stringify(i));const a=()=>r(void 0),u=(h,_)=>{this.log.warn("Order failed: "+JSON.stringify({message:h,code:_})),r(o(null!=_?_:t.ErrorCode.UNKNOWN,h,i.productId))};if(i.productType===t.ProductType.PAID_SUBSCRIPTION){const h="token"in i?i.productId+"@"+i.token:i.productId,_=this.findOldPurchaseToken(i.productId,i.productGroup);_&&(l.googlePlay?l.googlePlay.oldPurchaseToken||(l.googlePlay.oldPurchaseToken=_):l.googlePlay={oldPurchaseToken:_}),this.bridge.subscribe(a,u,h,l)}else this.bridge.buy(a,u,i.productId,l)})})}findOldPurchaseToken(i,l){if(!l)return;const r=this._receipts.find(a=>!!a.transactions.find(u=>!!u.products.find(h=>{const _=this._products.getProduct(h.id);return!(!_||!t.Internal.LocalReceipts.isOwned([a],_))&&(h.id===i||l&&_.group===l)})));return null==r?void 0:r.purchaseToken}receiptValidationBody(i){var l;return A(this,void 0,void 0,function*(){const r=i.transactions[0];if(!r)return;const a=null===(l=r.products[0])||void 0===l?void 0:l.id;if(!a)return;const u=this._products.getProduct(a);if(!u)return;const h=r.nativePurchase;return{id:a,type:u.type,offers:u.offers,products:this._products.products,transaction:{type:t.Platform.GOOGLE_PLAY,id:i.transactions[0].transactionId,purchaseToken:h.purchaseToken,signature:h.signature,receipt:h.receipt}}})}handleReceiptValidationResponse(i,l){var r;return A(this,void 0,void 0,function*(){if(null!=l&&l.ok){const a=null===(r=null==l?void 0:l.data)||void 0===r?void 0:r.transaction;if((null==a?void 0:a.type)!==t.Platform.GOOGLE_PLAY)return}})}requestPayment(i,l){return A(this,void 0,void 0,function*(){return o(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.bridge.manageSubscriptions()})}manageBilling(){return A(this,void 0,void 0,function*(){this.bridge.manageBilling()})}checkSupport(i){return["order","manageBilling","manageSubscriptions"].indexOf(i)>=0}restorePurchases(){return new Promise(i=>{this.bridge.getPurchases(()=>i(void 0),(l,r)=>{this.log.warn("getPurchases() failed: "+(null!=r?r:"ERROR")+": "+l),i(o(null!=r?r:t.ErrorCode.UNKNOWN,l,null))})})}}return e.trimProductTitles=!0,e})();function o(e,n,i){return t.storeError(e,n,t.Platform.GOOGLE_PLAY,i)}p.Adapter=s}(E=t.GooglePlay||(t.GooglePlay={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var o;(o=s=d.RecurrenceMode||(d.RecurrenceMode={})).FINITE_RECURRING="FINITE_RECURRING",o.INFINITE_RECURRING="INFINITE_RECURRING",o.NON_RECURRING="NON_RECURRING"}(c=p.Bridge||(p.Bridge={}))}(E=t.GooglePlay||(t.GooglePlay={}))}(f||(f={})),function(t){let E;!function(p){let c;var s;let d;(s=c=p.ProrationMode||(p.ProrationMode={})).IMMEDIATE_WITH_TIME_PRORATION="IMMEDIATE_WITH_TIME_PRORATION",s.IMMEDIATE_AND_CHARGE_PRORATED_PRICE="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",s.IMMEDIATE_WITHOUT_PRORATION="IMMEDIATE_WITHOUT_PRORATION",s.DEFERRED="DEFERRED",s.IMMEDIATE_AND_CHARGE_FULL_PRICE="IMMEDIATE_AND_CHARGE_FULL_PRICE",function(s){let e,o=function(u){console.log("InAppBilling[js]: "+u)};var a;function i(a){return function(u){if(!a)return;const h="string"==typeof u?u.split("|"):[];h.length>1&&/^[-+]?(\d+)$/.test(h[0])?a(h[1],+h[0]):a(u)}}function r(a){const u=function l(a){return a&&a.constructor===Object?a:{}}(null==a?void 0:a.googlePlay);return!u.accountId&&null!=a&&a.applicationUsername&&(u.accountId=t.Utils.md5(a.applicationUsername)),u}(a=e=s.PurchaseState||(s.PurchaseState={}))[a.UNSPECIFIED_STATE=0]="UNSPECIFIED_STATE",a[a.PURCHASED=1]="PURCHASED",a[a.PENDING=2]="PENDING",s.Bridge=class n{constructor(){this.options={}}init(u,h,_){_||(_={}),_.log&&(o=_.log),this.options={showLog:!1!==_.showLog,onPurchaseConsumed:_.onPurchaseConsumed,onPurchasesUpdated:_.onPurchasesUpdated,onSetPurchases:_.onSetPurchases},this.options.showLog&&o("setup ok");const m=this.listener.bind(this);window.cordova.exec(m,function(g){},"InAppBillingPlugin","setListener",[]),window.cordova.exec(u,i(h),"InAppBillingPlugin","init",[])}load(u,h,_,m,g){if(typeof _<"u"&&("string"==typeof _&&(_=[_]),_.length>0)){if("string"!=typeof _[0]){var R="invalid productIds: "+JSON.stringify(_);return this.options.showLog&&o(R),void h(R,t.ErrorCode.INVALID_PRODUCT_ID)}this.options.showLog&&o("load "+JSON.stringify(_))}window.cordova.exec(u,i(h),"InAppBillingPlugin","load",[_,m,g])}listener(u){this.options.showLog&&o("listener: "+JSON.stringify(u)),u&&u.type&&("setPurchases"===u.type&&this.options.onSetPurchases&&this.options.onSetPurchases(u.data.purchases),"purchasesUpdated"===u.type&&this.options.onPurchasesUpdated&&this.options.onPurchasesUpdated(u.data.purchases),"purchaseConsumed"===u.type&&this.options.onPurchaseConsumed&&this.options.onPurchaseConsumed(u.data.purchase),"onPriceChangeConfirmationResultOK"===u.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("OK"),"onPriceChangeConfirmationResultUserCanceled"===u.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UserCanceled"),"onPriceChangeConfirmationResultUnknownSku"===u.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UnknownProduct"))}getPurchases(u,h){return this.options.showLog&&o("getPurchases()"),window.cordova.exec(u,i(h),"InAppBillingPlugin","getPurchases",["null"])}buy(u,h,_,m){return this.options.showLog&&o("buy()"),window.cordova.exec(u,i(h),"InAppBillingPlugin","buy",[_,r(m)])}subscribe(u,h,_,m){var g;return this.options.showLog&&o("subscribe()"),!(null===(g=m.googlePlay)||void 0===g)&&g.oldPurchaseToken&&this.options.showLog&&o("subscribe() -> upgrading from an old purchase"),window.cordova.exec(u,i(h),"InAppBillingPlugin","subscribe",[_,r(m)])}consumePurchase(u,h,_){return this.options.showLog&&o("consumePurchase()"),window.cordova.exec(u,i(h),"InAppBillingPlugin","consumePurchase",[_])}acknowledgePurchase(u,h,_){return this.options.showLog&&o("acknowledgePurchase()"),window.cordova.exec(u,i(h),"InAppBillingPlugin","acknowledgePurchase",[_])}getAvailableProducts(u,h,_,m){return this.options.showLog&&o("getAvailableProducts()"),window.cordova.exec(_,i(m),"InAppBillingPlugin","getAvailableProducts",[u,h])}manageSubscriptions(){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","manageSubscriptions",[])}manageBilling(){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","manageBilling",[])}launchPriceChangeConfirmationFlow(u){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","launchPriceChangeConfirmationFlow",[u])}}}(d=p.Bridge||(p.Bridge={}))}(E=t.GooglePlay||(t.GooglePlay={}))}(f||(f={})),function(t){let E;!function(p){class c extends t.Product{}p.GProduct=c;class d extends t.Offer{constructor(){super(...arguments),this.type="inapp"}}p.InAppOffer=d;class s extends t.Offer{constructor(n,i){super(n,i),this.type="subs",this.tags=n.tags,this.token=n.token}}p.SubscriptionOffer=s,p.Products=class o{constructor(n){this.products=[],this.offers=[],this.decorator=n}getProduct(n){return this.products.find(i=>i.id===n)}getOffer(n){return this.offers.find(i=>i.id===n)}addProduct(n,i){const l=this.getProduct(n.id),r=null!=l?l:new c(n,this.decorator);return r.title=i.title||i.name||r.title,p.Adapter.trimProductTitles&&(r.title=r.title.replace(/ \(.*\)$/,"")),r.description=i.description||r.description,"product_format"in i&&"v12.0"===i.product_format&&"subs"===i.product_type?this.onSubsV12Loaded(r,i):this.onInAppLoaded(r,i),l||this.products.push(r),r}onSubsV12Loaded(n,i){return i.offers.forEach(r=>{const a=r.pricing_phases.slice(-1)[0];if((null==a?void 0:a.recurrence_mode)===t.RecurrenceMode.FINITE_RECURRING){const h=function l(r){if(!r)return null;for(const a of i.offers)if(a.base_plan_id===r&&!a.offer_id)return a;return null}(r.base_plan_id);h&&h!==r&&r.pricing_phases.push(...h.pricing_phases)}const u=this.iabSubsOfferV12Loaded(n,i,r);n.addOffer(u)}),n}makeOfferId(n,i){return i.base_plan_id?i.offer_id?n+"@"+i.base_plan_id+"@"+i.offer_id:n+"@"+i.base_plan_id:n+"@"+i.token}iabSubsOfferV12Loaded(n,i,l){const r=this.makeOfferId(i.productId,l),a=this.getOffer(r),u=l.pricing_phases.map(h=>this.toPricingPhase(h));if(a)return a.pricingPhases=u,a;{const h=new s({id:r,product:n,pricingPhases:u,token:l.token,tags:l.tags},this.decorator);return this.offers.push(h),h}}onInAppLoaded(n,i){var l,r,a,u;const h=this.getOffer(i.productId),_=[{price:null!==(r=null!==(l=i.formatted_price)&&void 0!==l?l:i.price)&&void 0!==r?r:`${(null!==(a=i.price_amount_micros)&&void 0!==a?a:0)/1e6} ${i.price_currency_code}`,priceMicros:null!==(u=i.price_amount_micros)&&void 0!==u?u:0,currency:i.price_currency_code,recurrenceMode:t.RecurrenceMode.NON_RECURRING}];if(h)h.pricingPhases=_,n.offers=[h];else{const m=new d({id:i.productId,product:n,pricingPhases:_},this.decorator);this.offers.push(m),n.offers=[m]}return n}toPaymentMode(n){return 0===n.price_amount_micros?t.PaymentMode.FREE_TRIAL:n.recurrence_mode===p.Bridge.RecurrenceMode.NON_RECURRING?t.PaymentMode.UP_FRONT:t.PaymentMode.PAY_AS_YOU_GO}toRecurrenceMode(n){switch(n){case p.Bridge.RecurrenceMode.FINITE_RECURRING:return t.RecurrenceMode.FINITE_RECURRING;case p.Bridge.RecurrenceMode.INFINITE_RECURRING:return t.RecurrenceMode.INFINITE_RECURRING;case p.Bridge.RecurrenceMode.NON_RECURRING:return t.RecurrenceMode.NON_RECURRING}}toPricingPhase(n){return{price:n.formatted_price,priceMicros:n.price_amount_micros,currency:n.price_currency_code,billingPeriod:n.billing_period,billingCycles:n.billing_cycle_count,recurrenceMode:this.toRecurrenceMode(n.recurrence_mode),paymentMode:this.toPaymentMode(n)}}}}(E=t.GooglePlay||(t.GooglePlay={}))}(f||(f={})),function(t){let E;!function(p){let c;!function(d){let s;var e;let o;(e=s=d.GoogleErrorReason||(d.GoogleErrorReason={})).SUBSCRIPTION_NO_LONGER_AVAILABLE="subscriptionPurchaseNoLongerAvailable",e.PURCHASE_TOKEN_NO_LONGER_VALID="purchaseTokenNoLongerValid",function(e){e[e.GONE=410]="GONE"}(o=d.ErrorCode||(d.ErrorCode={}))}(c=p.PublisherAPI||(p.PublisherAPI={}))}(E=t.GooglePlay||(t.GooglePlay={}))}(f||(f={})),function(t){let E;!function(p){const c=t.Platform.TEST;let d=[];function s(n){n.products.forEach(i=>{var l,r,a,u;const h=d.find(m=>i.id===m.id),_={id:i.id,purchaseDate:null===(l=n.purchaseDate)||void 0===l?void 0:l.getTime(),expiryDate:null===(r=n.expirationDate)||void 0===r?void 0:r.getTime(),lastRenewalDate:null===(a=n.lastRenewalDate)||void 0===a?void 0:a.getTime(),renewalIntent:n.renewalIntent,renewalIntentChangeDate:null===(u=n.renewalIntentChangeDate)||void 0===u?void 0:u.getTime()};h?Object.assign(h,_):d.push(_)})}function e(n,i,l){return t.storeError(n,i,t.Platform.TEST,l)}p.Adapter=class o{constructor(i){this.id=t.Platform.TEST,this.name="Test",this.ready=!1,this.products=[],this.receipts=[],this.supportsParallelLoading=!0,this.context=i,this.log=i.log.child("Test")}get isSupported(){return!0}initialize(){return A(this,void 0,void 0,function*(){})}loadReceipts(){return A(this,void 0,void 0,function*(){return new Promise(i=>{setTimeout(()=>{this.context.listener.receiptsReady(t.Platform.TEST),i(this.receipts)},600)})})}loadProducts(i){return A(this,void 0,void 0,function*(){return i.map(l=>{if(!p.testProductsArray.find(u=>u.id===l.id&&u.type===l.type))return e(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"This product is not available",l.id);const r=this.products.find(u=>u.id===l.id);if(r)return r;l.id===p.testProducts.PAID_SUBSCRIPTION_ACTIVE.id&&setTimeout(()=>{this.reportActiveSubscription()},500);const a=p.initTestProduct(l.id,this.context.apiDecorators);return a?(this.products.push(a),this.context.listener.productsUpdated(t.Platform.TEST,[a]),a):e(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"Could not load this product",l.id)})})}order(i){return A(this,void 0,void 0,function*(){if(i.id.indexOf("-fail-")>0)return e(t.ErrorCode.PURCHASE,"Purchase failed.",i.productId);const l=this.products.find(h=>h.id===i.productId);if(!t.Internal.LocalReceipts.canPurchase(this.receipts,l))return e(t.ErrorCode.PURCHASE,"Product already owned",i.productId);const r=prompt(`Do you want to purchase ${i.productId} for ${i.pricingPhases[0].price}?\nEnter "Y" to confirm.\nEnter "E" to fail with an error.Anything else to cancel.`);if("E"===(null==r?void 0:r.toUpperCase()))return e(t.ErrorCode.PURCHASE,"Purchase failed",i.productId);if("Y"!==(null==r?void 0:r.toUpperCase()))return e(t.ErrorCode.PAYMENT_CANCELLED,"Purchase flow has been cancelled by the user",i.productId);const a=new t.Receipt(c,this.context.apiDecorators),u=new t.Transaction(c,a,this.context.apiDecorators);a.transactions=[u],u.products=[{id:i.productId,offerId:i.id}],u.state=t.TransactionState.APPROVED,u.purchaseDate=new Date,u.transactionId=i.productId+"-"+(new Date).getTime(),u.isAcknowledged=!1,i.productType===t.ProductType.PAID_SUBSCRIPTION&&(u.expirationDate=new Date(+new Date+6048e5),u.renewalIntent=t.RenewalIntent.RENEW),s(u),this.receipts.push(a),this.context.listener.receiptsUpdated(t.Platform.TEST,[a])})}finish(i){return new Promise(l=>{setTimeout(()=>{i.state=t.TransactionState.FINISHED,i.isAcknowledged=!0,s(i);const r=this.products.find(u=>i.products[0].id===u.id);(null==r?void 0:r.type)===t.ProductType.CONSUMABLE&&(i.isConsumed=!0);const a=this.receipts.filter(u=>u.hasTransaction(i));this.context.listener.receiptsUpdated(c,a),l(void 0)},500)})}receiptValidationBody(i){return A(this,void 0,void 0,function*(){})}handleReceiptValidationResponse(i,l){return A(this,void 0,void 0,function*(){})}requestPayment(i,l){var r;return A(this,void 0,void 0,function*(){yield t.Utils.asyncDelay(100);const a=prompt(`Mock payment of ${(null!==(r=i.amountMicros)&&void 0!==r?r:0)/1e6} ${i.currency}. Enter "Y" to confirm. Enter "E" to trigger an error.`);if("E"===(null==a?void 0:a.toUpperCase()))return e(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Payment not allowed",null);if("Y"!==(null==a?void 0:a.toUpperCase()))return;const u=new t.Receipt(c,this.context.apiDecorators),h=new t.Transaction(t.Platform.TEST,u,this.context.apiDecorators);return h.purchaseDate=new Date,h.products=i.items.filter(_=>_).map(_=>({id:(null==_?void 0:_.id)||""})),h.state=t.TransactionState.APPROVED,h.transactionId="payment-"+(new Date).getTime(),h.amountMicros=i.amountMicros,h.currency=i.currency,u.transactions=[h],this.receipts.push(u),setTimeout(()=>{this.context.listener.receiptsUpdated(c,[u])},400),h})}manageSubscriptions(){return A(this,void 0,void 0,function*(){alert("Pseudo subscription management interface. Close it when you are done.")})}manageBilling(){return A(this,void 0,void 0,function*(){alert("Pseudo billing management interface. Close it when you are done.")})}reportActiveSubscription(){if(this.receipts.find(h=>h.transactions[0].transactionId===a(1)))return;const i=12e4,l=new t.Receipt(c,this.context.apiDecorators),r=h=>{var _,m;const g=new t.Transaction(c,l,this.context.apiDecorators);g.products=[{id:p.testProducts.PAID_SUBSCRIPTION_ACTIVE.id,offerId:p.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId}],g.state=t.TransactionState.APPROVED,g.transactionId=a(h),g.isAcknowledged=1==h,g.renewalIntent=t.RenewalIntent.RENEW;const P=+((null===(m=null===(_=null==l?void 0:l.transactions)||void 0===_?void 0:_[0])||void 0===m?void 0:m.purchaseDate)||new Date);return g.purchaseDate=new Date(P),g.lastRenewalDate=new Date(P+i*(h-1)),g.expirationDate=new Date(P+i*h),s(g),g};function a(h){return"test-active-subscription-transaction-"+h}l.transactions.push(r(1)),this.receipts.push(l),this.context.listener.receiptsUpdated(t.Platform.TEST,[l]);let u=1;setInterval(()=>{this.log.info("auto-renewing the mock subscription"),u+=1,l.transactions.push(r(u)),this.context.listener.receiptsUpdated(t.Platform.TEST,[l])},i)}static verify(i,l){setTimeout(()=>{var r,a;l({receipt:i,payload:{ok:!0,data:{id:null===(a=null===(r=i.transactions[0])||void 0===r?void 0:r.products[0])||void 0===a?void 0:a.id,latest_receipt:!0,transaction:{type:"test"},collection:d}}})},500)}checkSupport(i){return!0}restorePurchases(){return A(this,void 0,void 0,function*(){})}}}(E=t.Test||(t.Test={}))}(f||(f={})),function(t){let E;!function(p){const c=t.Platform.TEST;p.testProducts={CONSUMABLE:{platform:c,id:"test-consumable",type:t.ProductType.CONSUMABLE},CONSUMABLE_FAILING:{platform:c,id:"test-consumable-fail",type:t.ProductType.CONSUMABLE},NON_CONSUMABLE:{platform:c,id:"test-non-consumable",type:t.ProductType.NON_CONSUMABLE},PAID_SUBSCRIPTION:{platform:c,id:"test-subscription",type:t.ProductType.PAID_SUBSCRIPTION},PAID_SUBSCRIPTION_ACTIVE:{platform:c,id:"test-subscription-active",type:t.ProductType.PAID_SUBSCRIPTION,extra:{offerId:"test-paid-subscription-active-offer1"}}},p.testProductsArray=t.Utils.objectValues(p.testProducts),p.initTestProduct=function d(s,o){const e=Object.keys(p.testProducts).find(i=>p.testProducts[i]&&p.testProducts[i].id===s);if(!e)return;const n=new t.Product(p.testProducts[e],o);switch(e){case"CONSUMABLE":n.title="Test Consumable",n.description="A consumable product that you can purchase",n.addOffer(new t.Offer({id:"test-consumable-offer1",pricingPhases:[{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:n},o));break;case"CONSUMABLE_FAILING":n.title="Failing Consumable",n.description="A consumable product that cannot be purchased",n.addOffer(new t.Offer({id:"test-consumable-fail-offer1",pricingPhases:[{price:"$1.99",currency:"USD",priceMicros:199e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:n},o));break;case"NON_CONSUMABLE":n.title="Non Consumable",n.description="A non consumable product",n.addOffer(new t.Offer({id:"test-non-consumable-offer1",pricingPhases:[{price:"$9.99",currency:"USD",priceMicros:999e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:n},o));break;case"PAID_SUBSCRIPTION":n.title="A subscription product",n.description="An auto-renewing paid subscription with a trial period",n.addOffer(new t.Offer({id:"test-paid-subscription-offer1",product:n,pricingPhases:[{price:"$0.00",currency:"USD",priceMicros:0,paymentMode:t.PaymentMode.FREE_TRIAL,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING,billingCycles:3,billingPeriod:"P1W"},{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:t.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:t.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1M"}]},o));break;case"PAID_SUBSCRIPTION_ACTIVE":n.title="An owned subscription product",n.description="An active paid subscription",n.addOffer(new t.Offer({id:p.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId,product:n,pricingPhases:[{price:"$19.99",currency:"USD",priceMicros:1999e4,paymentMode:t.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:t.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1Y"}]},o));break;default:throw new Error(`Unhandled enum case: ${e}`)}return n}}(E=t.Test||(t.Test={}))}(f||(f={})),function(t){let E;!function(p){function d(s,o,e){return t.storeError(s,o,t.Platform.WINDOWS_STORE,e)}p.Adapter=class c{constructor(){this.id=t.Platform.WINDOWS_STORE,this.name="WindowsStore",this.ready=!1,this.supportsParallelLoading=!1,this.products=[],this.receipts=[]}initialize(){return A(this,void 0,void 0,function*(){})}get isSupported(){return!1}loadProducts(o){return A(this,void 0,void 0,function*(){return o.map(e=>d(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"TODO",e.id))})}loadReceipts(){return A(this,void 0,void 0,function*(){return[]})}order(o){return A(this,void 0,void 0,function*(){return d(t.ErrorCode.UNKNOWN,"TODO: Not implemented",o.productId)})}finish(o){return A(this,void 0,void 0,function*(){return d(t.ErrorCode.UNKNOWN,"TODO: Not implemented",null)})}handleReceiptValidationResponse(o,e){return A(this,void 0,void 0,function*(){})}receiptValidationBody(o){return A(this,void 0,void 0,function*(){})}requestPayment(o,e){return A(this,void 0,void 0,function*(){return d(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){return d(t.ErrorCode.UNKNOWN,"manageSubscriptions not supported",null)})}manageBilling(){return A(this,void 0,void 0,function*(){return d(t.ErrorCode.UNKNOWN,"manageBilling not supported",null)})}checkSupport(o){return!1}restorePurchases(){return A(this,void 0,void 0,function*(){})}}}(E=t.WindowsStore||(t.WindowsStore={}))}(f||(f={})),function(t){let E;!function(p){let c;(c=p.Ajax||(p.Ajax={})).HTTP_REQUEST_TIMEOUT=408,p.ajax=function d(o,e){if(typeof window<"u"&&window.cordova&&window.cordova.plugin&&window.cordova.plugin.http)return function s(o,e){let n=function(){};const i={method:(e.method||"get").toLowerCase(),data:e.data,serializer:"json"};e.customHeaders&&(o.debug("ajax[http] -> adding custom headers: "+JSON.stringify(e.customHeaders)),i.headers=e.customHeaders),o.debug("ajax[http] -> send request to "+e.url);const l=r=>{try{200==r.status?p.callExternal(o,"ajax.success",e.success,JSON.parse(r.data)):(o.warn("ajax[http] -> request to "+e.url+" failed with status "+r.status+" ("+r.error+")"),p.callExternal(o,"ajax.error",e.error,r.status,r.error))}catch(a){o.warn("ajax[http] -> request to "+e.url+" failed with an exception: "+a.message),e.error&&p.callExternal(o,"ajax.error",e.error,417,a.message)}p.callExternal(o,"ajax.done",n)};return window.cordova.plugin.http.sendRequest(e.url,i,l,l),{done:function(r){return n=r,this}}}(o,e);var n=function(){},i=new XMLHttpRequest;e.timeout&&(i.timeout=e.timeout,i.ontimeout=function(){o.warn("ajax -> request to "+e.url+" timeout"),p.callExternal(o,"ajax.error",e.error,c.HTTP_REQUEST_TIMEOUT,"Timeout")}),i.open(e.method||"POST",e.url,!0),i.onreadystatechange=function(){try{4===i.readyState&&(200===i.status?p.callExternal(o,"ajax.success",e.success,JSON.parse(i.responseText)):(o.warn("ajax -> request to "+e.url+" failed with status "+i.status+" ("+i.statusText+")"),p.callExternal(o,"ajax.error",e.error,i.status,i.statusText)))}catch(r){o.warn("ajax -> request to "+e.url+" failed with an exception: "+r.message),e.error&&e.error(417,r.message,null)}4===i.readyState&&p.callExternal(o,"ajax.done",n)};const l=e.customHeaders;return l&&Object.keys(l).forEach(function(r){o.debug("ajax -> adding custom header: "+r),i.setRequestHeader(r,l[r])}),i.setRequestHeader("Accept","application/json"),o.debug("ajax -> send request to "+e.url),e.data?(i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(e.data))):i.send(),{done:function(r){return n=r,this}}}}(E=t.Utils||(t.Utils={}))}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).callExternal=function c(d,s,o,...e){try{const n=Array.prototype.slice.call(arguments,3);o&&o.apply(t.store,n)}catch(n){d.logCallbackException(s,n)}}}(f||(f={})),function(t){let E;var p;(p=E=t.Utils||(t.Utils={})).delay=function c(o,e){return setTimeout(o,e)},p.debounce=function d(o,e){let n=null;const i=function(r,a){n=null,o()};return function(){n&&window.clearTimeout(n),n=setTimeout(i,e)}},p.asyncDelay=function s(o){return new Promise(e=>setTimeout(e,o))}}(f||(f={})),function(t){let E;var p;(p=E=t.Utils||(t.Utils={})).formatBillingCycleEN=function c(s){switch(function d(s){var o;const e=null!==(o=s.billingCycles)&&void 0!==o?o:0;if(s.recurrenceMode===t.RecurrenceMode.FINITE_RECURRING){if(1==e)return t.RecurrenceMode.NON_RECURRING;if(e<=0)return t.RecurrenceMode.INFINITE_RECURRING}return s.recurrenceMode}(s)){case t.RecurrenceMode.FINITE_RECURRING:return`${s.billingCycles}x ${p.formatDurationEN(s.billingPeriod)}`;case t.RecurrenceMode.NON_RECURRING:return"for "+p.formatDurationEN(s.billingPeriod);default:return"every "+p.formatDurationEN(s.billingPeriod,{omitOne:!0})}}}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).formatDurationEN=function c(d,s){if(!d)return"";const o=d.length,e=d.slice(1,o-1);return"1"===e?null!=s&&s.omitOne?{D:"day",W:"week",M:"month",Y:"year"}[d[o-1]]||d[o-1]:{D:"1 day",W:"1 week",M:"1 month",Y:"1 year"}[d[o-1]]||d[o-1]:`${e} ${{D:"days",W:"weeks",M:"months",Y:"years"}[d[o-1]]||d[o-1]}`}}(f||(f={})),function(t){let E;!function(p){const c="0123456789abcdef".split("");function d(m){for(var g="",P=0;P<4;P++)g+=c[m>>8*P+4&15]+c[m>>8*P&15];return g}function s(m){const g=[];for(var P=m.length,R=0;R<P;R++)g.push(d(m[R]));return g.join("")}function o(m,g){return m+g&4294967295}function e(m,g,P,R,T,y,I){return function O(D,v,L){return o(D<<v|D>>>32-v,L)}(function b(D,v,L,x){return o(o(v,D),o(L,x))}(m,g,R,y),T,P)}var n=function(m,g,P,R,T,y,I,O){return e(P&R|~P&T,g,P,y,I,O)},i=function(m,g,P,R,T,y,I,O){return e(P&T|R&~T,g,P,y,I,O)},l=function(m,g,P,R,T,y,I,O){return e(P^R^T,g,P,y,I,O)},r=function(m,g,P,R,T,y,I,O){return e(R^(P|~T),g,P,y,I,O)};function a(m,g,P){P||(P=o);let R=m[0],T=m[1],y=m[2],I=m[3];var O=n.bind(null,P);R=O(R,T,y,I,g[0],7,-680876936),I=O(I,R,T,y,g[1],12,-389564586),y=O(y,I,R,T,g[2],17,606105819),T=O(T,y,I,R,g[3],22,-1044525330),R=O(R,T,y,I,g[4],7,-176418897),I=O(I,R,T,y,g[5],12,1200080426),y=O(y,I,R,T,g[6],17,-1473231341),T=O(T,y,I,R,g[7],22,-45705983),R=O(R,T,y,I,g[8],7,1770035416),I=O(I,R,T,y,g[9],12,-1958414417),y=O(y,I,R,T,g[10],17,-42063),T=O(T,y,I,R,g[11],22,-1990404162),R=O(R,T,y,I,g[12],7,1804603682),I=O(I,R,T,y,g[13],12,-40341101),y=O(y,I,R,T,g[14],17,-1502002290),T=O(T,y,I,R,g[15],22,1236535329);var b=i.bind(null,P);R=b(R,T,y,I,g[1],5,-165796510),I=b(I,R,T,y,g[6],9,-1069501632),y=b(y,I,R,T,g[11],14,643717713),T=b(T,y,I,R,g[0],20,-373897302),R=b(R,T,y,I,g[5],5,-701558691),I=b(I,R,T,y,g[10],9,38016083),y=b(y,I,R,T,g[15],14,-660478335),T=b(T,y,I,R,g[4],20,-405537848),R=b(R,T,y,I,g[9],5,568446438),I=b(I,R,T,y,g[14],9,-1019803690),y=b(y,I,R,T,g[3],14,-187363961),T=b(T,y,I,R,g[8],20,1163531501),R=b(R,T,y,I,g[13],5,-1444681467),I=b(I,R,T,y,g[2],9,-51403784),y=b(y,I,R,T,g[7],14,1735328473),T=b(T,y,I,R,g[12],20,-1926607734);var D=l.bind(null,P);R=D(R,T,y,I,g[5],4,-378558),I=D(I,R,T,y,g[8],11,-2022574463),y=D(y,I,R,T,g[11],16,1839030562),T=D(T,y,I,R,g[14],23,-35309556),R=D(R,T,y,I,g[1],4,-1530992060),I=D(I,R,T,y,g[4],11,1272893353),y=D(y,I,R,T,g[7],16,-155497632),T=D(T,y,I,R,g[10],23,-1094730640),R=D(R,T,y,I,g[13],4,681279174),I=D(I,R,T,y,g[0],11,-358537222),y=D(y,I,R,T,g[3],16,-722521979),T=D(T,y,I,R,g[6],23,76029189),R=D(R,T,y,I,g[9],4,-640364487),I=D(I,R,T,y,g[12],11,-421815835),y=D(y,I,R,T,g[15],16,530742520),T=D(T,y,I,R,g[2],23,-995338651);var v=r.bind(null,P);R=v(R,T,y,I,g[0],6,-198630844),I=v(I,R,T,y,g[7],10,1126891415),y=v(y,I,R,T,g[14],15,-1416354905),T=v(T,y,I,R,g[5],21,-57434055),R=v(R,T,y,I,g[12],6,1700485571),I=v(I,R,T,y,g[3],10,-1894986606),y=v(y,I,R,T,g[10],15,-1051523),T=v(T,y,I,R,g[1],21,-2054922799),R=v(R,T,y,I,g[8],6,1873313359),I=v(I,R,T,y,g[15],10,-30611744),y=v(y,I,R,T,g[6],15,-1560198380),T=v(T,y,I,R,g[13],21,1309151649),R=v(R,T,y,I,g[4],6,-145523070),I=v(I,R,T,y,g[11],10,-1120210379),y=v(y,I,R,T,g[2],15,718787259),T=v(T,y,I,R,g[9],21,-343485551),m[0]=P(R,m[0]),m[1]=P(T,m[1]),m[2]=P(y,m[2]),m[3]=P(I,m[3])}function u(m){for(var g=[],P=0;P<64;P+=4)g[P>>2]=m.charCodeAt(P)+(m.charCodeAt(P+1)<<8)+(m.charCodeAt(P+2)<<16)+(m.charCodeAt(P+3)<<24);return g}function h(m,g){let P;const R=m.length,T=[1732584193,-271733879,-1732584194,271733878];for(P=64;P<=R;P+=64)a(T,u(m.substring(P-64,P)),g);const y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=(m=m.substring(P-64)).length;let O;for(O=0;O<I;O++)y[O>>2]|=m.charCodeAt(O)<<(O%4<<3);if(y[O>>2]|=128<<(O%4<<3),O>55)for(a(T,y,g),O=16;O--;)y[O]=0;return y[14]=8*R,a(T,y,g),T}p.md5=function _(m){if(!m)return"";let g;return"5d41402abc4b2a76b9719d911017c592"!==s(h("hello"))&&(g=function(P,R){const T=(65535&P)+(65535&R);return(P>>16)+(R>>16)+(T>>16)<<16|65535&T}),s(h(m,g))}}(E=t.Utils||(t.Utils={}))}(f||(f={})),function(t){let E;!function(p){function d(s,o,e,n,i,l){i||(i=e.name||"#"+p.md5(e.toString())),setTimeout(()=>{try{s.debug(`Calling callback: type=${o} name=${i} reason=${l}`),e(n)}catch(r){s.error(`Error in callback: type=${o} name=${i} reason=${l}`),s.debug(e.toString());const a=r;"message"in a&&s.error(a.message),"fileName"in r&&s.error("in "+r.fileName+":"+r.lineNumber),"stack"in a&&s.error(a.stack)}},0)}p.safeCallback=function c(s,o,e,n,i){return function(l){d(s,o,e,l,n,i)}},p.safeCall=d}(E=t.Utils||(t.Utils={}))}(f||(f={})),function(t){let E;(E=t.Utils||(t.Utils={})).uuidv4=function d(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(s){return(s^function c(){return window.crypto||window.msCrypto}().getRandomValues(new Uint8Array(1))[0]&15>>s/4).toString(16)})}}(f||(f={})),function(t){let E;!function(p){let c;(c=p.Internal||(p.Internal={})).getDeviceInfo=function n(i){const l=function e(i){return"string"==typeof i.validator_privacy_policy?i.validator_privacy_policy.split(","):function s(i){return"[object Array]"===Object.prototype.toString.call(i)}(i.validator_privacy_policy)?i.validator_privacy_policy:["analytics","support","fraud"]}(i);function r(m){return l.indexOf(m)>=0}const a={plugin:"cordova-plugin-purchase/"+t.PLUGIN_VERSION},u=window,h=function o(i){return"[object Object]"===Object.prototype.toString.call(i)}(u.device)?u.device:{};if(r("analytics")||r("support")){const m=u.Ionic||u.ionic;m&&m.version&&(a.ionic=m.version),h.cordova&&(a.cordova=h.cordova),h.model&&(a.model=h.model),h.platform&&(a.platform=h.platform),h.version&&(a.version=h.version),h.manufacturer&&(a.manufacturer=h.manufacturer)}if(r("tracking")&&(h.serial&&(a.serial=h.serial),h.uuid&&(a.uuid=h.uuid)),h.isVirtual&&(a.isVirtual=h.isVirtual),r("fraud")){var _="";h.serial?_="serial:"+h.serial:h.uuid?_="uuid:"+h.uuid:(h.model&&(_+="/"+h.model),h.manufacturer&&(_="/"+h.manufacturer)),_&&(a.fingerprint=t.Utils.md5(_))}return a}}(E=t.Validator||(t.Validator={}))}(f||(f={})),function(t){let E;!function(p){let c;c=p.Request||(p.Request={})}(E=t.Validator||(t.Validator={}))}(f||(f={})),function(t){t.VerifiedReceipt=class E{constructor(c,d,s){var o;this.className="VerifiedReceipt",this.id=d.id,this.sourceReceipt=c,this.collection=null!==(o=d.collection)&&void 0!==o?o:[],this.latestReceipt=d.latest_receipt,this.nativeTransactions=[d.transaction],this.warning=d.warning,Object.defineProperty(this,"raw",{enumerable:!1,get:()=>d}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>s.finish(this)}})}get platform(){return this.sourceReceipt.platform}get raw(){return{}}set(c,d){var s;this.id=d.id,this.sourceReceipt=c,this.collection=null!==(s=d.collection)&&void 0!==s?s:[],this.latestReceipt=d.latest_receipt,this.nativeTransactions=[d.transaction],this.warning=d.warning}finish(){return A(this,void 0,void 0,function*(){})}}}(f||(f={}))}}]);