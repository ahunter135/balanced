"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4494],{7258:(Z,M,r)=>{r.d(M,{N1:()=>e});const e=(0,r(2726).fo)("Keyboard")},1695:(Z,M,r)=>{r.d(M,{m:()=>A});var d=r(5861),e=r(6689),t=r(7258),T=r(3251),g=r(6814),_=r(95),u=r(5548);const O=["nameInput"],l=["fieldsContainer"];function p(o,c){1&o&&(e.TgZ(0,"span",9),e._uU(1,"Remaining"),e.qZA())}function h(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"ion-icon",15),e.NdJ("click",function(){e.CHM(n);const s=e.oxw().$implicit,v=e.oxw(2);return e.KtG(v.deleteCategory(v.category,s))}),e.qZA()}}function f(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"span",16),e.NdJ("click",function(){e.CHM(n);const s=e.oxw().index,v=e.oxw(2);return e.KtG(v.openBudgetItem(s))}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-note",17),e._uU(4),e.qZA()()}if(2&o){const n=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Oqu(n.text),e.xp6(1),e.Q6J("ngClass",i.getSubcategoryRemainingAmount(n)<0?"negative":""),e.xp6(1),e.hij(" ",i.formatCurrency(i.getSubcategoryRemainingAmount(n))," ")}}function y(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"span",18)(1,"ion-input",19,20),e.NdJ("ngModelChange",function(s){e.CHM(n);const v=e.oxw().$implicit;return e.KtG(v.text=s)})("ionFocus",function(){e.CHM(n);const s=e.oxw(3);return e.KtG(s.stopTimeout())})("ionBlur",function(){e.CHM(n);const s=e.oxw(3);return e.KtG(s.shouldWeSaveOrRemove())})("keyup.enter",function(){e.CHM(n);const s=e.oxw(3);return e.KtG(s.triggerIonBlur())})("keydown",function(s){e.CHM(n);const v=e.oxw(3);return e.KtG(v.hideKeyboard(s))}),e.qZA(),e.TgZ(3,"ion-note",21),e._uU(4),e.ALo(5,"currency"),e.qZA()()}if(2&o){const n=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngModel",n.text),e.xp6(3),e.Oqu(e.lcZ(5,2,i.getSubcategoryRemainingAmount(n)))}}function D(o,c){if(1&o&&(e.TgZ(0,"ion-item",11),e.YNc(1,h,1,0,"ion-icon",12),e.YNc(2,f,5,3,"span",13),e.YNc(3,y,6,4,"span",14),e.qZA()),2&o){const n=c.$implicit,i=e.oxw(2);e.Q6J("button",!n.isEditing&&!i.isUserRemovingCategories),e.xp6(1),e.Q6J("ngIf",i.isUserRemovingCategories),e.xp6(1),e.Q6J("ngIf",!n.isEditing),e.xp6(1),e.Q6J("ngIf",n.isEditing)}}function S(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,D,4,4,"ion-item",10),e.qZA()),2&o){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.subcategories)}}function E(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"ion-item",23),e.NdJ("click",function(){const v=e.CHM(n).index,U=e.oxw(2);return e.KtG(U.selectSubCategory(v))}),e.TgZ(1,"ion-label",24),e._uU(2),e.qZA()()}if(2&o){const n=c.$implicit;e.xp6(2),e.Oqu(n.text)}}function P(o,c){if(1&o&&(e.TgZ(0,"span"),e.YNc(1,E,3,1,"ion-item",22),e.qZA()),2&o){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.subcategories)}}function a(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",25),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.addNewSub())}),e._UZ(2,"ion-icon",26),e._uU(3," Add New Category "),e.qZA()()}}function m(o,c){if(1&o){const n=e.EpF();e.TgZ(0,"div",27)(1,"ion-button",28),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.deleteCategory(s.category,void 0))}),e.TgZ(2,"ion-icon",29),e.NdJ("click",function(){e.CHM(n);const s=e.oxw();return e.KtG(s.deleteCategory(s.category,void 0))}),e.qZA()()()}}const b=function(o){return{"padding-right":o}},C=function(o){return{width:o}};let A=(()=>{class o{constructor(n){this.alertService=n,this.isChecklist=!1,this.isUserReorderingCategories=!1,this.isUserRemovingCategories=!1,this.addNewSubEvent=new e.vpe,this.requestSaveOfSubs=new e.vpe,this.subcategorySelected=new e.vpe,this.requestDeleteCategory=new e.vpe,this.transactions=[]}ngOnInit(){this.checkDOMChange()}addNewSub(){this.addNewSubEvent.emit()}triggerIonBlur(){this.shouldWeSaveOrRemove()}checkDOMChange(){this.checker=setTimeout(()=>{const n=document.getElementsByClassName("new-sub");n.length>0&&n[0].childNodes[0].setFocus(),this.checkDOMChange()},100)}getSubcategoryRemainingAmount(n){return this.category.id?"income"===this.category.id?n.actual_amount+-1*n.planned_amount:n.planned_amount-n.actual_amount:0}stopTimeout(){clearTimeout(this.checker)}shouldWeSaveOrRemove(){this.subcategories.find(i=>i.isEditing)&&this.requestSaveOfSubs.emit()}deleteCategory(n,i){var s=this;return(0,d.Z)(function*(){"income"!==n.id||i?s.requestDeleteCategory.emit({cat:n,sub:i}):s.alertService.createAndShowToast("You cannot delete the income category")})()}openBudgetItem(n){var i=this;return(0,d.Z)(function*(){i.subcategorySelected.emit({sub:i.subcategories[n],cat:i.category})})()}selectSubCategory(n){this.subcategorySelected.emit(this.subcategories[n])}hideKeyboard(n){("Enter"==n.key||"enter"==n.key)&&t.N1.hide()}formatCurrency(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n<0?-n:n)}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(T.c))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-category"]],viewQuery:function(n,i){if(1&n&&(e.Gf(O,5),e.Gf(l,5)),2&n){let s;e.iGM(s=e.CRH())&&(i.nameInput=s.first),e.iGM(s=e.CRH())&&(i.fieldsContainer=s.first)}},inputs:{category:"category",subcategories:"subcategories",isChecklist:"isChecklist",chosenDate:"chosenDate",isUserReorderingCategories:"isUserReorderingCategories",isUserRemovingCategories:"isUserRemovingCategories"},outputs:{addNewSubEvent:"addNewSubEvent",requestSaveOfSubs:"requestSaveOfSubs",subcategorySelected:"subcategorySelected",requestDeleteCategory:"requestDeleteCategory"},decls:14,vars:13,consts:[[3,"ngStyle","id"],[2,"display","flex","align-items","center","justify-content","space-between"],[3,"ngStyle"],["id","subtitle"],["id","title"],["id","category",4,"ngIf"],["lines","none"],[4,"ngIf"],["style","display: flex; justify-content: flex-end",4,"ngIf"],["id","category"],["class","target","detail","false",3,"button",4,"ngFor","ngForOf"],["detail","false",1,"target",3,"button"],["style","color: var(--ion-color-danger); padding-right: 10px","name","remove-circle-outline",3,"click",4,"ngIf"],["class","saved-sub",3,"click",4,"ngIf"],["class","new-sub",4,"ngIf"],["name","remove-circle-outline",2,"color","var(--ion-color-danger)","padding-right","10px",3,"click"],[1,"saved-sub",3,"click"],[2,"text-align","end",3,"ngClass"],[1,"new-sub"],["placeholder","Name","autocapitalize","sentences","enterkeyhint","done","autocorrect","on",3,"ngModel","ngModelChange","ionFocus","ionBlur","keyup.enter","keydown"],["nameInput",""],[2,"text-align","end"],["class","target","button","",3,"click",4,"ngFor","ngForOf"],["button","",1,"target",3,"click"],["labelPlacement","start"],[1,"add-new",2,"cursor","pointer",3,"click"],["name","add"],[2,"display","flex","justify-content","flex-end"],["fill","clear","size","medium",3,"click"],["name","remove-circle-outline","slot","icon-only",2,"color","var(--ion-color-danger)",3,"click"]],template:function(n,i){1&n&&(e.TgZ(0,"ion-card",0)(1,"div",1)(2,"div",2)(3,"ion-card-header")(4,"ion-card-subtitle",3)(5,"span",4),e._uU(6),e.qZA(),e.YNc(7,p,2,0,"span",5),e.qZA()(),e.TgZ(8,"ion-card-content")(9,"ion-list",6),e.YNc(10,S,2,1,"span",7),e.YNc(11,P,2,1,"span",7),e.YNc(12,a,4,0,"ion-item",7),e.qZA()()(),e.YNc(13,m,3,0,"div",8),e.qZA()()),2&n&&(e.MGl("id","",i.category.id,"-card"),e.Q6J("ngStyle",e.VKq(9,b,i.isUserReorderingCategories?"34px":"0")),e.xp6(2),e.Q6J("ngStyle",e.VKq(11,C,i.isUserRemovingCategories&&"income"!==i.category.id?"90%":"100%")),e.xp6(4),e.Oqu(i.category.id),e.xp6(1),e.Q6J("ngIf",!i.isChecklist),e.xp6(3),e.Q6J("ngIf",!i.isChecklist),e.xp6(1),e.Q6J("ngIf",i.isChecklist),e.xp6(1),e.Q6J("ngIf",!i.isChecklist),e.xp6(1),e.Q6J("ngIf",i.isUserRemovingCategories&&"income"!==i.category.id))},dependencies:[g.mk,g.sg,g.O5,g.PC,_.JJ,_.On,u.YG,u.PM,u.FN,u.Zi,u.tO,u.gu,u.pK,u.Ie,u.Q$,u.q_,u.uN,u.j9,g.H9],styles:["ion-card[_ngcontent-%COMP%]{margin:0 0 28px}.add-new[_ngcontent-%COMP%]{font-size:small;opacity:.6;display:flex;flex-direction:row;align-items:center;justify-content:center}.new-sub[_ngcontent-%COMP%], .saved-sub[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%}.saved-sub[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{width:100%}#subtitle[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.negative[_ngcontent-%COMP%]{color:#f14242}"]}),o})()},3554:(Z,M,r)=>{r.d(M,{e:()=>g});var d=r(6814),e=r(95),t=r(5548),T=r(6689);let g=(()=>{class _{}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=T.oAB({type:_}),_.\u0275inj=T.cJS({imports:[d.ez,e.u5,t.Pc]}),_})()},98:(Z,M,r)=>{r.d(M,{m:()=>S});var d=r(5861),e=r(5548),t=r(6689),T=r(6635),g=r(6814),_=r(95),u=r(8647),O=r(1695);function l(E,P){if(1&E){const a=t.EpF();t.TgZ(0,"ion-datetime",13),t.NdJ("ionChange",function(b){t.CHM(a);const C=t.oxw();return t.KtG(C.dateChanged(b))}),t.qZA()}2&E&&t.Q6J("preferWheel",!0)}function p(E,P){if(1&E&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&E){const a=t.oxw();t.xp6(1),t.Oqu(a.selectedSub)}}const h=function(){return[]};function f(E,P){if(1&E){const a=t.EpF();t.TgZ(0,"span")(1,"app-category",21),t.NdJ("subcategorySelected",function(b){const A=t.CHM(a).$implicit,o=t.oxw(2);return t.KtG(o.subcategorySelected(b,A))}),t.qZA()()}if(2&E){const a=P.$implicit;let m;t.xp6(1),t.Q6J("category",a)("isChecklist",!0)("subcategories",null!==(m=a.subcategories)&&void 0!==m?m:t.DdM(3,h))}}function y(E,P){if(1&E){const a=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3,"Pick a Category"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t.NdJ("click",function(){t.CHM(a),t.oxw();const b=t.MAs(41);return t.KtG(b.dismiss())}),t._uU(6,"Close"),t.qZA()()()(),t.TgZ(7,"ion-content")(8,"div",14),t.YNc(9,f,2,4,"span",15),t.TgZ(10,"span",16)(11,"ion-card",17)(12,"ion-card-header")(13,"ion-card-subtitle",18)(14,"span",19),t._uU(15,"None"),t.qZA()()(),t.TgZ(16,"ion-card-content")(17,"ion-item",20),t.NdJ("click",function(){t.CHM(a);const b=t.oxw();return t.KtG(b.selectedNoSub())}),t.TgZ(18,"ion-label"),t._uU(19,"Uncategorized"),t.qZA()()()()()()()}if(2&E){const a=t.oxw();t.xp6(9),t.Q6J("ngForOf",a.categories)}}const D=function(){return{prefix:"$ ",thousands:",",decimal:"."}};let S=(()=>{class E{constructor(a,m){this.modalCtrl=a,this.transactionPublisher=m,this.transactionAmountUserView=0}ngOnInit(){var a=this;return(0,d.Z)(function*(){a.isIncome=a.transaction.amount<0,a.transactionAmountUserView=a.getAmount()})()}ngAfterViewInit(){var a=this;return(0,d.Z)(function*(){const m=a.transaction.date.getTimezoneOffset(),b=new Date(a.transaction.date.getTime()-60*m*1e3);a.ionDatetime.value=b.toISOString()})()}save(){var a=this;return(0,d.Z)(function*(){a.transaction.amount=a.isIncome?-a.transactionAmountUserView:a.transactionAmountUserView,console.log(a.transaction),a.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[a.transaction],removedTransactions:[]}),a.modalCtrl.dismiss()})()}subcategorySelected(a,m){this.modalCtrl.dismiss(),this.transaction.subcategoryId=a.id,this.isIncome="income"===m.id}selectedNoSub(){this.modalCtrl.dismiss(),this.transaction.subcategoryId="",this.isIncome=!1}dateChanged(a){this.transaction.date=new Date(a.detail.value)}getAmount(){return this.transaction.amount>=0?this.transaction.amount:-this.transaction.amount}}return E.\u0275fac=function(a){return new(a||E)(t.Y36(e.IN),t.Y36(T.u))},E.\u0275cmp=t.Xpm({type:E,selectors:[["app-transaction-sorter"]],viewQuery:function(a,m){if(1&a&&t.Gf(e.x4,5),2&a){let b;t.iGM(b=t.CRH())&&(m.ionDatetime=b.first)}},decls:43,vars:8,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end"],["slot","end","datetime","datetime"],["slot","end","placeholder","$0.00","type","decimal","currencyMask","","inputmode","decimal",1,"ngx-currency-input",3,"ngModel","options","ngModelChange"],["placeholder","Name","slot","end","type","text",3,"ngModel","ngModelChange"],[3,"keepContentsMounted"],["lines","none"],["button","","id","open-modal"],[4,"ngIf"],["trigger","open-modal",3,"presentingElement"],["modal",""],["id","datetime","presentation","date",3,"preferWheel","ionChange"],[2,"width","90%","margin","28px auto 0 auto"],[4,"ngFor","ngForOf"],["id","no-category"],[2,"margin","0 0 28px 0"],["id","subtitle"],["id","title"],["button","","lines","none",1,"target",3,"click"],[3,"category","isChecklist","subcategories","subcategorySelected"]],template:function(a,m){1&a&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),t.NdJ("click",function(){return m.modalCtrl.dismiss()}),t._uU(4,"Cancel"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Update Transaction"),t.qZA(),t.TgZ(7,"ion-buttons",3)(8,"ion-button",2),t.NdJ("click",function(){return m.save()}),t._uU(9,"Save"),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"ion-card")(12,"ion-card-content")(13,"ion-list")(14,"ion-item")(15,"ion-label"),t._uU(16,"Date"),t.qZA(),t._UZ(17,"ion-datetime-button",4),t.qZA(),t.TgZ(18,"ion-item")(19,"ion-label"),t._uU(20,"Amount"),t.qZA(),t.TgZ(21,"input",5),t.NdJ("ngModelChange",function(C){return m.transactionAmountUserView=C}),t.qZA()(),t.TgZ(22,"ion-item")(23,"ion-label"),t._uU(24,"Transaction"),t.qZA(),t.TgZ(25,"ion-input",6),t.NdJ("ngModelChange",function(C){return m.transaction.name=C}),t.qZA()(),t.TgZ(26,"ion-item")(27,"ion-label"),t._uU(28,"Merchant"),t.qZA(),t.TgZ(29,"ion-input",6),t.NdJ("ngModelChange",function(C){return m.transaction.merchant_name=C}),t.qZA()()(),t.TgZ(30,"ion-modal",7),t.YNc(31,l,1,1,"ng-template"),t.qZA()()(),t.TgZ(32,"ion-card")(33,"ion-card-content")(34,"ion-list",8)(35,"ion-item",9)(36,"ion-label"),t._uU(37,"Budget Category"),t.qZA(),t._UZ(38,"br"),t.YNc(39,p,2,1,"p",10),t.qZA()()()(),t.TgZ(40,"ion-modal",11,12),t.YNc(42,y,20,1,"ng-template"),t.qZA()()),2&a&&(t.xp6(21),t.Q6J("ngModel",m.transactionAmountUserView)("options",t.DdM(7,D)),t.xp6(4),t.Q6J("ngModel",m.transaction.name),t.xp6(4),t.Q6J("ngModel",m.transaction.merchant_name),t.xp6(1),t.Q6J("keepContentsMounted",!0),t.xp6(9),t.Q6J("ngIf",m.transaction.subcategoryId),t.xp6(1),t.Q6J("presentingElement",m.presentingElement))},dependencies:[g.sg,g.O5,_.Fj,_.JJ,_.On,e.YG,e.Sm,e.PM,e.FN,e.Zi,e.tO,e.W2,e.x4,e.Mj,e.Gu,e.pK,e.Ie,e.Q$,e.q_,e.wd,e.sr,e.ki,e.QI,e.j9,u.xv,O.m],styles:["#segment[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#segment[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:90%;margin-top:25px}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff}ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{color:#fff}ion-input[_ngcontent-%COMP%]{text-align:end}ion-datetime-button[_ngcontent-%COMP%]::part(native){background:#fff;padding-right:5px}"]}),E})()},8452:(Z,M,r)=>{r.d(M,{q:()=>_});var d=r(5861),e=r(4092),t=r(182),T=r(15),g=r(6689);let _=(()=>{class u extends e.q{constructor(){super(t.lN)}get(l,p){var h=()=>super._get,f=this;return(0,d.Z)(function*(){const y=yield h().call(f,u.makeCollectionRef(l),p);return f.convertTimestampToDate(y)})()}getAll(){var l=()=>super._getAll,p=this;return(0,d.Z)(function*(){const h=yield l().call(p);return h.docs&&(h.docs=h.docs.map(f=>p.convertTimestampToDate(f))),h})()}getAllFromParent(l){var p=()=>super._getAllFromParent,h=this;return(0,d.Z)(function*(){const f=yield p().call(h,u.makeCollectionRef(l));return f.docs&&(f.docs=f.docs.map(y=>h.convertTimestampToDate(y))),f})()}getByQuery(l){var p=()=>super._getByQuery,h=this;return(0,d.Z)(function*(){const f=yield p().call(h,l);return f.docs&&(f.docs=f.docs.map(y=>h.convertTimestampToDate(y))),f})()}add(l,p,h){var f=()=>super._add,y=this;return(0,d.Z)(function*(){return f().call(y,u.makeCollectionRef(l),p,h)})()}update(l,p,h){var f=()=>super._update,y=this;return(0,d.Z)(function*(){return f().call(y,u.makeCollectionRef(l),p,h)})()}delete(l,p,h=!1){var f=()=>super._delete,y=this;return(0,d.Z)(function*(){return f().call(y,u.makeCollectionRef(l),p,h)})()}static makeCollectionRef(l){return(0,T.hJ)((0,T.ad)(),t.YP,l,t.lN)}convertTimestampToDate(l){if(!l)return l;const p=l.last_transaction_retrieval;return p&&(l.last_transaction_retrieval=p.toDate()),l}}return u.\u0275fac=function(l){return new(l||u)},u.\u0275prov=g.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},1269:(Z,M,r)=>{r.d(M,{O:()=>t});var d=r(6689),e=r(9862);let t=(()=>{class T{constructor(_){this.http=_}post(_,u){return this.http.post(_,u,{headers:this.getHeaders()})}getHeaders(){return{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}}return T.\u0275fac=function(_){return new(_||T)(d.LFG(e.eN))},T.\u0275prov=d.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})()},7087:(Z,M,r)=>{r.d(M,{O:()=>b});var d=r(5861),e=r(6306),t=r(6973);function T(C,A){const o="object"==typeof A;return new Promise((c,n)=>{let s,i=!1;C.subscribe({next:v=>{s=v,i=!0},error:n,complete:()=>{i?c(s):o?c(A.defaultValue):n(new t.K)}})})}var g=r(553);const _=g.N.useFunctionsEmulator&&!g.N.production?"http://localhost:5001/balanced-budget-90f1f/us-central1/":"https://us-central1-balanced-budget-90f1f.cloudfunctions.net/",u=_+"getTransactionData",O=_+"createPlaidLinkToken",l=_+"exchangePublicToken",h=_+"removeLinkedAccount";function f(C){const A=C.datetime?new Date(C.datetime):new Date(C.date);return{id:C.transaction_id,amount:C.amount,subcategoryId:"",date:A,merchant_name:C.merchant_name,name:C.name,pending:C.pending}}var y=r(6689),D=r(1269),S=r(8452),E=r(7195),P=r(6635),a=r(5548),m=r(3076);let b=(()=>{class C{get plaidAvailable(){return this.userService.isPremium}constructor(o,c,n,i,s,v){this.http=o,this.linkedAccountsRepository=c,this.userRepository=n,this.transactionPublisher=i,this.loadingController=s,this.userService=v}linkPlaidToUser(){var o=this;return(0,d.Z)(function*(){if(!o.plaidAvailable)return;const c=yield o.loadingController.create();yield c.present(),o.http.post(O,{user_id:o.userRepository.getCurrentUserId()}).pipe((0,e.K)(n=>(console.log(n),c.dismiss(),n))).subscribe(n=>{console.log(n);const i=o.createPlaidHandler(n.link_token);c.dismiss(),i.open()})})()}syncPlaidTransactions(){var o=this;return(0,d.Z)(function*(){if(!o.plaidAvailable)return;const c=o.userRepository.getCurrentUserId();if(!c)throw new Error("User is not logged in");const n=(yield o.linkedAccountsRepository.getAllFromParent(c)).docs;if(0===n.length)return;const i=[];for(let x of n)(yield o.shouldSyncTransactions(x))&&i.push(T(o.http.post(u,{userId:c,linkedAccount:x,linkedAccountId:x.id})));const s=yield Promise.all(i);let v=[],U=[],I=[];for(let x=0;x<s.length;x++){const R=s[x];v=v.concat(R.added),U=U.concat(R.removed),I=I.concat(R.modified)}o.plaidTransactionSyncHandler(v,U,I,!0)})()}removePlaidLinkedAccount(o){var c=this;return(0,d.Z)(function*(){const n=c.userRepository.getCurrentUserId();if(!n)throw new Error("User is not logged in");c.http.post(h,{user_id:n,linked_account_id:o.id}).subscribe(i=>{console.log(i)})})()}createPlaidHandler(o){return Plaid.create({token:o,onSuccess:this.plaidHandlerOnSuccessCallback.bind(this),onExit:this.plaidHandlerOnExitCallback.bind(this),onLoad:this.plaidHandlerOnLoadCallback.bind(this),onEvent:this.plaidHandlerOnEventCallback.bind(this),receivedRedirectUri:null})}plaidHandlerOnSuccessCallback(o,c){this.http.post(l,{publicToken:o,institutionName:c.institution.name,userId:this.userRepository.getCurrentUserId()}).subscribe(n=>{console.log(n);const{added:i,removed:s,modified:v}=n;this.plaidTransactionSyncHandler(i,s,v,!0)})}plaidHandlerOnExitCallback(o,c){return(0,d.Z)(function*(){console.log(o)})()}plaidHandlerOnLoadCallback(){return(0,d.Z)(function*(){})()}plaidHandlerOnEventCallback(o,c){return(0,d.Z)(function*(){})()}plaidTransactionSyncHandler(o,c,n,i=!0){var s=this;return(0,d.Z)(function*(){const x={from:"plaid",addedTransactions:o.map(f),removedTransactions:c.map(f),modifiedTransactions:n.map(f)};return i&&s.transactionPublisher.publishEvent(x),x})()}shouldSyncTransactions(o){return(0,d.Z)(function*(){if(!o.last_transaction_retrieval)return!0;const n=o.last_transaction_retrieval;return(new Date).getTime()-n.getTime()>3e5})()}}return C.\u0275fac=function(o){return new(o||C)(y.LFG(D.O),y.LFG(S.q),y.LFG(E.E),y.LFG(P.u),y.LFG(a.HT),y.LFG(m.K))},C.\u0275prov=y.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},6635:(Z,M,r)=>{r.d(M,{u:()=>e});var d=r(6689);let e=(()=>{class t{constructor(){this.subscribers=new Set}publishEvent(g){console.log("Publishing event",g),this.subscribers.forEach(_=>{_.onTransactionEvent(g)})}subscribe(g){this.subscribers.add(g)}unsubscribe(g){this.subscribers.delete(g)}}return t.\u0275fac=function(g){return new(g||t)},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},3076:(Z,M,r)=>{r.d(M,{K:()=>g});var d=r(5861),e=r(6689),t=r(1776),T=r(7195);let g=(()=>{class _{constructor(O,l){this.authService=O,this.userRepository=l,this.userRepository.currentFirestoreUser.subscribe(p=>{p&&(this.isPremium=p.subscribed)})}updatePremiumStatus(O){var l=this;return(0,d.Z)(function*(){const p=yield l.authService.getCurrentAuthUser();!p||!p.uid||(l.isPremium=O,l.userRepository.update(p.uid,{subscribed:O,token:l.authService.userToken}))})()}}return _.\u0275fac=function(O){return new(O||_)(e.LFG(t.e),e.LFG(T.E))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);