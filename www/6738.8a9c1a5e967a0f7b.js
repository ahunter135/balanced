"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6738],{7258:(A,v,a)=>{a.d(v,{N1:()=>t});const t=(0,a(2726).fo)("Keyboard")},1695:(A,v,a)=>{a.d(v,{m:()=>T});var d=a(5861),t=a(6689),e=a(7258),C=a(6814),f=a(95),u=a(5548);const M=["nameInput"],Z=["fieldsContainer"];function S(c,y){1&c&&(t.TgZ(0,"span",6),t._uU(1,"Remaining"),t.qZA())}function N(c,y){if(1&c){const i=t.EpF();t.TgZ(0,"span",11),t.NdJ("click",function(){t.CHM(i);const p=t.oxw().index,o=t.oxw(2);return t.KtG(o.openBudgetItem(p))}),t.TgZ(1,"ion-label"),t._uU(2),t.qZA(),t.TgZ(3,"ion-note",12),t._uU(4),t.qZA()()}if(2&c){const i=t.oxw().$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(i.text),t.xp6(1),t.Q6J("ngClass",n.getSubcategoryRemainingAmount(i)<0?"negative":""),t.xp6(1),t.hij(" ",n.formatCurrency(n.getSubcategoryRemainingAmount(i))," ")}}function x(c,y){if(1&c){const i=t.EpF();t.TgZ(0,"span",13)(1,"ion-input",14,15),t.NdJ("ngModelChange",function(p){t.CHM(i);const o=t.oxw().$implicit;return t.KtG(o.text=p)})("ionFocus",function(){t.CHM(i);const p=t.oxw(3);return t.KtG(p.stopTimeout())})("ionBlur",function(){t.CHM(i);const p=t.oxw(3);return t.KtG(p.shouldWeSaveOrRemove())})("keyup.enter",function(){t.CHM(i);const p=t.oxw(3);return t.KtG(p.triggerIonBlur())})("keydown",function(p){t.CHM(i);const o=t.oxw(3);return t.KtG(o.hideKeyboard(p))}),t.qZA(),t.TgZ(3,"ion-note",16),t._uU(4),t.ALo(5,"currency"),t.qZA()()}if(2&c){const i=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngModel",i.text),t.xp6(3),t.Oqu(t.lcZ(5,2,n.getSubcategoryRemainingAmount(i)))}}function E(c,y){if(1&c&&(t.TgZ(0,"ion-item",8),t.YNc(1,N,5,3,"span",9),t.YNc(2,x,6,4,"span",10),t.qZA()),2&c){const i=y.$implicit;t.Q6J("button",!i.isEditing),t.xp6(1),t.Q6J("ngIf",!i.isEditing),t.xp6(1),t.Q6J("ngIf",i.isEditing)}}function I(c,y){if(1&c&&(t.TgZ(0,"span"),t.YNc(1,E,3,3,"ion-item",7),t.qZA()),2&c){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i.subcategories)}}function h(c,y){if(1&c){const i=t.EpF();t.TgZ(0,"ion-item",18),t.NdJ("click",function(){const o=t.CHM(i).index,r=t.oxw(2);return t.KtG(r.selectSubCategory(o))}),t.TgZ(1,"ion-label",19),t._uU(2),t.qZA()()}if(2&c){const i=y.$implicit;t.xp6(2),t.Oqu(i.text)}}function b(c,y){if(1&c&&(t.TgZ(0,"span"),t.YNc(1,h,3,1,"ion-item",17),t.qZA()),2&c){const i=t.oxw();t.xp6(1),t.Q6J("ngForOf",i.subcategories)}}function s(c,y){if(1&c){const i=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",20),t.NdJ("click",function(){t.CHM(i);const p=t.oxw();return t.KtG(p.addNewSub())}),t._UZ(2,"ion-icon",21),t._uU(3," Add New Category "),t.qZA()()}}const m=function(c){return{"padding-right":c}};let T=(()=>{class c{constructor(){this.isChecklist=!1,this.isUserReorderingCategories=!1,this.addNewSubEvent=new t.vpe,this.requestSaveOfSubs=new t.vpe,this.subcategorySelected=new t.vpe,this.transactions=[]}ngOnInit(){this.checkDOMChange()}addNewSub(){this.addNewSubEvent.emit()}triggerIonBlur(){this.shouldWeSaveOrRemove()}checkDOMChange(){this.checker=setTimeout(()=>{const i=document.getElementsByClassName("new-sub");i.length>0&&i[0].childNodes[0].setFocus(),this.checkDOMChange()},100)}getSubcategoryRemainingAmount(i){return this.category.id?"income"===this.category.id?i.actual_amount+-1*i.planned_amount:i.planned_amount-i.actual_amount:0}stopTimeout(){clearTimeout(this.checker)}shouldWeSaveOrRemove(){this.subcategories.find(n=>n.isEditing)&&this.requestSaveOfSubs.emit()}openBudgetItem(i){var n=this;return(0,d.Z)(function*(){n.subcategorySelected.emit({sub:n.subcategories[i],cat:n.category})})()}selectSubCategory(i){this.subcategorySelected.emit(this.subcategories[i])}hideKeyboard(i){("Enter"==i.key||"enter"==i.key)&&e.N1.hide()}formatCurrency(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i<0?-i:i)}}return c.\u0275fac=function(i){return new(i||c)},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-category"]],viewQuery:function(i,n){if(1&i&&(t.Gf(M,5),t.Gf(Z,5)),2&i){let p;t.iGM(p=t.CRH())&&(n.nameInput=p.first),t.iGM(p=t.CRH())&&(n.fieldsContainer=p.first)}},inputs:{category:"category",subcategories:"subcategories",isChecklist:"isChecklist",chosenDate:"chosenDate",isUserReorderingCategories:"isUserReorderingCategories"},outputs:{addNewSubEvent:"addNewSubEvent",requestSaveOfSubs:"requestSaveOfSubs",subcategorySelected:"subcategorySelected"},decls:11,vars:9,consts:[[3,"ngStyle","id"],["id","subtitle"],["id","title"],["id","category",4,"ngIf"],["lines","none"],[4,"ngIf"],["id","category"],["class","target","detail","false",3,"button",4,"ngFor","ngForOf"],["detail","false",1,"target",3,"button"],["class","saved-sub",3,"click",4,"ngIf"],["class","new-sub",4,"ngIf"],[1,"saved-sub",3,"click"],[2,"text-align","end",3,"ngClass"],[1,"new-sub"],["placeholder","Name","autocapitalize","sentences","enterkeyhint","done","autocorrect","on",3,"ngModel","ngModelChange","ionFocus","ionBlur","keyup.enter","keydown"],["nameInput",""],[2,"text-align","end"],["class","target","button","",3,"click",4,"ngFor","ngForOf"],["button","",1,"target",3,"click"],["labelPlacement","start"],[1,"add-new",2,"cursor","pointer",3,"click"],["name","add"]],template:function(i,n){1&i&&(t.TgZ(0,"ion-card",0)(1,"ion-card-header")(2,"ion-card-subtitle",1)(3,"span",2),t._uU(4),t.qZA(),t.YNc(5,S,2,0,"span",3),t.qZA()(),t.TgZ(6,"ion-card-content")(7,"ion-list",4),t.YNc(8,I,2,1,"span",5),t.YNc(9,b,2,1,"span",5),t.YNc(10,s,4,0,"ion-item",5),t.qZA()()()),2&i&&(t.MGl("id","",n.category.id,"-card"),t.Q6J("ngStyle",t.VKq(7,m,n.isUserReorderingCategories?"34px":"0")),t.xp6(4),t.Oqu(n.category.id),t.xp6(1),t.Q6J("ngIf",!n.isChecklist),t.xp6(3),t.Q6J("ngIf",!n.isChecklist),t.xp6(1),t.Q6J("ngIf",n.isChecklist),t.xp6(1),t.Q6J("ngIf",!n.isChecklist))},dependencies:[C.mk,C.sg,C.O5,C.PC,f.JJ,f.On,u.PM,u.FN,u.Zi,u.tO,u.gu,u.pK,u.Ie,u.Q$,u.q_,u.uN,u.j9,C.H9],styles:["ion-card[_ngcontent-%COMP%]{margin:0 0 28px}.add-new[_ngcontent-%COMP%]{font-size:small;opacity:.6;display:flex;flex-direction:row;align-items:center;justify-content:center}.new-sub[_ngcontent-%COMP%], .saved-sub[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%}.saved-sub[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{width:100%}#subtitle[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.negative[_ngcontent-%COMP%]{color:#f14242}"]}),c})()},3554:(A,v,a)=>{a.d(v,{e:()=>f});var d=a(6814),t=a(95),e=a(5548),C=a(6689);let f=(()=>{class u{}return u.\u0275fac=function(Z){return new(Z||u)},u.\u0275mod=C.oAB({type:u}),u.\u0275inj=C.cJS({imports:[d.ez,t.u5,e.Pc]}),u})()},98:(A,v,a)=>{a.d(v,{m:()=>I});var d=a(5861),t=a(5548),e=a(6689),C=a(6635),f=a(6814),u=a(95),M=a(1695);function Z(h,b){if(1&h){const s=e.EpF();e.TgZ(0,"ion-datetime",12),e.NdJ("ionChange",function(T){e.CHM(s);const c=e.oxw();return e.KtG(c.dateChanged(T))}),e.qZA()}2&h&&e.Q6J("preferWheel",!0)}function S(h,b){if(1&h&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&h){const s=e.oxw();e.xp6(1),e.Oqu(s.selectedSub)}}const N=function(){return[]};function x(h,b){if(1&h){const s=e.EpF();e.TgZ(0,"span")(1,"app-category",14),e.NdJ("subcategorySelected",function(T){e.CHM(s);const c=e.oxw(2);return e.KtG(c.subcategorySelected(T))}),e.qZA()()}if(2&h){const s=b.$implicit;let m;e.xp6(1),e.Q6J("category",s)("isChecklist",!0)("subcategories",null!==(m=s.subcategories)&&void 0!==m?m:e.DdM(3,N))}}function E(h,b){if(1&h){const s=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"Pick a Category"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e.NdJ("click",function(){e.CHM(s),e.oxw();const T=e.MAs(43);return e.KtG(T.dismiss())}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content"),e.YNc(8,x,2,4,"span",13),e.qZA()}if(2&h){const s=e.oxw();e.xp6(8),e.Q6J("ngForOf",s.categories)}}let I=(()=>{class h{constructor(s,m){this.modalCtrl=s,this.transactionPublisher=m}ngAfterViewInit(){var s=this;return(0,d.Z)(function*(){const m=s.transaction.date.getTimezoneOffset(),T=new Date(s.transaction.date.getTime()-60*m*1e3);s.ionDatetime.value=T.toISOString()})()}save(){var s=this;return(0,d.Z)(function*(){s.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[s.transaction],removedTransactions:[]}),s.modalCtrl.dismiss()})()}subcategorySelected(s){this.modalCtrl.dismiss(),this.transaction.subcategoryId=s.id,console.log(this.transaction)}dateChanged(s){this.transaction.date=new Date(s.detail.value)}getAmount(){return this.transaction.amount>=0?this.transaction.amount:-this.transaction.amount}}return h.\u0275fac=function(s){return new(s||h)(e.Y36(t.IN),e.Y36(C.u))},h.\u0275cmp=e.Xpm({type:h,selectors:[["app-transaction-sorter"]],viewQuery:function(s,m){if(1&s&&e.Gf(t.x4,5),2&s){let T;e.iGM(T=e.CRH())&&(m.ionDatetime=T.first)}},decls:45,vars:8,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end"],["slot","end","datetime","datetime"],["placeholder","Name","slot","end","type","text",3,"ngModel","ngModelChange"],[3,"keepContentsMounted"],["lines","none"],["button","","id","open-modal"],[4,"ngIf"],["trigger","open-modal",3,"presentingElement"],["modal",""],["id","datetime","presentation","date",3,"preferWheel","ionChange"],[4,"ngFor","ngForOf"],[3,"category","isChecklist","subcategories","subcategorySelected"]],template:function(s,m){1&s&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return m.modalCtrl.dismiss()}),e._uU(4,"Cancel"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Update Transaction"),e.qZA(),e.TgZ(7,"ion-buttons",3)(8,"ion-button",2),e.NdJ("click",function(){return m.save()}),e._uU(9,"Save"),e.qZA()()()(),e.TgZ(10,"ion-content")(11,"ion-card")(12,"ion-card-content")(13,"ion-list")(14,"ion-item")(15,"ion-label"),e._uU(16,"Date"),e.qZA(),e._UZ(17,"ion-datetime-button",4),e.qZA(),e.TgZ(18,"ion-item")(19,"ion-label"),e._uU(20,"Amount"),e.qZA(),e.TgZ(21,"p"),e._uU(22),e.ALo(23,"currency"),e.qZA()(),e.TgZ(24,"ion-item")(25,"ion-label"),e._uU(26,"Transaction"),e.qZA(),e.TgZ(27,"ion-input",5),e.NdJ("ngModelChange",function(c){return m.transaction.name=c}),e.qZA()(),e.TgZ(28,"ion-item")(29,"ion-label"),e._uU(30,"Merchant"),e.qZA(),e.TgZ(31,"ion-input",5),e.NdJ("ngModelChange",function(c){return m.transaction.merchant_name=c}),e.qZA()()(),e.TgZ(32,"ion-modal",6),e.YNc(33,Z,1,1,"ng-template"),e.qZA()()(),e.TgZ(34,"ion-card")(35,"ion-card-content")(36,"ion-list",7)(37,"ion-item",8)(38,"ion-label"),e._uU(39,"Budget Category"),e.qZA(),e._UZ(40,"br"),e.YNc(41,S,2,1,"p",9),e.qZA()()()(),e.TgZ(42,"ion-modal",10,11),e.YNc(44,E,9,1,"ng-template"),e.qZA()()),2&s&&(e.xp6(22),e.Oqu(e.lcZ(23,6,m.getAmount())),e.xp6(5),e.Q6J("ngModel",m.transaction.name),e.xp6(4),e.Q6J("ngModel",m.transaction.merchant_name),e.xp6(1),e.Q6J("keepContentsMounted",!0),e.xp6(9),e.Q6J("ngIf",m.transaction.subcategoryId),e.xp6(1),e.Q6J("presentingElement",m.presentingElement))},dependencies:[f.sg,f.O5,u.JJ,u.On,t.YG,t.Sm,t.PM,t.FN,t.W2,t.x4,t.Mj,t.Gu,t.pK,t.Ie,t.Q$,t.q_,t.wd,t.sr,t.ki,t.QI,t.j9,M.m,f.H9],styles:["#segment[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#segment[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:90%;margin-top:25px}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff}ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{color:#fff}ion-input[_ngcontent-%COMP%]{text-align:end}ion-datetime-button[_ngcontent-%COMP%]::part(native){background:#fff;padding-right:5px}"]}),h})()},1269:(A,v,a)=>{a.d(v,{O:()=>e});var d=a(6689),t=a(9862);let e=(()=>{class C{constructor(u){this.http=u}post(u,M){return this.http.post(u,M,{headers:this.getHeaders()})}getHeaders(){return{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}}return C.\u0275fac=function(u){return new(u||C)(d.LFG(t.eN))},C.\u0275prov=d.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},3990:(A,v,a)=>{a.d(v,{O:()=>i});var d=a(5861),t=a(6306),e=a(6973);function C(n,p){const o="object"==typeof p;return new Promise((r,l)=>{let g,_=!1;n.subscribe({next:P=>{g=P,_=!0},error:l,complete:()=>{_?r(g):o?r(p.defaultValue):l(new e.K)}})})}var f=a(553);const u=f.N.useFunctionsEmulator&&!f.N.production?"http://localhost:5001/balanced-budget-90f1f/us-central1/":"https://us-central1-balanced-budget-90f1f.cloudfunctions.net/",M=u+"getTransactionData",Z=u+"createPlaidLinkToken",S=u+"exchangePublicToken";function x(n){const p=n.datetime?new Date(n.datetime):new Date(n.date);return{id:n.transaction_id,amount:n.amount,subcategoryId:"",date:p,merchant_name:n.merchant_name,name:n.name,pending:n.pending}}var E=a(6689),I=a(1269),h=a(4092),b=a(182),s=a(15);let m=(()=>{class n extends h.q{constructor(){super(b.lN)}get(o,r){var l=()=>super._get,_=this;return(0,d.Z)(function*(){const g=yield l().call(_,n.makeCollectionRef(o),r);return _.convertTimestampToDate(g)})()}getAll(){var o=()=>super._getAll,r=this;return(0,d.Z)(function*(){const l=yield o().call(r);return l.docs&&(l.docs=l.docs.map(_=>r.convertTimestampToDate(_))),l})()}getAllFromParent(o){var r=()=>super._getAllFromParent,l=this;return(0,d.Z)(function*(){const _=yield r().call(l,n.makeCollectionRef(o));return _.docs&&(_.docs=_.docs.map(g=>l.convertTimestampToDate(g))),_})()}getByQuery(o){var r=()=>super._getByQuery,l=this;return(0,d.Z)(function*(){const _=yield r().call(l,o);return _.docs&&(_.docs=_.docs.map(g=>l.convertTimestampToDate(g))),_})()}add(o,r,l){var _=()=>super._add,g=this;return(0,d.Z)(function*(){return _().call(g,n.makeCollectionRef(o),r,l)})()}update(o,r,l){var _=()=>super._update,g=this;return(0,d.Z)(function*(){return _().call(g,n.makeCollectionRef(o),r,l)})()}delete(o,r,l=!1){var _=()=>super._delete,g=this;return(0,d.Z)(function*(){return _().call(g,n.makeCollectionRef(o),r,l)})()}static makeCollectionRef(o){return(0,s.hJ)((0,s.ad)(),b.YP,o,b.lN)}convertTimestampToDate(o){if(!o)return o;const r=o.last_transaction_retrieval;return r&&(o.last_transaction_retrieval=r.toDate()),o}}return n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var T=a(7195),c=a(6635),y=a(5548);let i=(()=>{class n{constructor(o,r,l,_,g){this.http=o,this.linkedAccountsRepository=r,this.userRepository=l,this.transactionPublisher=_,this.loadingController=g}linkPlaidToUser(){var o=this;return(0,d.Z)(function*(){const r=yield o.loadingController.create();yield r.present(),o.http.post(Z,{user_id:o.userRepository.getCurrentUserId()}).pipe((0,t.K)(l=>(console.log(l),r.dismiss(),l))).subscribe(l=>{console.log(l);const _=o.createPlaidHandler(l.link_token);r.dismiss(),_.open()})})()}syncPlaidTransactions(){var o=this;return(0,d.Z)(function*(){const r=o.userRepository.getCurrentUserId();if(!r)throw new Error("User is not logged in");const l=(yield o.linkedAccountsRepository.getAllFromParent(r)).docs;if(0===l.length)return;const _=[];for(let O of l)(yield o.shouldSyncTransactions(O))&&_.push(C(o.http.post(M,{userId:r,linkedAccount:O,linkedAccountId:O.id})));const g=yield Promise.all(_);let P=[],D=[],U=[];for(let O=0;O<g.length;O++){const R=g[O];P=P.concat(R.added),D=D.concat(R.removed),U=U.concat(R.modified)}o.plaidTransactionSyncHandler(P,D,U,!0)})()}createPlaidHandler(o){return Plaid.create({token:o,onSuccess:this.plaidHandlerOnSuccessCallback.bind(this),onExit:this.plaidHandlerOnExitCallback.bind(this),onLoad:this.plaidHandlerOnLoadCallback.bind(this),onEvent:this.plaidHandlerOnEventCallback.bind(this),receivedRedirectUri:null})}plaidHandlerOnSuccessCallback(o,r){this.http.post(S,{publicToken:o,institutionName:r.institution.name,userId:this.userRepository.getCurrentUserId()}).subscribe(l=>{console.log(l);const{added:_,removed:g,modified:P}=l;this.plaidTransactionSyncHandler(_,g,P,!0)})}plaidHandlerOnExitCallback(o,r){return(0,d.Z)(function*(){console.log(o)})()}plaidHandlerOnLoadCallback(){return(0,d.Z)(function*(){})()}plaidHandlerOnEventCallback(o,r){return(0,d.Z)(function*(){})()}plaidTransactionSyncHandler(o,r,l,_=!0){var g=this;return(0,d.Z)(function*(){const O={from:"plaid",addedTransactions:o.map(x),removedTransactions:r.map(x),modifiedTransactions:l.map(x)};return _&&g.transactionPublisher.publishEvent(O),O})()}shouldSyncTransactions(o){return(0,d.Z)(function*(){if(!o.last_transaction_retrieval)return!0;const l=o.last_transaction_retrieval;return(new Date).getTime()-l.getTime()>3e5})()}}return n.\u0275fac=function(o){return new(o||n)(E.LFG(I.O),E.LFG(m),E.LFG(T.E),E.LFG(c.u),E.LFG(y.HT))},n.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},6635:(A,v,a)=>{a.d(v,{u:()=>t});var d=a(6689);let t=(()=>{class e{constructor(){this.subscribers=new Set}publishEvent(f){console.log("Publishing event",f),this.subscribers.forEach(u=>{u.onTransactionEvent(f)})}subscribe(f){this.subscribers.add(f)}unsubscribe(f){this.subscribers.delete(f)}}return e.\u0275fac=function(f){return new(f||e)},e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);