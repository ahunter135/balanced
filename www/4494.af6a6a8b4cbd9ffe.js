"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4494],{7258:(S,O,r)=>{r.d(O,{N1:()=>e});const e=(0,r(2726).fo)("Keyboard")},1695:(S,O,r)=>{r.d(O,{m:()=>v});var l=r(5861),e=r(6689),t=r(7258),b=r(3251),g=r(6814),d=r(95),_=r(5548);const U=["nameInput"],p=["fieldsContainer"];function h(c,s){1&c&&(e.TgZ(0,"span",9),e._uU(1,"Remaining"),e.qZA())}function T(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"ion-icon",15),e.NdJ("click",function(){e.CHM(n);const a=e.oxw().$implicit,m=e.oxw(2);return e.KtG(m.deleteCategory(m.category,a))}),e.qZA()}}function f(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"span",16),e.NdJ("click",function(){e.CHM(n);const a=e.oxw().index,m=e.oxw(2);return e.KtG(m.openBudgetItem(a))}),e.TgZ(1,"ion-label"),e._uU(2),e.qZA(),e.TgZ(3,"ion-note",17),e._uU(4),e.qZA()()}if(2&c){const n=e.oxw().$implicit,o=e.oxw(2);e.xp6(2),e.Oqu(n.text),e.xp6(1),e.Q6J("ngClass",o.getSubcategoryRemainingAmount(n)<0?"negative":""),e.xp6(1),e.hij(" ",o.formatCurrency(o.getSubcategoryRemainingAmount(n))," ")}}function E(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"span",18)(1,"ion-input",19,20),e.NdJ("ngModelChange",function(a){e.CHM(n);const m=e.oxw().$implicit;return e.KtG(m.text=a)})("ionFocus",function(){e.CHM(n);const a=e.oxw(3);return e.KtG(a.stopTimeout())})("ionBlur",function(){e.CHM(n);const a=e.oxw(3);return e.KtG(a.shouldWeSaveOrRemove())})("keyup.enter",function(){e.CHM(n);const a=e.oxw(3);return e.KtG(a.triggerIonBlur())})("keydown",function(a){e.CHM(n);const m=e.oxw(3);return e.KtG(m.hideKeyboard(a))}),e.qZA(),e.TgZ(3,"ion-note",21),e._uU(4),e.ALo(5,"currency"),e.qZA()()}if(2&c){const n=e.oxw().$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngModel",n.text),e.xp6(3),e.Oqu(e.lcZ(5,2,o.getSubcategoryRemainingAmount(n)))}}function A(c,s){if(1&c&&(e.TgZ(0,"ion-item",11),e.YNc(1,T,1,0,"ion-icon",12),e.YNc(2,f,5,3,"span",13),e.YNc(3,E,6,4,"span",14),e.qZA()),2&c){const n=s.$implicit,o=e.oxw(2);e.Q6J("button",!n.isEditing&&!o.isUserRemovingCategories),e.xp6(1),e.Q6J("ngIf",o.isUserRemovingCategories),e.xp6(1),e.Q6J("ngIf",!n.isEditing),e.xp6(1),e.Q6J("ngIf",n.isEditing)}}function I(c,s){if(1&c&&(e.TgZ(0,"span"),e.YNc(1,A,4,4,"ion-item",10),e.qZA()),2&c){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.subcategories)}}function y(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"ion-item",23),e.NdJ("click",function(){const m=e.CHM(n).index,M=e.oxw(2);return e.KtG(M.selectSubCategory(m))}),e.TgZ(1,"ion-label",24),e._uU(2),e.qZA()()}if(2&c){const n=s.$implicit;e.xp6(2),e.Oqu(n.text)}}function P(c,s){if(1&c&&(e.TgZ(0,"span"),e.YNc(1,y,3,1,"ion-item",22),e.qZA()),2&c){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.subcategories)}}function i(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",25),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.addNewSub())}),e._UZ(2,"ion-icon",26),e._uU(3," Add New Category "),e.qZA()()}}function u(c,s){if(1&c){const n=e.EpF();e.TgZ(0,"div",27)(1,"ion-button",28),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.deleteCategory(a.category,void 0))}),e.TgZ(2,"ion-icon",29),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.deleteCategory(a.category,void 0))}),e.qZA()()()}}const C=function(c){return{"padding-right":c}},x=function(c){return{width:c}};let v=(()=>{class c{constructor(n){this.alertService=n,this.isChecklist=!1,this.isUserReorderingCategories=!1,this.isUserRemovingCategories=!1,this.addNewSubEvent=new e.vpe,this.requestSaveOfSubs=new e.vpe,this.subcategorySelected=new e.vpe,this.requestDeleteCategory=new e.vpe,this.transactions=[]}ngOnInit(){this.checkDOMChange()}addNewSub(){this.addNewSubEvent.emit()}triggerIonBlur(){this.shouldWeSaveOrRemove()}checkDOMChange(){this.checker=setTimeout(()=>{const n=document.getElementsByClassName("new-sub");n.length>0&&n[0].childNodes[0].setFocus(),this.checkDOMChange()},100)}getSubcategoryRemainingAmount(n){return this.category.id?"income"===this.category.id?n.actual_amount+-1*n.planned_amount:n.planned_amount-n.actual_amount:0}stopTimeout(){clearTimeout(this.checker)}shouldWeSaveOrRemove(){this.subcategories.find(o=>o.isEditing)&&this.requestSaveOfSubs.emit()}deleteCategory(n,o){var a=this;return(0,l.Z)(function*(){"income"!==n.id||o?a.requestDeleteCategory.emit({cat:n,sub:o}):a.alertService.createAndShowToast("You cannot delete the income category")})()}openBudgetItem(n){var o=this;return(0,l.Z)(function*(){o.subcategorySelected.emit({sub:o.subcategories[n],cat:o.category})})()}selectSubCategory(n){this.subcategorySelected.emit(this.subcategories[n])}hideKeyboard(n){("Enter"==n.key||"enter"==n.key)&&t.N1.hide()}formatCurrency(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n<0?-n:n)}}return c.\u0275fac=function(n){return new(n||c)(e.Y36(b.c))},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-category"]],viewQuery:function(n,o){if(1&n&&(e.Gf(U,5),e.Gf(p,5)),2&n){let a;e.iGM(a=e.CRH())&&(o.nameInput=a.first),e.iGM(a=e.CRH())&&(o.fieldsContainer=a.first)}},inputs:{category:"category",subcategories:"subcategories",isChecklist:"isChecklist",chosenDate:"chosenDate",isUserReorderingCategories:"isUserReorderingCategories",isUserRemovingCategories:"isUserRemovingCategories"},outputs:{addNewSubEvent:"addNewSubEvent",requestSaveOfSubs:"requestSaveOfSubs",subcategorySelected:"subcategorySelected",requestDeleteCategory:"requestDeleteCategory"},decls:14,vars:13,consts:[[3,"ngStyle","id"],[2,"display","flex","align-items","center","justify-content","space-between"],[3,"ngStyle"],["id","subtitle"],["id","title"],["id","category",4,"ngIf"],["lines","none"],[4,"ngIf"],["style","display: flex; justify-content: flex-end",4,"ngIf"],["id","category"],["class","target","detail","false",3,"button",4,"ngFor","ngForOf"],["detail","false",1,"target",3,"button"],["style","color: var(--ion-color-danger); padding-right: 10px","name","remove-circle-outline",3,"click",4,"ngIf"],["class","saved-sub",3,"click",4,"ngIf"],["class","new-sub",4,"ngIf"],["name","remove-circle-outline",2,"color","var(--ion-color-danger)","padding-right","10px",3,"click"],[1,"saved-sub",3,"click"],[2,"text-align","end",3,"ngClass"],[1,"new-sub"],["placeholder","Name","autocapitalize","sentences","enterkeyhint","done","autocorrect","on",3,"ngModel","ngModelChange","ionFocus","ionBlur","keyup.enter","keydown"],["nameInput",""],[2,"text-align","end"],["class","target","button","",3,"click",4,"ngFor","ngForOf"],["button","",1,"target",3,"click"],["labelPlacement","start"],[1,"add-new",2,"cursor","pointer",3,"click"],["name","add"],[2,"display","flex","justify-content","flex-end"],["fill","clear","size","medium",3,"click"],["name","remove-circle-outline","slot","icon-only",2,"color","var(--ion-color-danger)",3,"click"]],template:function(n,o){1&n&&(e.TgZ(0,"ion-card",0)(1,"div",1)(2,"div",2)(3,"ion-card-header")(4,"ion-card-subtitle",3)(5,"span",4),e._uU(6),e.qZA(),e.YNc(7,h,2,0,"span",5),e.qZA()(),e.TgZ(8,"ion-card-content")(9,"ion-list",6),e.YNc(10,I,2,1,"span",7),e.YNc(11,P,2,1,"span",7),e.YNc(12,i,4,0,"ion-item",7),e.qZA()()(),e.YNc(13,u,3,0,"div",8),e.qZA()()),2&n&&(e.MGl("id","",o.category.id,"-card"),e.Q6J("ngStyle",e.VKq(9,C,o.isUserReorderingCategories?"34px":"0")),e.xp6(2),e.Q6J("ngStyle",e.VKq(11,x,o.isUserRemovingCategories&&"income"!==o.category.id?"90%":"100%")),e.xp6(4),e.Oqu(o.category.id),e.xp6(1),e.Q6J("ngIf",!o.isChecklist),e.xp6(3),e.Q6J("ngIf",!o.isChecklist),e.xp6(1),e.Q6J("ngIf",o.isChecklist),e.xp6(1),e.Q6J("ngIf",!o.isChecklist),e.xp6(1),e.Q6J("ngIf",o.isUserRemovingCategories&&"income"!==o.category.id))},dependencies:[g.mk,g.sg,g.O5,g.PC,d.JJ,d.On,_.YG,_.PM,_.FN,_.Zi,_.tO,_.gu,_.pK,_.Ie,_.Q$,_.q_,_.uN,_.j9,g.H9],styles:["ion-card[_ngcontent-%COMP%]{margin:0 0 28px}.add-new[_ngcontent-%COMP%]{font-size:small;opacity:.6;display:flex;flex-direction:row;align-items:center;justify-content:center}.new-sub[_ngcontent-%COMP%], .saved-sub[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;width:100%}.saved-sub[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{width:100%}#subtitle[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.negative[_ngcontent-%COMP%]{color:#f14242}"]}),c})()},3554:(S,O,r)=>{r.d(O,{e:()=>g});var l=r(6814),e=r(95),t=r(5548),b=r(6689);let g=(()=>{class d{}return d.\u0275fac=function(U){return new(U||d)},d.\u0275mod=b.oAB({type:d}),d.\u0275inj=b.cJS({imports:[l.ez,e.u5,t.Pc]}),d})()},98:(S,O,r)=>{r.d(O,{m:()=>I});var l=r(5861),e=r(5548),t=r(6689),b=r(6635),g=r(6814),d=r(95),_=r(8647),U=r(1695);function p(y,P){if(1&y){const i=t.EpF();t.TgZ(0,"ion-datetime",14),t.NdJ("ionChange",function(C){t.CHM(i);const x=t.oxw();return t.KtG(x.dateChanged(C))}),t.qZA()}2&y&&t.Q6J("preferWheel",!0)}function h(y,P){if(1&y&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&y){const i=t.oxw();t.xp6(1),t.Oqu(i.selectedSub)}}const T=function(){return[]};function f(y,P){if(1&y){const i=t.EpF();t.TgZ(0,"span")(1,"app-category",22),t.NdJ("subcategorySelected",function(C){const v=t.CHM(i).$implicit,c=t.oxw(2);return t.KtG(c.subcategorySelected(C,v))}),t.qZA()()}if(2&y){const i=P.$implicit;let u;t.xp6(1),t.Q6J("category",i)("isChecklist",!0)("subcategories",null!==(u=i.subcategories)&&void 0!==u?u:t.DdM(3,T))}}function E(y,P){if(1&y){const i=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t._uU(3,"Pick a Category"),t.qZA(),t.TgZ(4,"ion-buttons",1)(5,"ion-button",2),t.NdJ("click",function(){t.CHM(i),t.oxw();const C=t.MAs(43);return t.KtG(C.dismiss())}),t._uU(6,"Close"),t.qZA()()()(),t.TgZ(7,"ion-content")(8,"div",15),t.YNc(9,f,2,4,"span",16),t.TgZ(10,"span",17)(11,"ion-card",18)(12,"ion-card-header")(13,"ion-card-subtitle",19)(14,"span",20),t._uU(15,"None"),t.qZA()()(),t.TgZ(16,"ion-card-content")(17,"ion-item",21),t.NdJ("click",function(){t.CHM(i);const C=t.oxw();return t.KtG(C.selectedNoSub())}),t.TgZ(18,"ion-label"),t._uU(19,"Uncategorized"),t.qZA()()()()()()()}if(2&y){const i=t.oxw();t.xp6(9),t.Q6J("ngForOf",i.categories)}}const A=function(){return{prefix:"$ ",thousands:",",decimal:"."}};let I=(()=>{class y{constructor(i,u,C){this.modalCtrl=i,this.transactionPublisher=u,this.alertCtrl=C,this.transactionAmountUserView=0}ngOnInit(){var i=this;return(0,l.Z)(function*(){i.isIncome=i.transaction.amount<0,i.transactionAmountUserView=i.getAmount()})()}ngAfterViewInit(){var i=this;return(0,l.Z)(function*(){const u=i.transaction.date.getTimezoneOffset(),C=new Date(i.transaction.date.getTime()-60*u*1e3);i.ionDatetime.value=C.toISOString()})()}save(){var i=this;return(0,l.Z)(function*(){i.transaction.amount=i.isIncome?-i.transactionAmountUserView:i.transactionAmountUserView,console.log(i.transaction),i.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[i.transaction],removedTransactions:[]}),i.modalCtrl.dismiss()})()}subcategorySelected(i,u){this.modalCtrl.dismiss(),this.transaction.subcategoryId=i.id,this.isIncome="income"===u.id}selectedNoSub(){this.modalCtrl.dismiss(),this.transaction.subcategoryId="",this.isIncome=!1}dateChanged(i){this.transaction.date=new Date(i.detail.value)}getAmount(){return this.transaction.amount>=0?this.transaction.amount:-this.transaction.amount}deleteTransaction(){var i=this;return(0,l.Z)(function*(){(yield i.alertCtrl.create({message:"Are You Sure?",buttons:[{text:"Yes",role:"destructive",handler:()=>{i.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[],removedTransactions:[i.transaction]}),i.modalCtrl.dismiss()}},{text:"No",role:"cancel"}]})).present()})()}}return y.\u0275fac=function(i){return new(i||y)(t.Y36(e.IN),t.Y36(b.u),t.Y36(e.Br))},y.\u0275cmp=t.Xpm({type:y,selectors:[["app-transaction-sorter"]],viewQuery:function(i,u){if(1&i&&t.Gf(e.x4,5),2&i){let C;t.iGM(C=t.CRH())&&(u.ionDatetime=C.first)}},decls:45,vars:8,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end"],["name","trash-outline"],["slot","end","datetime","datetime"],["slot","end","placeholder","$0.00","type","decimal","currencyMask","","inputmode","decimal",1,"ngx-currency-input",3,"ngModel","options","ngModelChange"],["placeholder","Name","slot","end","type","text",3,"ngModel","ngModelChange"],[3,"keepContentsMounted"],["lines","none"],["button","","id","open-modal"],[4,"ngIf"],["trigger","open-modal",3,"presentingElement"],["modal",""],["id","datetime","presentation","date",3,"preferWheel","ionChange"],[2,"width","90%","margin","28px auto 0 auto"],[4,"ngFor","ngForOf"],["id","no-category"],[2,"margin","0 0 28px 0"],["id","subtitle"],["id","title"],["button","","lines","none",1,"target",3,"click"],[3,"category","isChecklist","subcategories","subcategorySelected"]],template:function(i,u){1&i&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),t.NdJ("click",function(){return u.modalCtrl.dismiss()}),t._uU(4,"Cancel"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Update Transaction"),t.qZA(),t.TgZ(7,"ion-buttons",3)(8,"ion-button",2),t.NdJ("click",function(){return u.deleteTransaction()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",2),t.NdJ("click",function(){return u.save()}),t._uU(11,"Save"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-card")(14,"ion-card-content")(15,"ion-list")(16,"ion-item")(17,"ion-label"),t._uU(18,"Date"),t.qZA(),t._UZ(19,"ion-datetime-button",5),t.qZA(),t.TgZ(20,"ion-item")(21,"ion-label"),t._uU(22,"Amount"),t.qZA(),t.TgZ(23,"input",6),t.NdJ("ngModelChange",function(x){return u.transactionAmountUserView=x}),t.qZA()(),t.TgZ(24,"ion-item")(25,"ion-label"),t._uU(26,"Transaction"),t.qZA(),t.TgZ(27,"ion-input",7),t.NdJ("ngModelChange",function(x){return u.transaction.name=x}),t.qZA()(),t.TgZ(28,"ion-item")(29,"ion-label"),t._uU(30,"Merchant"),t.qZA(),t.TgZ(31,"ion-input",7),t.NdJ("ngModelChange",function(x){return u.transaction.merchant_name=x}),t.qZA()()(),t.TgZ(32,"ion-modal",8),t.YNc(33,p,1,1,"ng-template"),t.qZA()()(),t.TgZ(34,"ion-card")(35,"ion-card-content")(36,"ion-list",9)(37,"ion-item",10)(38,"ion-label"),t._uU(39,"Budget Category"),t.qZA(),t._UZ(40,"br"),t.YNc(41,h,2,1,"p",11),t.qZA()()()(),t.TgZ(42,"ion-modal",12,13),t.YNc(44,E,20,1,"ng-template"),t.qZA()()),2&i&&(t.xp6(23),t.Q6J("ngModel",u.transactionAmountUserView)("options",t.DdM(7,A)),t.xp6(4),t.Q6J("ngModel",u.transaction.name),t.xp6(4),t.Q6J("ngModel",u.transaction.merchant_name),t.xp6(1),t.Q6J("keepContentsMounted",!0),t.xp6(9),t.Q6J("ngIf",u.transaction.subcategoryId),t.xp6(1),t.Q6J("presentingElement",u.presentingElement))},dependencies:[g.sg,g.O5,d.Fj,d.JJ,d.On,e.YG,e.Sm,e.PM,e.FN,e.Zi,e.tO,e.W2,e.x4,e.Mj,e.Gu,e.gu,e.pK,e.Ie,e.Q$,e.q_,e.wd,e.sr,e.ki,e.QI,e.j9,_.xv,U.m],styles:["#segment[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#segment[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:90%;margin-top:25px}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff}ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{color:#fff}ion-input[_ngcontent-%COMP%]{text-align:end}ion-datetime-button[_ngcontent-%COMP%]::part(native){background:#fff;padding-right:5px}"]}),y})()},8452:(S,O,r)=>{r.d(O,{q:()=>d});var l=r(5861),e=r(4092),t=r(182),b=r(15),g=r(6689);let d=(()=>{class _ extends e.q{constructor(){super(t.lN)}get(p,h){var T=()=>super._get,f=this;return(0,l.Z)(function*(){const E=yield T().call(f,_.makeCollectionRef(p),h);return f.convertTimestampToDate(E)})()}getAll(){var p=()=>super._getAll,h=this;return(0,l.Z)(function*(){const T=yield p().call(h);return T.docs&&(T.docs=T.docs.map(f=>h.convertTimestampToDate(f))),T})()}getAllFromParent(p){var h=()=>super._getAllFromParent,T=this;return(0,l.Z)(function*(){const f=yield h().call(T,_.makeCollectionRef(p));return f.docs&&(f.docs=f.docs.map(E=>T.convertTimestampToDate(E))),f})()}getByQuery(p){var h=()=>super._getByQuery,T=this;return(0,l.Z)(function*(){const f=yield h().call(T,p);return f.docs&&(f.docs=f.docs.map(E=>T.convertTimestampToDate(E))),f})()}add(p,h,T){var f=()=>super._add,E=this;return(0,l.Z)(function*(){return f().call(E,_.makeCollectionRef(p),h,T)})()}update(p,h,T){var f=()=>super._update,E=this;return(0,l.Z)(function*(){return f().call(E,_.makeCollectionRef(p),h,T)})()}delete(p,h,T=!1){var f=()=>super._delete,E=this;return(0,l.Z)(function*(){return f().call(E,_.makeCollectionRef(p),h,T)})()}static makeCollectionRef(p){return(0,b.hJ)((0,b.ad)(),t.YP,p,t.lN)}convertTimestampToDate(p){if(!p)return p;const h=p.last_transaction_retrieval;return h&&(p.last_transaction_retrieval=h.toDate()),p}}return _.\u0275fac=function(p){return new(p||_)},_.\u0275prov=g.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},1269:(S,O,r)=>{r.d(O,{O:()=>t});var l=r(6689),e=r(9862);let t=(()=>{class b{constructor(d){this.http=d}post(d,_){return this.http.post(d,_,{headers:this.getHeaders()})}getHeaders(){return{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}}}return b.\u0275fac=function(d){return new(d||b)(l.LFG(e.eN))},b.\u0275prov=l.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"}),b})()},7087:(S,O,r)=>{r.d(O,{O:()=>x});var l=r(5861),e=r(6306),t=r(6973);function b(v,c){const s="object"==typeof c;return new Promise((n,o)=>{let m,a=!1;v.subscribe({next:M=>{m=M,a=!0},error:o,complete:()=>{a?n(m):s?n(c.defaultValue):o(new t.K)}})})}var g=r(553);const d=g.N.useFunctionsEmulator&&!g.N.production?"http://localhost:5001/balanced-budget-90f1f/us-central1/":"https://us-central1-balanced-budget-90f1f.cloudfunctions.net/",_=d+"getTransactionData",U=d+"createPlaidLinkToken",p=d+"relinkPlaidLinkToken",h=d+"exchangePublicToken",f=d+"removeLinkedAccount";function E(v){const c=v.datetime?new Date(v.datetime):new Date(v.date);return{id:v.transaction_id,amount:v.amount,subcategoryId:"",date:c,merchant_name:v.merchant_name,name:v.name,pending:v.pending}}var A=r(6689),I=r(1269),y=r(8452),P=r(7195),i=r(6635),u=r(5548),C=r(3076);let x=(()=>{class v{get plaidAvailable(){return this.userService.isPremium}constructor(s,n,o,a,m,M){this.http=s,this.linkedAccountsRepository=n,this.userRepository=o,this.transactionPublisher=a,this.loadingController=m,this.userService=M}linkPlaidToUser(){var s=this;return(0,l.Z)(function*(){if(!s.plaidAvailable)return;const n=yield s.loadingController.create();yield n.present(),s.http.post(U,{user_id:s.userRepository.getCurrentUserId()}).pipe((0,e.K)(o=>(console.log(o),n.dismiss(),o))).subscribe(o=>{console.log(o);const a=s.createPlaidHandlerLink(o.link_token);n.dismiss(),a.open()})})()}syncPlaidTransactions(){var s=this;return(0,l.Z)(function*(){if(!s.plaidAvailable)return;const n=s.userRepository.getCurrentUserId();if(!n)throw new Error("User is not logged in");const o=(yield s.linkedAccountsRepository.getAllFromParent(n)).docs;if(0===o.length)return;const a=[];for(let Z of o)(yield s.shouldSyncTransactions(Z))&&a.push(b(s.http.post(_,{userId:n,linkedAccount:Z,linkedAccountId:Z.id})));const m=yield Promise.all(a);let M=[],D=[],k=[];for(let Z=0;Z<m.length;Z++){const R=m[Z];M=M.concat(R.added),D=D.concat(R.removed),k=k.concat(R.modified)}s.plaidTransactionSyncHandler(M,D,k,!0)})()}removePlaidLinkedAccount(s){var n=this;return(0,l.Z)(function*(){const o=n.userRepository.getCurrentUserId();if(!o)throw new Error("User is not logged in");n.http.post(f,{user_id:o,linked_account_id:s.id}).subscribe(a=>{console.log(a)})})()}relinkPlaidLinkedAccount(s,n){var o=this;return(0,l.Z)(function*(){if(!o.plaidAvailable)return;const a=yield o.loadingController.create();yield a.present(),o.http.post(p,{user_id:o.userRepository.getCurrentUserId(),linked_account_id:s.id}).pipe((0,e.K)(m=>(console.log(m),a.dismiss(),m))).subscribe(m=>{console.log(m);const M=o.createPlaidHandlerRelink(m.link_token,o.userRepository.getCurrentUserId(),s.id,n);a.dismiss(),M.open()})})()}createPlaidHandlerLink(s){return Plaid.create({token:s,onSuccess:this.plaidHandlerOnSuccessCallback.bind(this),onExit:this.plaidHandlerOnExitCallback.bind(this),onLoad:this.plaidHandlerOnLoadCallback.bind(this),onEvent:this.plaidHandlerOnEventCallback.bind(this),receivedRedirectUri:null})}createPlaidHandlerRelink(s,n,o,a){return Plaid.create({token:s,onSuccess:(m,M)=>{o&&this.linkedAccountsRepository.update(n,o,{link_status:{required_action:"NONE"}}).then(D=>{D&&a&&a(o)})},onExit:this.plaidHandlerOnExitCallback.bind(this),onLoad:this.plaidHandlerOnLoadCallback.bind(this),onEvent:this.plaidHandlerOnEventCallback.bind(this),receivedRedirectUri:null})}plaidHandlerOnSuccessCallback(s,n){this.http.post(h,{publicToken:s,institutionName:n.institution.name,userId:this.userRepository.getCurrentUserId()}).subscribe(o=>{console.log(o);const{added:a,removed:m,modified:M}=o;this.plaidTransactionSyncHandler(a,m,M,!0)})}plaidHandlerOnExitCallback(s,n){return(0,l.Z)(function*(){console.log(s)})()}plaidHandlerOnLoadCallback(){return(0,l.Z)(function*(){})()}plaidHandlerOnEventCallback(s,n){return(0,l.Z)(function*(){})()}plaidTransactionSyncHandler(s,n,o,a=!0){var m=this;return(0,l.Z)(function*(){const Z={from:"plaid",addedTransactions:s.map(E),removedTransactions:n.map(E),modifiedTransactions:o.map(E)};return a&&m.transactionPublisher.publishEvent(Z),Z})()}shouldSyncTransactions(s){return(0,l.Z)(function*(){if(!s.last_transaction_retrieval)return!0;const o=s.last_transaction_retrieval;return(new Date).getTime()-o.getTime()>3e5})()}}return v.\u0275fac=function(s){return new(s||v)(A.LFG(I.O),A.LFG(y.q),A.LFG(P.E),A.LFG(i.u),A.LFG(u.HT),A.LFG(C.K))},v.\u0275prov=A.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},6635:(S,O,r)=>{r.d(O,{u:()=>e});var l=r(6689);let e=(()=>{class t{constructor(){this.subscribers=new Set}publishEvent(g){console.log("Publishing event",g),this.subscribers.forEach(d=>{d.onTransactionEvent(g)})}subscribe(g){this.subscribers.add(g)}unsubscribe(g){this.subscribers.delete(g)}}return t.\u0275fac=function(g){return new(g||t)},t.\u0275prov=l.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);