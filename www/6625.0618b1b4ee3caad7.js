"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6625],{3549:(j,v,g)=>{g.d(v,{k$:()=>m,y$:()=>l});var l=(()=>((l=l||{}).Heavy="HEAVY",l.Medium="MEDIUM",l.Light="LIGHT",l))(),m=(()=>((m=m||{}).Success="SUCCESS",m.Warning="WARNING",m.Error="ERROR",m))()},6625:(j,v,g)=>{g.r(v),g.d(v,{Tab1PageModule:()=>Ie});var l=g(5548),m=g(6814),f=g(95),D=g(3554),O=g(4798),d=g(5861),I=g(6044),$=g(98);function x(i,c){return i.index>c.index?1:i.index<c.index?-1:0}function R(i,c){const t=new Date(i.date);return new Date(c.date).getTime()-t.getTime()}var e=g(6689),y=g(182),h=g(15),U=g(4092),M=g(9137);let S=(()=>{class i extends U.q{constructor(){super(y.fx)}get(t,n,o){var r=()=>super._get,a=this;return(0,d.Z)(function*(){return r().call(a,i.makeCollectionRef(t,n),o)})()}getAll(){var t=()=>super._getAll,n=this;return(0,d.Z)(function*(){return t().call(n)})()}getAllFromParent(t,n){var o=()=>super._getAllFromParent,r=this;return(0,d.Z)(function*(){return o().call(r,i.makeCollectionRef(t,n))})()}getByQuery(t){var n=()=>super._getByQuery,o=this;return(0,d.Z)(function*(){return n().call(o,t)})()}add(t,n,o,r){var a=()=>super._add,s=this;return(0,d.Z)(function*(){return o=s.cloneAndRemoveProperties(o),a().call(s,i.makeCollectionRef(t,n),o,r)})()}update(t,n,o,r){var a=()=>super._update,s=this;return(0,d.Z)(function*(){return r=s.cloneAndRemoveProperties(r),a().call(s,i.makeCollectionRef(t,n),o,r)})()}delete(t,n,o,r=!1){var a=()=>super._delete,s=this;return(0,d.Z)(function*(){return a().call(s,i.makeCollectionRef(t,n),o,r)})()}static makeCollectionRef(t,n){return(0,h.hJ)((0,h.ad)(),y.YP,t,y.HO,n,y.fx)}cloneAndRemoveProperties(t){return(0,M.w)(t)||((t=structuredClone(t))[M.O]=!0),null!=t.isEditing&&delete t.isEditing,null!=t.actual_amount&&delete t.actual_amount,t}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var F=g(3251),A=g(6635),E=g(8647);const B=function(){return{prefix:"$ ",thousands:",",decimal:".",align:"center"}};function G(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",7)(1,"div",8)(2,"ion-label"),e._uU(3),e.ALo(4,"currency"),e.qZA(),e.TgZ(5,"ion-label"),e._uU(6,"Received of"),e.qZA(),e.TgZ(7,"input",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.planned_amount=o)})("blur",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveNewAmount())}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.hij("",e.lcZ(4,3,-1*t.subcategory.actual_amount)," "),e.xp6(4),e.Q6J("ngModel",t.planned_amount)("options",e.DdM(5,B))}}function L(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",7)(1,"div",8)(2,"ion-label"),e._uU(3),e.ALo(4,"currency"),e.qZA(),e.TgZ(5,"ion-label"),e._uU(6,"Spent of"),e.qZA(),e.TgZ(7,"input",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.planned_amount=o)})("blur",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveNewAmount())}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,3,t.subcategory.actual_amount)),e.xp6(4),e.Q6J("ngModel",t.planned_amount)("options",e.DdM(5,B))}}function z(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item",10),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.openEditTransaction(r))}),e.TgZ(2,"ion-label"),e._uU(3),e.ALo(4,"date"),e.qZA(),e.TgZ(5,"ion-note",11),e._uU(6),e.ALo(7,"currency"),e.qZA()(),e.TgZ(8,"ion-item-options",12)(9,"ion-item-option",13),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.deleteTransaction(r))}),e._UZ(10,"ion-icon",14),e.qZA()()()}if(2&i){const t=c.$implicit;e.xp6(3),e.AsE("",e.xi3(4,3,t.date,"MMM. d")," - ",t.name,""),e.xp6(3),e.Oqu(e.lcZ(7,6,-1*t.amount))}}let K=(()=>{class i{constructor(t,n,o,r,a){this.modalController=t,this.subCategoryRepository=n,this.alertService=o,this.transactionPublisher=r,this.alertCtrl=a}ngOnInit(){this.subcategoryEditName=this.subcategory.text,this.planned_amount="income"===this.category.id?-1*this.subcategory.planned_amount:this.subcategory.planned_amount,this.transactions=this.transactions.filter(t=>t.subcategoryId===this.subcategory.id),this.transactions.sort(R)}saveNewAmount(){var t=this;return(0,d.Z)(function*(){if(!t.user||!t.user.id||void 0===t.category.id)return;let n=t.planned_amount;"income"==t.category.id&&(n=-1*t.planned_amount),t.subCategoryRepository.update(t.user.id,t.category.id,t.subcategory.id,{planned_amount:n}),t.subcategory.planned_amount=n})()}saveNewName(){var t=this;return(0,d.Z)(function*(){if(t.user&&t.user.id&&void 0!==t.category.id){if(null==t.subcategoryEditName||""==t.subcategoryEditName)return t.alertService.createAndShowToast("Please enter a valid name"),void(t.subcategoryEditName=t.subcategory.text);t.subCategoryRepository.update(t.user.id,t.category.id,t.subcategory.id,{text:t.subcategoryEditName}),t.subcategory.text=t.subcategoryEditName}})()}deleteTransaction(t){var n=this;return(0,d.Z)(function*(){(yield n.alertCtrl.create({message:"Are You Sure?",buttons:[{text:"Yes",role:"destructive",handler:()=>{n.transactions.splice(n.transactions.indexOf(t),1),n.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[],removedTransactions:[t]})}},{text:"No",role:"cancel"}]})).present()})()}openEditTransaction(t){var n=this;return(0,d.Z)(function*(){n.modalController.dismiss({transaction:t,action:"edit"})})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.IN),e.Y36(S),e.Y36(F.c),e.Y36(A.u),e.Y36(l.Br))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-view-sub-category"]],decls:21,vars:5,consts:[["color","primary"],["slot","start"],[3,"click"],["id","category-header"],["placeholder","Enter a name",3,"ngModel","maxlength","ngModelChange","ionBlur"],["lines","none","class","header",4,"ngIf"],[4,"ngFor","ngForOf"],["lines","none",1,"header"],[1,"amount-container"],["placeholder","$0.00","type","decimal","currencyMask","","inputmode","decimal",1,"ngx-currency-input",3,"ngModel","options","ngModelChange","blur"],["button","true","detail","true",3,"click"],["slot","end"],["side","end"],["color","danger",3,"click"],["name","trash"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return n.modalController.dismiss()}),e._uU(4,"Close"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Subcategory Info"),e.qZA()()(),e.TgZ(7,"ion-content")(8,"ion-card")(9,"ion-card-content")(10,"div",3)(11,"ion-input",4),e.NdJ("ngModelChange",function(r){return n.subcategoryEditName=r})("ionBlur",function(){return n.saveNewName()}),e.qZA()(),e.YNc(12,G,8,6,"ion-item",5),e.YNc(13,L,8,6,"ion-item",5),e.qZA()(),e.TgZ(14,"ion-card")(15,"ion-card-header")(16,"ion-card-subtitle"),e._uU(17,"Transactions"),e.qZA()(),e.TgZ(18,"ion-card-content")(19,"ion-list"),e.YNc(20,z,11,8,"ion-item-sliding",6),e.qZA()()()()),2&t&&(e.xp6(11),e.Q6J("ngModel",n.subcategoryEditName)("maxlength",40),e.xp6(1),e.Q6J("ngIf","income"==n.category.id),e.xp6(1),e.Q6J("ngIf","income"!=n.category.id),e.xp6(7),e.Q6J("ngForOf",n.transactions))},dependencies:[m.sg,m.O5,f.Fj,f.JJ,f.nD,f.On,l.YG,l.Sm,l.PM,l.FN,l.Zi,l.tO,l.W2,l.Gu,l.gu,l.pK,l.Ie,l.u8,l.IK,l.td,l.Q$,l.q_,l.uN,l.wd,l.sr,l.j9,E.xv,m.H9,m.uU],styles:[".header[_ngcontent-%COMP%]{text-align:center;display:flex;flex-direction:row;align-items:center;justify-content:start;width:100%}.header[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;text-align:start;background-color:#fff}.header[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:none}#category-header[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:92%;margin:0 auto 10px}#category-header[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{text-align:center;font-size:28px;--placeholder-color: #333}ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--inner-padding-start: 0}.amount-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;text-align:center;font-size:20px}.amount-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:inline-block;--width: min-content;--max-width: min-content;border-bottom:1px solid #666}.amount-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-bottom:1px solid var(--ion-color-primary)}"]}),i})();function Z(i){return i||(i=new Date),{month:i.getMonth(),year:i.getFullYear()}}function Y(i,c,t){return(0,h.IO)(S.makeCollectionRef(i,c),(0,h.xD)((0,h.ar)("date.month","==",t.month),(0,h.ar)("date.year","==",t.year)))}const P=[{text:"January",value:0,selected:!1},{text:"February",value:1,selected:!1},{text:"March",value:2,selected:!1},{text:"April",value:3,selected:!1},{text:"May",value:4,selected:!1},{text:"June",value:5,selected:!1},{text:"July",value:6,selected:!1},{text:"August",value:7,selected:!1},{text:"September",value:8,selected:!1},{text:"October",value:9,selected:!1},{text:"November",value:10,selected:!1},{text:"December",value:11,selected:!1}],N=function X(){const i=(new Date).getFullYear(),t=i+2,n=[];for(let o=i-2;o<=t;o++)n.push({text:o.toString(),value:o,selected:!1});return n}();var ee=g(7258),J=g(1695);function te(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-datetime",13),e.NdJ("ionChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.dateChanged(o))}),e.qZA()}2&i&&e.Q6J("preferWheel",!0)}function ne(i,c){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.selectedSub.text)}}const oe=function(){return[]};function re(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"span")(1,"app-category",16),e.NdJ("subcategorySelected",function(o){const a=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.subcategorySelected(o,a))}),e.qZA()()}if(2&i){const t=c.$implicit;e.xp6(1),e.Q6J("category",t)("isChecklist",!0)("subcategories",t.subcategories||e.DdM(3,oe))}}function ie(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"Pick a Category"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e.NdJ("click",function(){e.CHM(t),e.oxw();const o=e.MAs(41);return e.KtG(o.dismiss())}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content")(8,"div",14),e.YNc(9,re,2,4,"span",15),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(9),e.Q6J("ngForOf",t.categories)}}const ae=function(){return{prefix:"$ ",thousands:",",decimal:"."}};let se=(()=>{class i{constructor(t,n,o){this.modalCtrl=t,this.alertService=n,this.transactionPublisher=o,this.newTransaction={date:new Date,id:(0,I.D)(),amount:0,subcategoryId:"",name:"",merchant_name:"",pending:!1},this.newTransactionForm=new f.cw({amount:new f.NI(this.newTransaction.amount)}),this.setupModal()}ngOnInit(){}setupModal(){var t=this;return(0,d.Z)(function*(){t.presentingElement=yield t.modalCtrl.getTop()})()}add(){var t=this;return(0,d.Z)(function*(){if(!t.newTransaction.amount||0==t.newTransaction.amount)return void t.alertService.createAndShowToast("Please enter an amount");let n=Object.assign({},t.newTransaction);"income"==t.selectedCat.id&&(n.amount=-1*n.amount);try{t.transactionPublisher.publishEvent({from:"manual",addedTransactions:[n],removedTransactions:[],modifiedTransactions:[],other:{subcategoryId:t.selectedSub.id,categoryId:t.selectedCat.id}})}catch(o){console.log(o)}t.modalCtrl.dismiss()})()}dateChanged(t){this.newTransaction.date=new Date(t.detail.value),console.log(this.newTransaction.date)}subcategorySelected(t,n){this.modalCtrl.dismiss(),this.selectedSub=t,this.selectedCat=n,this.newTransaction.subcategoryId=t.id,this.newTransaction.pending=!1}hideKeyboard(t){("Enter"==t.key||"enter"==t.key)&&ee.N1.hide()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.IN),e.Y36(F.c),e.Y36(A.u))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-add-transaction"]],inputs:{categories:"categories",user:"user"},decls:43,vars:8,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end"],["slot","end","datetime","datetime"],["slot","end","placeholder","$0.00","type","decimal","currencyMask","","inputmode","decimal",1,"ngx-currency-input",3,"ngModel","options","ngModelChange"],["placeholder","Name","slot","end","type","text","autocapitalize","sentences","enterkeyhint","done","autocorrect","on",3,"ngModel","ngModelChange","keydown"],[3,"keepContentsMounted"],["lines","none"],["button","","id","open-modal"],[4,"ngIf"],["trigger","open-modal",3,"presentingElement"],["modal",""],["id","datetime","presentation","date",3,"preferWheel","ionChange"],[2,"width","90%","margin","28px auto 0 auto"],[4,"ngFor","ngForOf"],[3,"category","isChecklist","subcategories","subcategorySelected"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return n.modalCtrl.dismiss()}),e._uU(4,"Cancel"),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6,"Add Transaction"),e.qZA(),e.TgZ(7,"ion-buttons",3)(8,"ion-button",2),e.NdJ("click",function(){return n.add()}),e._uU(9,"Add"),e.qZA()()()(),e.TgZ(10,"ion-content")(11,"ion-card")(12,"ion-card-content")(13,"ion-list")(14,"ion-item")(15,"ion-label"),e._uU(16,"Date"),e.qZA(),e._UZ(17,"ion-datetime-button",4),e.qZA(),e.TgZ(18,"ion-item")(19,"ion-label"),e._uU(20,"Amount"),e.qZA(),e.TgZ(21,"input",5),e.NdJ("ngModelChange",function(r){return n.newTransaction.amount=r}),e.qZA()(),e.TgZ(22,"ion-item")(23,"ion-label"),e._uU(24,"Transaction"),e.qZA(),e.TgZ(25,"ion-input",6),e.NdJ("ngModelChange",function(r){return n.newTransaction.name=r})("keydown",function(r){return n.hideKeyboard(r)}),e.qZA()(),e.TgZ(26,"ion-item")(27,"ion-label"),e._uU(28,"Merchant"),e.qZA(),e.TgZ(29,"ion-input",6),e.NdJ("ngModelChange",function(r){return n.newTransaction.merchant_name=r})("keydown",function(r){return n.hideKeyboard(r)}),e.qZA()()(),e.TgZ(30,"ion-modal",7),e.YNc(31,te,1,1,"ng-template"),e.qZA()()(),e.TgZ(32,"ion-card")(33,"ion-card-content")(34,"ion-list",8)(35,"ion-item",9)(36,"ion-label"),e._uU(37,"Budget Category"),e.qZA(),e._UZ(38,"br"),e.YNc(39,ne,2,1,"p",10),e.qZA()()()(),e.TgZ(40,"ion-modal",11,12),e.YNc(42,ie,10,1,"ng-template"),e.qZA()()),2&t&&(e.xp6(21),e.Q6J("ngModel",n.newTransaction.amount)("options",e.DdM(7,ae)),e.xp6(4),e.Q6J("ngModel",n.newTransaction.name),e.xp6(4),e.Q6J("ngModel",n.newTransaction.merchant_name),e.xp6(1),e.Q6J("keepContentsMounted",!0),e.xp6(9),e.Q6J("ngIf",n.newTransaction.subcategoryId),e.xp6(1),e.Q6J("presentingElement",n.presentingElement))},dependencies:[m.sg,m.O5,f.Fj,f.JJ,f.On,l.YG,l.Sm,l.PM,l.FN,l.W2,l.x4,l.Mj,l.Gu,l.pK,l.Ie,l.Q$,l.q_,l.wd,l.sr,l.ki,l.QI,l.j9,E.xv,J.m],styles:["#segment[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}#segment[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:90%;margin-top:25px}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{color:#fff}ion-toolbar[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{color:#fff}ion-input[_ngcontent-%COMP%]{text-align:end}ion-datetime-button[_ngcontent-%COMP%]::part(native){background:#fff;padding-right:5px}"]}),i})();class q{constructor(){this.map=new Map}get(c){return this.map.get(this.transformKey(c))}set(c,t){this.map.set(this.transformKey(c),t)}has(c){return this.map.has(this.transformKey(c))}delete(c){return this.map.delete(this.transformKey(c))}transformKey(c){return JSON.stringify(c)}}var Q=g(610),ce=g(2481);let w=(()=>{class i extends U.q{constructor(t){super(y.hc),this.cryptoService=t}get(t,n){var o=()=>super._get,r=this;return(0,d.Z)(function*(){let a=yield o().call(r,i.makeCollectionRef(t),n);return a=r.convertTimestampToDate(a),a=yield r.prepareTransactionForClient(a),a})()}getAll(){var t=()=>super._getAll,n=this;return(0,d.Z)(function*(){const o=yield t().call(n);if(o.docs){o.docs=o.docs.map(r=>n.convertTimestampToDate(r));for(let r=0;r<o.docs.length;r++)o.docs[r]=yield n.prepareTransactionForClient(o.docs[r])}return o})()}getAllFromParent(t){var n=()=>super._getAllFromParent,o=this;return(0,d.Z)(function*(){const r=yield n().call(o,i.makeCollectionRef(t));if(r.docs){r.docs=r.docs.map(a=>o.convertTimestampToDate(a));for(let a=0;a<r.docs.length;a++)r.docs[a]=yield o.prepareTransactionForClient(r.docs[a])}return r})()}getByQuery(t){var n=()=>super._getByQuery,o=this;return(0,d.Z)(function*(){const r=yield n().call(o,t);if(r.docs){r.docs=r.docs.map(a=>o.convertTimestampToDate(a));for(let a=0;a<r.docs.length;a++)r.docs[a]=yield o.prepareTransactionForClient(r.docs[a])}return r})()}add(t,n,o){var r=()=>super._add,a=this;return(0,d.Z)(function*(){const s=yield a.prepareTransactionForFirestore(n);return s&&r().call(a,i.makeCollectionRef(t),s,o)})()}update(t,n,o){var r=()=>super._update,a=this;return(0,d.Z)(function*(){const s=yield a.prepareTransactionForFirestore(o);return!!s&&r().call(a,i.makeCollectionRef(t),n,s)})()}delete(t,n,o=!1){var r=()=>super._delete,a=this;return(0,d.Z)(function*(){return r().call(a,i.makeCollectionRef(t),n,o)})()}static makeCollectionRef(t){return(0,h.hJ)((0,h.ad)(),y.YP,t,y.hc)}prepareTransactionForFirestore(t){var n=this;return(0,d.Z)(function*(){if(!t)return t;let o=structuredClone(t);o[M.O]=!0;let r={};Q.s4.forEach(s=>{r[s]=t[s],delete o[s]});const a=yield n.cryptoService.encryptObject(r);return o.encrypted_string=a,o})()}prepareTransactionForClient(t){var n=this;return(0,d.Z)(function*(){if(!t)return t;let o=structuredClone(t);const r=o.encrypted_string;delete o.encrypted_string;const a=yield n.cryptoService.decryptObject(r);return Q.s4.forEach(s=>{o[s]=a[s]}),o})()}convertTimestampToDate(t){return t?(t.date=t.date.toDate(),t):t}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(ce.$))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function de(i,c){return(0,h.IO)(w.makeCollectionRef(i),(0,h.ar)("subcategoryId","==",c))}var ue=g(2726),b=g(3549);const C=(0,ue.fo)("Haptics",{web:()=>g.e(8756).then(g.bind(g,8756)).then(i=>new i.HapticsWeb)});var H=g(7195),ge=g(7616),pe=g(1914),me=g(1743);let he=(()=>{class i{constructor(t,n,o,r,a){this.plaidService=t,this.transactionRepository=n,this.userRepository=o,this.transactionPublisher=r,this.finicityService=a,this.transactionPublisher.subscribe(this)}getTransactions(t,n=!0,o=null,r=null){var a=this;return(0,d.Z)(function*(){const s=a.userRepository.getCurrentUserId();if(!s)throw new Error("User is not logged in");let u=[];const p=function le(i,c,t,n,o=null){let r=[];return c||r.push((0,h.ar)("pending","==",!1)),t&&r.push((0,h.ar)("date",">=",t)),n&&r.push((0,h.ar)("date","<=",n)),o&&r.push((0,h.ar)("subcategoryId","==",o)),(0,h.IO)(w.makeCollectionRef(i),(0,h.xD)(...r))}(s,t,o,r);return u=(yield a.transactionRepository.getByQuery(p)).docs,n&&(a.plaidService.syncPlaidTransactions(),a.finicityService.syncTransactions(r)),u})()}onTransactionEvent(t){var n=this;return(0,d.Z)(function*(){t.addedTransactions.forEach(function(){var o=(0,d.Z)(function*(r){n.transactionRepository.add(n.userRepository.getCurrentUserId(),r,r.id)});return function(r){return o.apply(this,arguments)}}()),t.removedTransactions.forEach(function(){var o=(0,d.Z)(function*(r){n.transactionRepository.delete(n.userRepository.getCurrentUserId(),r.id,!0)});return function(r){return o.apply(this,arguments)}}()),t.modifiedTransactions.forEach(function(){var o=(0,d.Z)(function*(r){n.transactionRepository.update(n.userRepository.getCurrentUserId(),r.id,r)});return function(r){return o.apply(this,arguments)}}())})()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(pe.O),e.LFG(w),e.LFG(H.E),e.LFG(A.u),e.LFG(me.v))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var fe=g(3076);let _e=(()=>{class i{constructor(t){this.datePipe=t,this.requestDateChange=new e.vpe,this.addTransactionButtonClicked=new e.vpe,this.refreshButtonClicked=new e.vpe,this.isSpinning=!1}ngOnInit(){}addTransaction(){var t=this;return(0,d.Z)(function*(){t.addTransactionButtonClicked.emit()})()}refresh(){this.isSpinning=!0,setTimeout(()=>{this.isSpinning=!1},2e3),this.refreshButtonClicked.emit()}dateClicked(){this.requestDateChange.emit()}getShortMonthName(t){if(!t)return"";try{return this.datePipe.transform(new Date(`${t} 1, 2000`),"MMM")||""}catch{return console.error("Invalid month name:",t),""}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(m.uU))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-header"]],inputs:{chosenMonth:"chosenMonth",chosenYear:"chosenYear"},outputs:{requestDateChange:"requestDateChange",addTransactionButtonClicked:"addTransactionButtonClicked",refreshButtonClicked:"refreshButtonClicked"},features:[e._Bn([m.uU])],decls:15,vars:4,consts:[["id","top-toolbar","color","primary"],["slot","start"],[3,"click"],["name","refresh","slot","icon-only"],["id","month-picker",3,"click"],[1,"month"],[1,"year"],["name","chevron-down","slot","icon-only"],["slot","end"],["name","add","slot","icon-only"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return n.refresh()}),e._UZ(4,"ion-icon",3),e.qZA()(),e.TgZ(5,"div",4),e.NdJ("click",function(){return n.dateClicked()}),e.TgZ(6,"span",5),e._uU(7),e.qZA(),e.TgZ(8,"span",6),e._uU(9),e.qZA(),e.TgZ(10,"span"),e._UZ(11,"ion-icon",7),e.qZA()(),e.TgZ(12,"ion-buttons",8)(13,"ion-button",2),e.NdJ("click",function(){return n.addTransaction()}),e._UZ(14,"ion-icon",9),e.qZA()()()()),2&t&&(e.xp6(4),e.ekj("spin",n.isSpinning),e.xp6(3),e.Oqu(n.getShortMonthName(n.chosenMonth)),e.xp6(2),e.Oqu(n.chosenYear))},dependencies:[l.YG,l.Sm,l.Gu,l.gu,l.sr],styles:["#top-toolbar[_ngcontent-%COMP%]{height:135px}#top-toolbar[_ngcontent-%COMP%]   #month-picker[_ngcontent-%COMP%]{text-align:center;margin:15px}#top-toolbar[_ngcontent-%COMP%]   #month-picker[_ngcontent-%COMP%]   .month[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-size:40px;color:var(--ion-color-primary-contrast)}#top-toolbar[_ngcontent-%COMP%]   #month-picker[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{font-size:30px;color:var(--ion-color-primary-contrast);padding-left:10px;font-weight:300}#top-toolbar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary-contrast)}#bottom-toolbar[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{width:90%}.spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]}),i})();function ye(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",22)(1,"ion-button",12),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.copyOverBudget())}),e._uU(2,"Copy Previous Month Budget"),e.qZA()()}}function be(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",12),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deleteAllPending())}),e._UZ(1,"ion-icon",23),e.qZA()}}function Ce(i,c){1&i&&(e.O4$(),e.TgZ(0,"svg",24),e._UZ(1,"path",25)(2,"path",26),e.qZA())}function Te(i,c){1&i&&(e.O4$(),e.TgZ(0,"svg",24),e._UZ(1,"path",27)(2,"path",28),e.qZA())}const ve=function(){return[]};function xe(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",29)(1,"app-category",30),e.NdJ("addNewSubEvent",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.addNewSub(r))})("requestSaveOfSubs",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveAllSubs())})("requestDeleteCategory",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.deleteCategory(o))})("subcategorySelected",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.subcategorySelected(o))}),e.qZA(),e._UZ(2,"ion-reorder",31),e.qZA()}if(2&i){const t=c.$implicit,n=e.oxw();e.MGl("id","",t.id,"-ion-item"),e.xp6(1),e.Q6J("category",t)("subcategories",t.subcategories||e.DdM(7,ve))("chosenDate",n.chosenDate)("isUserReorderingCategories",n.isUserReorderingCategories)("isUserRemovingCategories",n.isUserRemovingCategories),e.xp6(1),e.MGl("id","",t.id,"-reorder")}}function Ae(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",32),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addCategory())}),e._UZ(1,"ion-icon",33),e._uU(2," Add New Category "),e.qZA()}}function Ze(i,c){1&i&&(e.TgZ(0,"span"),e._UZ(1,"ion-icon",38),e.qZA())}function we(i,c){if(1&i&&(e.TgZ(0,"span",39),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.unsortedTransactions.length," ")}}function Me(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",34),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.revealUnsortedTransactions())}),e.TgZ(1,"div",35),e.YNc(2,Ze,2,0,"span",36),e.YNc(3,we,2,1,"span",37),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.isCardContainerVisible),e.xp6(1),e.Q6J("ngIf",!t.isCardContainerVisible)}}function Se(i,c){if(1&i){const t=e.EpF();e.TgZ(0,"div",40),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.openTransactionSorter(r))}),e.TgZ(1,"div",41),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"span",42),e._uU(5),e.ALo(6,"currency"),e.qZA(),e.TgZ(7,"div",43),e._uU(8),e.qZA()()}if(2&i){const t=c.$implicit;e.xp6(2),e.Oqu(e.xi3(3,3,t.date,"MMM. d")),e.xp6(3),e.Oqu(e.lcZ(6,6,-1*t.amount)),e.xp6(3),e.Oqu(t.merchant_name||t.name)}}const Pe=function(i){return{color:i}},Ne=function(i){return{"slide-up":i}},ke=[{path:"",component:(()=>{class i{constructor(t,n,o,r,a,s,u,p,k,_,T){this.userRepository=t,this.pickerCtrl=n,this.modalCtrl=o,this.categoryRepository=r,this.subcategoryRepository=a,this.transactionService=s,this.transactionRepository=u,this.transactionPublisher=p,this.userService=k,this.alertController=_,this.loadingController=T,this.showCopyBudget=!1,this.unsortedTransactions=[],this.institutionName="",this.isCardContainerVisible=!1,this.plannedIncome=0,this.leftToBudget=0,this.remainingToSpend=0,this.isUserReorderingCategories=!1,this.isUserRemovingCategories=!1,this.chosenDateNumber=Z(),this.transactions=new q,this.categories=new q}ngOnInit(){var t=this;return(0,d.Z)(function*(){t.transactionPublisher.subscribe(t),t.userSubscription=t.userRepository.currentFirestoreUser.subscribe(n=>{t.user=n,n&&t.loadMonthData()})})()}ngOnDestroy(){var t=this;return(0,d.Z)(function*(){var n;t.transactionPublisher.unsubscribe(t),null===(n=t.userSubscription)||void 0===n||n.unsubscribe()})()}get chosenDate(){return this._chosenDate}get chosenDateNumber(){return this._chosenDateNumber}set chosenDateNumber(t){this._chosenDateNumber=t,this._chosenDate=function W(i){return i||(i=new Date),i instanceof Date||(i=new Date(i.year,i.month,1)),{month:i.toLocaleString("default",{month:"long"}),year:i.getFullYear().toString()}}(t)}get startAndEndOfMonth(){return function V(i){return i||(i=new Date),i instanceof Date||(i=new Date(i.year,i.month,1)),{start:new Date(i.getFullYear(),i.getMonth(),1),end:new Date(i.getFullYear(),i.getMonth()+1,0,23,59,59,999)}}(this.chosenDateNumber)}get transactionsLength(){const t=this.transactions.get(this.chosenDateNumber);return t?t.length:0}get transactionsArray(){return this.transactions.get(this.chosenDateNumber)||[]}set transactionsArray(t){this.transactions.set(this.chosenDateNumber,t)}get categoriesLength(){const t=this.categories.get(this.chosenDateNumber);return t?t.length:0}get categoriesArray(){return this.categories.get(this.chosenDateNumber)||[]}loadMonthData(){var t=this;return(0,d.Z)(function*(){const n=[];n.push(t.grabTransactionsForSelectedMonth()),n.push(t.grabUserCategoriesForSelectedMonth()),Promise.all(n).then(o=>{C.notification({type:b.k$.Success});const r=o[0],a=o[1];r.sort(R),a.sort(x),t.transactions.set(t.chosenDateNumber,r),t.unsortedTransactions=r.filter(s=>!s.subcategoryId||""==s.subcategoryId),t.categories.set(t.chosenDateNumber,a),t.shouldShowCopyBudget(),t.calculatePlannedAndBudget(a)})})()}grabUserCategoriesForSelectedMonth(t=!1){var n=this;return(0,d.Z)(function*(){if(!n.user)return[];const o=yield n.categoryRepository.getAllFromParent(n.user.id),r=o.docs,a=[];let s;if(t){let u=n.chosenDateNumber.month,p=n.chosenDateNumber.year;0===u?(u=11,p--):u--,s={month:u,year:p}}for(let u=0;u<r.length;u++)a.push(n.subcategoryRepository.getByQuery(Y(n.user.id,o.docs[u].id,t?s:n.chosenDateNumber)).then(p=>{r[u].subcategories=0==p.size?[]:p.docs,r[u].subcategories.sort(x)}));return yield Promise.all(a),r})()}shouldShowCopyBudget(){var t=this;return(0,d.Z)(function*(){if(!t.user)return[];const n=yield t.categoryRepository.getAllFromParent(t.user.id),o=n.docs;let r=[];for(let s=0;s<o.length;s++)yield t.subcategoryRepository.getByQuery(Y(t.user.id,n.docs[s].id,t.chosenDateNumber)).then(u=>{0!=u.size&&(r=u.docs,r.sort(x))});t.showCopyBudget=0==r.length})()}grabTransactionsForSelectedMonth(){var t=this;return(0,d.Z)(function*(){if(!t.user)return[];const{end:o}=t.startAndEndOfMonth;return t.transactionService.getTransactions(!0,t.userService.isPremium,null,o)})()}updateSubcategoryActualAmounts(){const t=this.transactions.get(this.chosenDateNumber);if(!t)return!1;const n=this.categories.get(this.chosenDateNumber);if(!n)return!1;let o=new Map;for(let r=0;r<t.length;r++){const a=t[r];o.has(a.subcategoryId)?o.set(a.subcategoryId,o.get(a.subcategoryId)+a.amount):o.set(a.subcategoryId,a.amount)}for(let r=0;r<n.length;r++)for(let a=0;a<n[r].subcategories.length;a++){const s=n[r].subcategories[a];s.actual_amount=o.has(s.id)?o.get(s.id):0}return!0}calculatePlannedAndBudget(t){this.updateSubcategoryActualAmounts();let n=0,o=0,r=0;for(let a=0;a<t.length;a++)if("income"==t[a].id)for(let s=0;s<t[a].subcategories.length;s++)n+=t[a].subcategories[s].planned_amount;else for(let s=0;s<t[a].subcategories.length;s++)o+=t[a].subcategories[s].planned_amount,r+=t[a].subcategories[s].actual_amount;this.plannedIncome=n,this.leftToBudget=-1*this.plannedIncome-o,this.leftToBudget<=-0&&this.leftToBudget>-.01&&(this.leftToBudget=0),this.remainingToSpend=-1*this.plannedIncome-r}addNewSub(t){this.isUserRemovingCategories=!1;const n={text:"",index:t.subcategories.length,planned_amount:0,date:{month:this.chosenDateNumber.month,year:this.chosenDateNumber.year},actual_amount:0,id:(0,I.D)(),isEditing:!0};t.subcategories.push(n)}saveAllSubs(){var t=this;return(0,d.Z)(function*(){if(0==t.categoriesLength||!t.user)return;const n=[];for(let o=0;o<t.categoriesLength;o++){let r=t.categoriesArray[o];if(r&&r.subcategories)for(let a=0;a<r.subcategories.length;a++){let s=r.subcategories[a];if(s&&s.isEditing){if(0==s.text.length){r.subcategories.splice(a,1);continue}s.isEditing=!1,n.push(t.subcategoryRepository.add(t.user.id,t.categoriesArray[o].id,t.categoriesArray[o].subcategories[a],t.categoriesArray[o].subcategories[a].id))}}}})()}addTransaction(){var t=this;return(0,d.Z)(function*(){(yield t.modalCtrl.create({component:se,componentProps:{categories:t.categoriesArray,user:t.user}})).present()})()}requestDateChange(){var t=this;return(0,d.Z)(function*(){let n=[];for(let r=0;r<P.length;r++)if(P[r].text==t.chosenDate.month){n[0]=r;break}for(let r=0;r<N.length;r++)N[r].text==t.chosenDate.year&&(n[1]=r);const o=yield t.pickerCtrl.create({columns:[{name:"month",options:P},{name:"year",options:N}],buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:r=>{t.chosenDateNumber={month:r.month.value,year:r.year.value},t.loadMonthData()}}]});o.columns[0].selectedIndex=n[0],o.columns[1].selectedIndex=n[1],yield o.present()})()}revealUnsortedTransactions(){C.impact({style:b.y$.Light}),this.isCardContainerVisible=!this.isCardContainerVisible}openTransactionSorter(t){var n=this;return(0,d.Z)(function*(){yield C.impact({style:b.y$.Light}),(yield n.modalCtrl.create({component:$.m,componentProps:{transaction:t,user:n.user,categories:n.categoriesArray},initialBreakpoint:.6,breakpoints:[0,.6,.8,1]})).present()})()}subcategorySelected(t){var n=this;return(0,d.Z)(function*(){const o=yield n.modalCtrl.create({component:K,componentProps:{subcategory:t.sub,category:t.cat,transactions:n.transactionsArray,user:n.user},initialBreakpoint:.6,breakpoints:[0,.6,.8,1]});o.onDidDismiss().then(r=>{r&&r.data&&"edit"==r.data.action&&r.data.transaction&&n.openTransactionSorter(r.data.transaction),n.calculatePlannedAndBudget(n.categoriesArray)}),o.present()})()}formatCurrency(t,n="USD",o="en-US"){const r=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});return t<0?r.format(-t):0==t?"$0.00":r.format(t)}onTransactionEvent(t){var n=this;return(0,d.Z)(function*(){const{addedTransactions:o,removedTransactions:r,modifiedTransactions:a}=t,s=[];s.push(n.handleAddedTransactions(o)),s.push(n.handleRemovedTransactions(r)),s.push(n.handleModifiedTransactions(a)),Promise.all(s).then(u=>{n.calculatePlannedAndBudget(n.categoriesArray),n.unsortedTransactions=n.transactionsArray.filter(p=>!p.subcategoryId||""==p.subcategoryId)})})()}handleAddedTransactions(t){var n=this;return(0,d.Z)(function*(){if(t&&0!=t.length)for(let o=0;o<t.length;o++){const r=t[o],a=Z(r.date);n.transactions.has(a)&&n.transactions.get(a).push(r)}})()}handleRemovedTransactions(t){var n=this;return(0,d.Z)(function*(){for(let o=0;o<t.length;o++){const r=t[o],a=Z(r.date);if(n.transactions.has(a)){const s=n.transactions.get(a),u=s.findIndex(p=>p.id==r.id);u>=0&&s.splice(u,1)}}})()}handleModifiedTransactions(t){var n=this;return(0,d.Z)(function*(){for(let o=0;o<t.length;o++){const r=t[o],a=Z(r.date);if(n.transactions.has(a)){const s=n.transactions.get(a),u=s.findIndex(p=>p.id==r.id);u>=0&&(s[u]=r)}}})()}addCategory(){var t=this;return(0,d.Z)(function*(){(yield t.alertController.create({header:"Add a new category",inputs:[{name:"categoryName",type:"text",placeholder:"Category name"}],buttons:[{text:"Cancel",role:"cancel"},{text:"Add",handler:t.addCategoryHandler.bind(t)}]})).present()})()}addCategoryHandler(t){var n=this;return(0,d.Z)(function*(){if(!t||!t.categoryName||0==t.categoryName.length)return;const o=yield n.loadingController.create();yield o.present();try{let r=t.categoryName.toLowerCase();if(n.categoriesArray.find(s=>s.id==r))throw new Error("Category already exists");const a={id:r,index:n.categoriesArray.length,editable:!0};n.categoriesArray.push(a),yield n.categoryRepository.add(n.user.id,a,a.id)}catch(r){console.log(r)}finally{o.dismiss()}})()}toggleRemoveCategories(){this.isUserRemovingCategories=!this.isUserRemovingCategories}deleteCategory(t){var n=this;return(0,d.Z)(function*(){const o=t.cat&&t.sub?t.sub.text:t.cat.id;let r="Are you sure you want to delete this?";t.cat&&!t.sub&&(r+=" All subcategories, even past ones, will be permanently deleted too."),yield(yield n.alertController.create({header:"Delete "+o+"?",message:r,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{C.notification({type:b.k$.Success}),t.cat&&t.sub?n.handleDeleteOnlySubcategory(t.cat,t.sub):t.cat&&!t.sub&&n.handleDeleteWholeCategory(t.cat)}}]})).present()})()}handleDeleteOnlySubcategory(t,n){var o=this;return(0,d.Z)(function*(){const r=yield o.loadingController.create();yield r.present(),console.log(`Deleting subcategory ${n.text} in ${t.id}`);const a=o.transactionsArray.filter(p=>p.subcategoryId==n.id),s=a.length;if(0==s)return o.removeSubcategoryFromDatabaseAndArray(t,n),void r.dismiss();const u=yield o.alertController.create({header:"Where should the transactions go?",message:`There ${s>1?"are":"is"} ${s} transaction${s>1?"s":""}\n        in this category. What would you like to do with ${s>1?"them":"it"}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Move to unsorted",handler:()=>{a.forEach(p=>{p.subcategoryId=""}),o.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:a,removedTransactions:[]}),o.removeSubcategoryFromDatabaseAndArray(t,n)}},{text:"Delete",handler:()=>{o.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[],removedTransactions:a}),o.removeSubcategoryFromDatabaseAndArray(t,n)}}]});r.dismiss(),yield u.present()})()}handleDeleteWholeCategory(t){var n=this;return(0,d.Z)(function*(){console.log(`Deleting category  ${t.id}`);const o=yield n.loadingController.create();yield o.present();const r=yield n.subcategoryRepository.getAllFromParent(n.user.id,t.id);if(0==r.size)return yield n.removeCategoryFromDatabaseAndArray(t,[]),void o.dismiss();let a=[];for(let _=0;_<r.size;_++){const T=n.transactionRepository.getByQuery(de(n.user.id,r.docs[_].id));a.push(T)}const s=yield Promise.all(a),u=[];s.forEach(_=>{_.docs.forEach(T=>{u.push(T)})});const p=u.length,k=yield n.alertController.create({header:"Where should the transactions go?",message:`There ${p>1?"are":"is"} ${p} transaction${p>1?"s":""}\n        in this category. What would you like to do with ${p>1?"them":"it"}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Move to unsorted",handler:()=>{u.forEach(_=>{_.subcategoryId=""}),n.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:u,removedTransactions:[]}),n.removeCategoryFromDatabaseAndArray(t,r.docs)}},{text:"Delete",handler:()=>{n.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[],removedTransactions:u}),n.removeCategoryFromDatabaseAndArray(t,r.docs)}}]});o.dismiss(),yield k.present()})()}toggleReorder(){this.isUserReorderingCategories?this.hideReorderButton():this.showReorderButton()}showReorderButton(){const t=document.getElementsByClassName("reorder-button");if(0!=t.length){this.isUserReorderingCategories=!0;for(let n=0;n<t.length;n++){const o=t[n],r=document.getElementById(o.id.replace("-reorder","")+"-card");r&&(o.style.left=r.clientWidth-50+"px",o.style.opacity="1")}}}hideReorderButton(){const t=document.getElementsByClassName("reorder-button");if(0!=t.length){for(let n=0;n<t.length;n++)t[n].style.opacity="0";this.isUserReorderingCategories=!1}}doneReorderItems(t){var n=this;return(0,d.Z)(function*(){if(null==t.detail.from||null==t.detail.to)return void t.detail.complete();if(t.detail.from==t.detail.to)return void t.detail.complete();const o=new Map;n.categoriesArray.forEach((a,s)=>{o.set(a.id,s)});const r=n.categoriesArray[t.detail.from];n.categoriesArray.splice(t.detail.from,1),n.categoriesArray.splice(t.detail.to,0,r),n.categoriesArray.forEach((a,s)=>{o.get(a.id)!=s&&n.categoryRepository.update(n.user.id,a.id,{index:s})}),t.detail.complete()})()}removeCategoryFromDatabaseAndArray(t,n){var o=this;return(0,d.Z)(function*(){let r=[];n.forEach(s=>{r.push(o.removeSubcategoryFromDatabaseAndArray(t,s))}),yield Promise.all(r),o.categoryRepository.delete(o.user.id,t.id,!0);const a=o.categoriesArray.findIndex(s=>s.id==t.id);a>=0&&o.categoriesArray.splice(a,1)})()}removeSubcategoryFromDatabaseAndArray(t,n){var o=this;return(0,d.Z)(function*(){o.subcategoryRepository.delete(o.user.id,t.id,n.id,!0);const r=t.subcategories.findIndex(a=>a.id==n.id);r>=0&&t.subcategories.splice(r,1),o.shouldShowCopyBudget()})()}copyOverBudget(){var t=this;return(0,d.Z)(function*(){var o;(yield t.alertController.create({header:"Are you sure you want to copy last months budget?",buttons:[{text:"Cancel",role:"cancel"},{text:"Yes",handler:(o=(0,d.Z)(function*(){const r=yield t.grabUserCategoriesForSelectedMonth(!0);r.sort(x),t.categories.set(t.chosenDateNumber,r),t.calculatePlannedAndBudget(r),r.forEach(a=>{var s;null===(s=a.subcategories)||void 0===s||s.forEach(u=>{var p;console.log(u),u.date.month=t.chosenDateNumber.month,u.date.year=t.chosenDateNumber.year,t.subcategoryRepository.add(null===(p=t.user)||void 0===p?void 0:p.id,a.id,u)})}),t.shouldShowCopyBudget()}),function(){return o.apply(this,arguments)})}]})).present()})()}deleteAllPending(){var t=this;return(0,d.Z)(function*(){var o;C.impact({style:b.y$.Heavy}),(yield t.alertController.create({header:"Are you sure you want to delete ALL uncategorized transactions?",buttons:[{text:"Cancel",role:"cancel"},{text:"Yes",handler:(o=(0,d.Z)(function*(){console.log(t.unsortedTransactions),t.unsortedTransactions.forEach(r=>{t.transactionPublisher.publishEvent({from:"manual",addedTransactions:[],modifiedTransactions:[],removedTransactions:[r]})}),t.loadMonthData()}),function(){return o.apply(this,arguments)})}]})).present()})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(H.E),e.Y36(l.up),e.Y36(l.IN),e.Y36(ge.r),e.Y36(S),e.Y36(he),e.Y36(w),e.Y36(A.u),e.Y36(fe.K),e.Y36(l.Br),e.Y36(l.HT))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-tab1"]],decls:31,vars:24,consts:[[3,"chosenMonth","chosenYear","requestDateChange","addTransactionButtonClicked","refreshButtonClicked"],[1,"ion-content-scroll-host",3,"fullscreen"],["id","budget-remaining-container"],[3,"ngClass"],["style","\n      display: grid;\n      align-items: center;\n      justify-items: center;\n      margin-top: 15px;\n      margin-bottom: 15px;\n    ","shape","block",4,"ngIf"],["id","planned-income-container"],["id","planned-income"],[1,"title"],["id","options-container"],[3,"click",4,"ngIf"],[3,"ngClass","click"],["width","35px","height","35px","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",4,"ngIf"],[3,"click"],["name","pencil-outline",2,"font-size","26px",3,"ngStyle"],[3,"disabled","ionItemReorder"],["class","category-item-container","lines","none",3,"id",4,"ngFor","ngForOf"],[2,"display","flex","justify-content","center"],["class","add-new-category-button","fill","clear",3,"click",4,"ngIf"],["id","app-draggable-container",3,"click",4,"ngIf"],[1,"card-container",3,"ngClass"],["id","scrollable-container"],["id","card",3,"click",4,"ngFor","ngForOf"],["shape","block",2,"display","grid","align-items","center","justify-items","center","margin-top","15px","margin-bottom","15px"],["name","trash",2,"font-size","26px"],["width","35px","height","35px","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M16.0686 15H7.9313C7.32548 15 7.02257 15 6.88231 15.1198C6.76061 15.2238 6.69602 15.3797 6.70858 15.5393C6.72305 15.7232 6.93724 15.9374 7.36561 16.3657L11.4342 20.4344C11.6323 20.6324 11.7313 20.7314 11.8454 20.7685C11.9458 20.8011 12.054 20.8011 12.1544 20.7685C12.2686 20.7314 12.3676 20.6324 12.5656 20.4344L16.6342 16.3657C17.0626 15.9374 17.2768 15.7232 17.2913 15.5393C17.3038 15.3797 17.2392 15.2238 17.1175 15.1198C16.9773 15 16.6744 15 16.0686 15Z","stroke","#666","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M7.9313 9.00005H16.0686C16.6744 9.00005 16.9773 9.00005 17.1175 8.88025C17.2393 8.7763 17.3038 8.62038 17.2913 8.46082C17.2768 8.27693 17.0626 8.06274 16.6342 7.63436L12.5656 3.56573C12.3676 3.36772 12.2686 3.26872 12.1544 3.23163C12.054 3.199 11.9458 3.199 11.8454 3.23163C11.7313 3.26872 11.6323 3.36772 11.4342 3.56573L7.36561 7.63436C6.93724 8.06273 6.72305 8.27693 6.70858 8.46082C6.69602 8.62038 6.76061 8.7763 6.88231 8.88025C7.02257 9.00005 7.32548 9.00005 7.9313 9.00005Z","stroke","#666","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M16.0686 15H7.9313C7.32548 15 7.02257 15 6.88231 15.1198C6.76061 15.2238 6.69602 15.3797 6.70858 15.5393C6.72305 15.7232 6.93724 15.9374 7.36561 16.3657L11.4342 20.4344C11.6323 20.6324 11.7313 20.7314 11.8454 20.7685C11.9458 20.8011 12.054 20.8011 12.1544 20.7685C12.2686 20.7314 12.3676 20.6324 12.5656 20.4344L16.6342 16.3657C17.0626 15.9374 17.2768 15.7232 17.2913 15.5393C17.3038 15.3797 17.2392 15.2238 17.1175 15.1198C16.9773 15 16.6744 15 16.0686 15Z","stroke","#00eabb","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M7.9313 9.00005H16.0686C16.6744 9.00005 16.9773 9.00005 17.1175 8.88025C17.2393 8.7763 17.3038 8.62038 17.2913 8.46082C17.2768 8.27693 17.0626 8.06274 16.6342 7.63436L12.5656 3.56573C12.3676 3.36772 12.2686 3.26872 12.1544 3.23163C12.054 3.199 11.9458 3.199 11.8454 3.23163C11.7313 3.26872 11.6323 3.36772 11.4342 3.56573L7.36561 7.63436C6.93724 8.06273 6.72305 8.27693 6.70858 8.46082C6.69602 8.62038 6.76061 8.7763 6.88231 8.88025C7.02257 9.00005 7.32548 9.00005 7.9313 9.00005Z","stroke","#00eabb","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["lines","none",1,"category-item-container",3,"id"],[2,"width","100%",3,"category","subcategories","chosenDate","isUserReorderingCategories","isUserRemovingCategories","addNewSubEvent","requestSaveOfSubs","requestDeleteCategory","subcategorySelected"],[1,"reorder-button",3,"id"],["fill","clear",1,"add-new-category-button",3,"click"],["name","add","slot","start"],["id","app-draggable-container",3,"click"],["id","transaction-counter"],[4,"ngIf"],["class","counter-number",4,"ngIf"],["name","close",2,"color","white","font-size","30px"],[1,"counter-number"],["id","card",3,"click"],["id","date"],["id","amount"],["id","name"]],template:function(t,n){1&t&&(e.TgZ(0,"app-header",0),e.NdJ("requestDateChange",function(){return n.requestDateChange()})("addTransactionButtonClicked",function(){return n.addTransaction()})("refreshButtonClicked",function(){return n.loadMonthData()}),e.qZA(),e.TgZ(1,"ion-content",1)(2,"div",2)(3,"span")(4,"span",3),e._uU(5),e.qZA(),e._uU(6),e.qZA()(),e.YNc(7,ye,3,0,"div",4),e.TgZ(8,"div",5)(9,"span",6)(10,"span",7),e._uU(11,"Budget Balance"),e.qZA(),e.TgZ(12,"span",3)(13,"strong"),e._uU(14),e.qZA()()()(),e.TgZ(15,"div",8),e.YNc(16,be,2,0,"div",9),e.TgZ(17,"div",10),e.NdJ("click",function(){return n.toggleReorder()}),e.YNc(18,Ce,3,0,"svg",11),e.YNc(19,Te,3,0,"svg",11),e.qZA(),e.TgZ(20,"div",12),e.NdJ("click",function(){return n.toggleRemoveCategories()}),e._UZ(21,"ion-icon",13),e.qZA()(),e.TgZ(22,"div")(23,"ion-reorder-group",14),e.NdJ("ionItemReorder",function(r){return n.doneReorderItems(r)}),e.YNc(24,xe,3,8,"ion-item",15),e.qZA(),e.TgZ(25,"div",16),e.YNc(26,Ae,3,0,"ion-button",17),e.qZA()(),e.YNc(27,Me,4,2,"div",18),e.TgZ(28,"div",19)(29,"div",20),e.YNc(30,Se,9,8,"div",21),e.qZA()()()),2&t&&(e.Q6J("chosenMonth",n.chosenDate.month)("chosenYear",n.chosenDate.year),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(3),e.Q6J("ngClass",n.leftToBudget<0?"over-budget":"on-budget"),e.xp6(1),e.hij(" ",n.formatCurrency(n.leftToBudget)," "),e.xp6(1),e.hij(" ",n.leftToBudget<0?"over budget":"left to budget"," "),e.xp6(1),e.Q6J("ngIf",n.showCopyBudget),e.xp6(5),e.Q6J("ngClass",n.remainingToSpend<0?"over-budget":"on-budget"),e.xp6(2),e.Oqu(n.formatCurrency(n.remainingToSpend)),e.xp6(2),e.Q6J("ngIf",n.unsortedTransactions.length>0),e.xp6(1),e.Q6J("ngClass",n.isUserReorderingCategories?"sort-active":""),e.xp6(1),e.Q6J("ngIf",!n.isUserReorderingCategories),e.xp6(1),e.Q6J("ngIf",n.isUserReorderingCategories),e.xp6(2),e.Q6J("ngStyle",e.VKq(20,Pe,n.isUserRemovingCategories?"var(--ion-color-primary)":"#666")),e.xp6(2),e.Q6J("disabled",!n.isUserReorderingCategories),e.xp6(1),e.Q6J("ngForOf",n.categoriesArray),e.xp6(2),e.Q6J("ngIf",!n.isUserReorderingCategories&&!n.isUserRemovingCategories),e.xp6(1),e.Q6J("ngIf",n.unsortedTransactions.length>0),e.xp6(1),e.Q6J("ngClass",e.VKq(22,Ne,n.isCardContainerVisible)),e.xp6(2),e.Q6J("ngForOf",n.unsortedTransactions))},dependencies:[l.YG,l.W2,l.gu,l.Ie,l.Nh,l.oz,m.mk,m.sg,m.O5,m.PC,_e,J.m,m.H9,m.uU],styles:["#budget-remaining-container{width:100%;height:44px;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 2px 10px #0000001a;position:sticky;top:0;background-color:#fff;z-index:100}#budget-remaining-container .over-budget{font-weight:700;color:red}#budget-remaining-container .on-budget{font-weight:700;color:#000}.category-reorder-container,.category-item-container{--width: 100%;--background: transparent}#planned-income-container{display:block;margin:auto auto 10px;width:92%;box-shadow:0 2px 10px #0000001a}#planned-income-container #planned-income{background-color:#fff;margin-top:10px;width:100%;height:120px;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:23px;border-radius:8px}#planned-income-container #planned-income .title{color:#464646;font-size:18px}#planned-income-container #planned-income .over-budget{font-weight:700;color:red}#planned-income-container #planned-income .on-budget{font-weight:700;color:#000}#app-draggable-container{position:fixed;bottom:18px;left:50%;z-index:99;transform:translate(-50%)}#app-draggable-container #transaction-counter{display:flex;align-items:center;justify-content:center;height:50px;width:50px;border-radius:50%;background-color:var(--ion-color-primary)}#app-draggable-container .counter-number{font-size:24px;color:#fff;font-weight:500}ion-refresher.refresher-active{z-index:1}.card-container{position:fixed;bottom:70px;left:0;width:100%;height:100px;background-color:transparent;transition:transform .3s ease-out,opacity .1s ease-out;transform:translateY(200px);overflow-x:auto;white-space:nowrap;opacity:0;z-index:99}#scrollable-container{display:flex;flex-direction:row;justify-content:space-between;align-items:center;z-index:98;width:-moz-fit-content;width:fit-content;margin:0 auto}#card{flex:0 0 auto;height:90px;width:100px;background:white;text-align:center;border:1px solid var(--ion-color-primary);box-shadow:0 2px 10px #0000001a;border-radius:5px;margin:0 5px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}#card #date{font-size:12px}#card #name{max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:start;font-size:12px;padding-left:5px;padding-right:5px}#card #amount{font-weight:700;font-size:16px}.card-container.slide-up{transform:translateY(0);opacity:1}#options-container{display:flex;flex-direction:row;justify-content:flex-end;align-items:center;width:92%;margin:0 auto;padding:0 0 6px}.option{width:75px;height:75px}ion-reorder{position:absolute;z-index:99;opacity:0}.sort-active svg path{stroke:var(--ion-color-primary)}.add-new-category-button{width:68%;font-size:22px}\n"],encapsulation:2}),i})()}];let De=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[O.Bz.forChild(ke),O.Bz]}),i})();var Oe=g(822);let Ie=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[l.Pc,m.ez,f.u5,D.e,De,Oe.K]}),i})()}}]);