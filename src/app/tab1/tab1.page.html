<app-header
  [chosenMonth]="chosenDate.month"
  [chosenYear]="chosenDate.year"
  (requestDateChange)="requestDateChange()"
  (addTransactionButtonClicked)="addTransaction()"
  (refreshButtonClicked)="loadMonthData()"
></app-header>

<ion-content [fullscreen]="true" class="ion-content-scroll-host">
  <div id="budget-remaining-container">
    <span>
      <span [ngClass]="leftToBudget < 0 ? 'over-budget' : 'on-budget'">
        {{ formatCurrency(leftToBudget) }}
      </span>
      {{ leftToBudget < 0 ? 'over budget' : 'left to budget' }}
    </span>
  </div>
  <div id="planned-income-container">
    <span id="planned-income"
      ><span class="title">Remaining to Spend</span>
      <strong>{{remainingToSpend | currency}}</strong></span
    >
  </div>
  <div id="options-container">
    <div class="option" (click)="toggleReorder()">
      <img
        class="svg"
        src="{{ isUserReorderingCategories ? 'assets/svg/sort-active.svg' : 'assets/svg/sort-inactive.svg' }}"
      />
    </div>
  </div>
  <div>
    <ion-reorder-group
      [disabled]="!isUserReorderingCategories"
      (ionItemReorder)="doneReorderItems($event)"
    >
      <ion-item
        id="{{item.id}}-ion-item"
        class="category-item-container"
        lines="none"
        *ngFor="let item of categoriesArray; let i = index"
      >
        <app-category
          style="width: 100%"
          [category]="item"
          [subcategories]="item.subcategories || []"
          (addNewSubEvent)="addNewSub(item)"
          [chosenDate]="chosenDate"
          [isUserReorderingCategories]="isUserReorderingCategories"
          (requestSaveOfSubs)="saveAllSubs()"
          (subcategorySelected)="subcategorySelected($event)"
        ></app-category>
        <ion-reorder
          id="{{item.id}}-reorder"
          class="reorder-button"
        ></ion-reorder>
      </ion-item>
    </ion-reorder-group>
  </div>

  <div
    id="app-draggable-container"
    *ngIf="unsortedTransactions.length > 0"
    (click)="revealUnsortedTransactions()"
  >
    <div id="transaction-counter">
      <span *ngIf="isCardContainerVisible">
        <ion-icon name="close" style="color: white; font-size: 30px"></ion-icon>
      </span>
      <span *ngIf="!isCardContainerVisible" class="counter-number">
        {{unsortedTransactions.length}}
      </span>
    </div>
  </div>
  <div
    class="card-container"
    [ngClass]="{ 'slide-up': isCardContainerVisible }"
  >
    <!-- Content of card container -->
    <div id="scrollable-container">
      <div
        id="card"
        *ngFor="let item of unsortedTransactions;"
        (click)="openTransactionSorter(item)"
      >
        <div id="date">{{item.date | date:'MMM. d'}}</div>
        <span id="amount">{{(item.amount * -1) | currency}}</span>
        <div id="name">{{item.merchant_name || item.name}}</div>
      </div>
    </div>
  </div>
</ion-content>
